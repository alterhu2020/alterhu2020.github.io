webpackJsonp([34],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-dff0cfa6","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoAdminUserManageRole.vue':function(e,s){},"./src/pages/PanoAdminUserManageRole.vue":function(e,s,o){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t=o("./node_modules/babel-runtime/core-js/json/stringify.js"),n=o.n(t),i=o("./node_modules/babel-runtime/core-js/object/keys.js"),l=o.n(i),r=o("./node_modules/vux/src/components/button-tab/button-tab.vue"),a=o("./node_modules/vux/src/components/button-tab/button-tab-item.vue"),c=o("./node_modules/vux/src/components/checklist/index.vue"),d=o("./node_modules/vux/src/components/divider/index.vue"),u=o("./node_modules/vux/src/components/popup/index.vue"),h=o("./node_modules/vux/src/components/popup-radio/index.vue"),p=o("./node_modules/vux/src/components/search/index.vue"),m=o("./node_modules/vux/src/components/x-header/index.vue"),v=o("./src/api/index.js"),f=o("./src/utils/StoreUtils.js"),x=o("./src/webconfig.js"),g=o("./src/utils/StringUtils.js"),b=o("./src/utils/PlatformUtils.js"),k=o("./src/utils/ElectronUtils.js"),_=(d.a,r.a,a.a,u.a,m.a,h.a,c.a,p.a,{name:"PanoAdminManage",components:{Divider:d.a,ButtonTab:r.a,ButtonTabItem:a.a,Popup:u.a,XHeader:m.a,PopupRadio:h.a,Checklist:c.a,Search:p.a},data:function(){return{hideRolePickup:!1,rolesModel:[],roles:[],showRolePickUpDialog:!1,selectedRoleNames:"请选择上级职位",selectedpermission:[],permissions:[{key:"5",value:"材料录入和汇总权限",inlineDesc:"可录入，删除，修改和查看汇总统计"},{key:"6",value:"人工添加和查看汇总报表权限",inlineDesc:"可添加和查看汇总统计"},{key:"7",value:"材料审核权限",inlineDesc:"可审核项目中的材料"}],currentUserInfo:{},role:{roleid:0,parentroleids:[],name:""}}},methods:{cancelSearch:function(){},clickSearchResult:function(e){this.filterRoles=this.roles.filter(function(s){return s.value===e.title}),this.roles=[this.filterRoles[0].key],this.selectedRoleNames=this.filterRoles[0].value},inputSearchChange:function(e){var s=this;s.searchResults=[],this.roles.forEach(function(o){Object(g.c)(o.value,e)&&s.searchResults.push({title:o.value,other:o.key})})},searchFocus:function(){this.searchResults=[]},selectRoleChange:function(e,s){console.log("value is: "+e+", label is: "+s),this.selectedRoleNames=0>=e.length?"请选择账号对应的职位名称":s[0]+"等"+s.length+"个职位"},showRolesPickupHandle:function(){this.showRolePickUpDialog=!0},updateRole:function(){var e=this;if(0>=this.rolesModel.length||0===this.role.name.length)this.$vux.toast.show({type:"warn",text:"职位名称和上级职位不能为空!"});else{var s=this.selectedpermission.some(function(e){return"1"===e}),o=this.selectedpermission.some(function(e){return"2"===e}),t=this.selectedpermission.some(function(e){return"3"===e}),n=this.selectedpermission.some(function(e){return"4"===e}),i=this.selectedpermission.some(function(e){return"5"===e}),l=this.selectedpermission.some(function(e){return"6"===e}),r=this.selectedpermission.some(function(e){return"7"===e}),a={roleid:this.role.roleid,parentroleids:this.rolesModel.toString(),companyid:this.currentUserInfo.companyid,name:this.role.name,canproject:s,cantask:o,canpano:t,cancheckin:n,canmaterial:i,canlabor:l,canmaterialapprove:r};this.$vux.loading.show({text:"更新职位信息中..."}),v.b.put("/company/role/update",a).then(function(s){e.$vux.loading.hide(),1e3===s.data.code&&(e.$vux.toast.show({text:"职位信息更新成功,三秒后跳转到职业信息列表!"}),setTimeout(function(){Object(b.b)()?e.$router.go(-1):Object(k.a)()},3e3))}).catch(function(s){e.$vux.loading.hide(),console.log("异常出错: "+s)})}},fetchAllRoles:function(e,s){var o=this;this.roles=[],this.rolesModel=[];var t=[];e.forEach(function(e){var n=e.roleid,i=e.name;n!==s&&(t.push(n.toString()),o.roles.push({key:n.toString(),value:i}))}),this.rolesModel=this.role.parentroleids,Object(g.a)(t,this.rolesModel)||(this.hideRolePickup=!0)}},mounted:function(){var e=this;this.$store.dispatch("UpdateShowTabbar",!1);var s=f.a.get(x.a.StoreUserInfoKey);this.currentUserInfo=s.customerdata;var o=this.$route.params;if(0<l()(o).length){var t=o.roleid;if(0<o.parentid.indexOf(",")){var i=o.parentid.split(",");this.role.parentroleids=i}else this.role.parentroleids=[o.parentid];o.canproject&&this.selectedpermission.push("1"),o.cantask&&this.selectedpermission.push("2"),o.canpano&&this.selectedpermission.push("3"),o.cancheckin&&this.selectedpermission.push("4"),o.canmaterial&&this.selectedpermission.push("5"),o.canlabor&&this.selectedpermission.push("6"),o.canmaterialapprove&&this.selectedpermission.push("7"),this.role.roleid=t,this.role.name=o.name;var r=o.roles;console.log("获取的角色信息是: "+n()(this.role)),this.fetchAllRoles(r,t)}else this.$vux.alert.show({title:"修改职位信息错误提示",content:"参数错误,无法显示!",onHide:function(){Object(b.b)()?e.$router.go(-1):Object(k.a)()}})}}),j={render:function(){var e=this,s=e.$createElement,o=e._self._c||s;return o("div",[o("x-header",{attrs:{title:"职位信息修改","left-options":{showBack:!0,preventGoBack:!1}}},[o("span",{staticStyle:{"font-size":"18px !important","font-weight":"400"},attrs:{slot:"right"},on:{click:e.updateRole},slot:"right"},[e._v("\n    保存\n    ")])]),e._v(" "),o("br"),e._v(" "),o("cell",{directives:[{name:"show",rawName:"v-show",value:!e.hideRolePickup,expression:"!hideRolePickup"}],attrs:{title:"上级职位",value:e.selectedRoleNames,"is-link":""},nativeOn:{click:function(s){return e.showRolesPickupHandle(s)}}}),e._v(" "),o("x-input",{attrs:{title:"职位名称",placeholder:"输入该职位名称"},model:{value:e.role.name,callback:function(s){e.$set(e.role,"name","string"==typeof s?s.trim():s)},expression:"role.name"}}),e._v(" "),o("checklist",{staticClass:"permisson",attrs:{title:"职位权限设置",options:e.permissions},model:{value:e.selectedpermission,callback:function(s){e.selectedpermission=s},expression:"selectedpermission"}}),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:e.showRolePickUpDialog,callback:function(s){e.showRolePickUpDialog=s},expression:"showRolePickUpDialog"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(s){e.showRolePickUpDialog=!1}}},[e._v("\n        可选职位列表\n      ")]),e._v(" "),e.roles.length>0?o("div",[o("checklist",{attrs:{title:"选择一个或多个上级职位(已经选择"+e.rolesModel.length+"个职位)",required:"",max:3,options:e.roles},on:{"on-change":e.selectRoleChange},model:{value:e.rolesModel,callback:function(s){e.rolesModel=s},expression:"rolesModel"}})],1):e._e()],1)],1)],1)},staticRenderFns:[]};var R=o("./node_modules/vue-loader/lib/component-normalizer.js")(_,j,!1,function(e){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-dff0cfa6","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoAdminUserManageRole.vue')},"data-v-dff0cfa6",null);s.default=R.exports}});