(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{328:function(t,n,e){"use strict";e.r(n);var s=e(6),a=Object(s.a)({},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("参考："),e("a",{attrs:{href:"https://serverfault.com/questions/214242/can-i-hide-all-server-os-info/279389#279389",target:"_blank",rel:"noopener noreferrer"}},[t._v("修改nginx的Server名称,修改两个文件:ngx_http_header_filter_module.c和nginx.h"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"nginx安装步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" Nginx安装步骤")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ cd /opt\n$ sudo mkdir nginx-modules\n$ cd nginx-modules\n删除$ wget https://github.com/openresty/headers-more-nginx-module/archive/v0.33.tar.gz \n删除$ tar xvf v0.33.tar.gz headers-more-nginx-module-0.33\n\n$ wget http://zlib.net/zlib-1.2.11.tar.gz\n$ tar xvf zlib-1.2.11.tar.gz\n$ apt install git\n$ git clone https://github.com/eustas/ngx_brotli\n$ cd ngx_brotli && git submodule update --init\n\n$ cd ..\n$ wget https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz\n$ tar xvf pcre-8.43.tar.gz\n\n$ wget https://www.openssl.org/source/openssl-1.1.1c.tar.gz\n$ tar xvf openssl-1.1.1c.tar.gz\n$ sudo apt install build-essential -y\n--- 以下配置可参考： [Compile from source](https://github.com/jukbot/setup-nginx-webserver/blob/master/README.md)\n$ wget http://nginx.org/download/nginx-1.17.3.tar.gz\n$ tar zxvf nginx-1.17.3.tar.gz\n$ cd nginx-1.17.3/src/http/\n$ nano ngx_http_header_filter_module.c\n$ sudo nano src/core/nginx.h\n$ sudo nano src/http/ngx_http_special_response.c\n$ sudo mkdir /var/lib/nginx\n$ ./configure --prefix=/usr/local/nginx \\\n            --sbin-path=/usr/sbin/nginx \\\n            --modules-path=/usr/lib/nginx/modules \\\n            --conf-path=/etc/nginx/nginx.conf \\\n            --error-log-path=/var/log/nginx/error.log \\\n            --http-log-path=/var/log/nginx/access.log \\\n            --pid-path=/run/nginx.pid \\\n            --lock-path=/var/lock/nginx.lock \\\n            --user=www-data \\\n            --group=www-data \\\n            --http-client-body-temp-path=/var/lib/nginx/body \\\n            --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \\\n            --http-proxy-temp-path=/var/lib/nginx/proxy \\\n            --http-scgi-temp-path=/var/lib/nginx/scgi \\\n            --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \\\n            --with-openssl=../nginx-modules/openssl-1.1.1c \\\n            --with-openssl-opt=enable-ec_nistp_64_gcc_128 \\\n            --with-openssl-opt=no-nextprotoneg \\\n            --with-openssl-opt=no-weak-ssl-ciphers \\\n            --with-openssl-opt=no-ssl3 \\\n            --with-pcre=../nginx-modules/pcre-8.43 \\\n            --with-pcre-jit \\\n            --with-zlib=../nginx-modules/zlib-1.2.11 \\\n            --with-compat \\\n            --with-file-aio \\\n            --with-threads \\\n            --with-http_addition_module \\\n            --with-http_auth_request_module \\\n            --with-http_dav_module \\\n            --with-http_flv_module \\\n            --with-http_mp4_module \\\n            --with-http_gunzip_module \\\n            --with-http_gzip_static_module \\\n            --with-http_random_index_module \\\n            --with-http_realip_module \\\n            --with-http_slice_module \\\n            --with-http_ssl_module \\\n            --with-http_sub_module \\\n            --with-http_stub_status_module \\\n            --with-http_v2_module \\\n            --with-http_secure_link_module \\\n            --with-mail \\\n            --with-mail_ssl_module \\\n            --with-stream \\\n            --with-stream_realip_module \\\n            --with-stream_ssl_module \\\n            --with-stream_ssl_preread_module \\\n            --with-debug \\\n            --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' \\\n            --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' \\\n            --add-module=../nginx-modules/ngx_brotli\n\n$ make   #这个操作需要花费十分钟左右 \n$ sudo make install \n$ ~useradd -d /etc/nginx/ -s /sbin/nologin nginx~\n")])])]),e("h2",{attrs:{id:"安装nginx-service服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx-service服务","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装nginx.service服务")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("nano")]),t._v(" /lib/systemd/system/nginx.service \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nDescription"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("A high performance web server and a reverse proxy server\nDocumentation"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("man:nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("8"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nAfter"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("network.target\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nType"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("forking\nPIDFile"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/run/nginx.pid\nExecStartPre"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx -t -q -g "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'daemon on; master_process on;'")]),t._v("\nExecStartPost"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/bin/sleep 0.1\nExecStart"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx -g "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'daemon on; master_process on;'")]),t._v("\nExecReload"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx -g "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'daemon on; master_process on;'")]),t._v(" -s reload\nExecStop"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid\nTimeoutStopSec"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("5\nKillMode"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mixed\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Install"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nWantedBy"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("multi-user.target\n\n")])])]),e("blockquote",[e("p",[t._v("nginx.service: Failed to read PID from file /run/nginx.pid: Invalid argument")])]),t._v(" "),e("p",[t._v("That warning with the nginx.pid file is a know bug (at least for Ubutnu if not for other distros as well). More details here: https://bugs.launchpad.net/ubuntu/+source/nginx/+bug/1581864")]),t._v(" "),e("p",[t._v("Workaround (on a ssh console, as root, use the commands bellow):")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /etc/systemd/system/nginx.service.d\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[Service]\\nExecStartPost=/bin/sleep 0.1\\n"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/systemd/system/nginx.service.d/override.conf\nsystemctl daemon-reload\nsystemctl restart nginx \n\n")])])]),e("h1",{attrs:{id:"nginx配置助手"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置助手","aria-hidden":"true"}},[t._v("#")]),t._v(" nginx配置助手")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("-- 参考地址"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("安装certbot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("https://certbot.eff.org/lets-encrypt/debianstretch-nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" certbot\n\n")])])]),e("h3",{attrs:{id:"参考配置文件：-nginxconfig助手"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考配置文件：-nginxconfig助手","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考配置文件： "),e("a",{attrs:{href:"https://nginxconfig.io/?0.domain=pingbook.top&0.path=%2Fwww&0.document_root=%2Fpingbook.top&0.redirect=false&0.email=alterhu2020@gmail.com&0.php=false&0.proxy_path=%2Fproxy&0.proxy_pass=http:%2F%2F127.0.0.1:9000&0.fallback_html&0.access_log_domain&0.error_log_domain&directory_letsencrypt=%2Fwww%2F_letsencrypt%2F&server_tokens&limit_req&brotli&log_not_found&client_max_body_size=320&symlink=false",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginxconfig助手"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code")])]),e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("Symlink vhost配置文件")]),t._v(" "),e("p",[t._v("注意: 在"),e("code",[t._v("Symlink vhost")]),t._v(" 中不要勾选enable。")])]),t._v(" "),e("h1",{attrs:{id:"其他"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他","aria-hidden":"true"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),e("h2",{attrs:{id:"配置501-404默认页面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置501-404默认页面","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置501,404默认页面")]),t._v(" "),e("p",[t._v("参考链接: "),e("a",{attrs:{href:"https://blog.adriaan.io/one-nginx-error-page-to-rule-them-all.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("One NGINX error page to rule them all"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ nano /etc/nginx/nginx.conf\n# Generated by nginxconfig.io\n# https://nginxconfig.io/?0.domain=pingbook.top&0.path=%2Fwww&0.redirect=false&0.email=alterhu2020@gmail.com&0.php=false&0.proxy&0.proxy_path=%2Fproxy&0.proxy_pass=http:%2F%2F127.0.0.1:9000&0.fallback_html&0.access_log_domain&0.error_log_domain&directory_letsencrypt=%2Fwww%2F_letsencrypt%2F&limit_req&brotli&log_not_found&client_max_body_size=32&symlink=false\n\nuser www-data;\npid /run/nginx.pid;\nworker_processes auto;\nworker_rlimit_nofile 65535;\n\nevents {\n\tmulti_accept on;\n\tworker_connections 65535;\n}\n\nhttp {\n\tcharset utf-8;\n\tsendfile on;\n\ttcp_nopush on;\n\ttcp_nodelay on;\n\tserver_tokens off;\n\ttypes_hash_max_size 2048;\n\tclient_max_body_size 32M;\n\n\t# MIME\n\tinclude mime.types;\n\tdefault_type application/octet-stream;\n\n\t# logging\n\taccess_log /var/log/nginx/access.log;\n\terror_log /var/log/nginx/error.log warn;\n\n\t# limits\n\tlimit_req_log_level warn;\n\tlimit_req_zone $binary_remote_addr zone=login:10m rate=10r/m;\n\n\t# SSL\n\tssl_session_timeout 1d;\n\tssl_session_cache shared:SSL:10m;\n\tssl_session_tickets off;\n\n\t# Diffie-Hellman parameter for DHE ciphersuites\n\tssl_dhparam /etc/nginx/dhparam.pem;\n\n\t# Mozilla Intermediate configuration\n\tssl_protocols TLSv1.2 TLSv1.3;\n\tssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\n\n\t# OCSP Stapling\n\tssl_stapling on;\n\tssl_stapling_verify on;\n\tresolver 1.1.1.1 1.0.0.1 8.8.8.8 8.8.4.4 208.67.222.222 208.67.220.220 valid=60s;\n\tresolver_timeout 2s;\n        \n     # error pages\n\tmap $status $status_text {\n\t\t400 'Bad Request';\n\t\t401 'Unauthorized';\n\t\t402 'Payment Required';\n\t\t403 'Forbidden';\n\t\t404 'Not Found';\n\t\t405 'Method Not Allowed';\n\t\t406 'Not Acceptable';\n\t\t407 'Proxy Authentication Required';\n\t\t408 'Request Timeout';\n\t\t409 'Conflict';\n\t\t410 'Gone';\n\t\t411 'Length Required';\n\t\t412 'Precondition Failed';\n\t\t413 'Payload Too Large';\n\t\t414 'URI Too Long';\n\t\t415 'Unsupported Media Type';\n\t\t416 'Range Not Satisfiable';\n\t\t417 'Expectation Failed';\n\t\t418 'I\\'m a teapot';\n\t\t421 'Misdirected Request';\n\t\t422 'Unprocessable Entity';\n\t\t423 'Locked';\n\t\t424 'Failed Dependency';\n\t\t426 'Upgrade Required';\n\t\t428 'Precondition Required';\n\t\t429 'Too Many Requests';\n\t\t431 'Request Header Fields Too Large';\n\t\t451 'Unavailable For Legal Reasons';\n\t\t500 'Internal Server Error';\n\t\t501 'Not Implemented';\n\t\t502 'Bad Gateway';\n\t\t503 'Service Unavailable';\n\t\t504 'Gateway Timeout';\n\t\t505 'HTTP Version Not Supported';\n\t\t506 'Variant Also Negotiates';\n\t\t507 'Insufficient Storage';\n\t\t508 'Loop Detected';\n\t\t510 'Not Extended';\n\t\t511 'Network Authentication Required';\n\t\tdefault 'Oppos, Something is wrong';\n        }\n\n\t# load configs\n\tinclude /etc/nginx/conf.d/*.conf;\n\tinclude /etc/nginx/sites-enabled/*;\n}\n\n")])])]),e("p",[t._v("in the "),e("code",[t._v("/etc/nginx/nginxconfig.io/general.conf")]),t._v(" file, put code as following also create file: "),e("code",[t._v("error.html")]),t._v(" in directory: "),e("code",[t._v("/www/_error")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 421 422 423 424 426 428 429 431 451 500 501 502 503 504 505 506 507 508 510 511 /error.html;\n\nlocation = /error.html {\n  ssi on;\n  internal;\n  root /www/_error;\n}\n\n")])])])])},[],!1,null,null,null);n.default=a.exports}}]);