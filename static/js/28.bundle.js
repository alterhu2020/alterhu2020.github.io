webpackJsonp([28],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-044f0194","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/LaborsEnter.vue':function(e,t){},'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-2ad96173","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/components/LaborDialog.vue':function(e,t){},"./src/components/LaborDialog.vue":function(e,t,a){"use strict";var o=a("./node_modules/babel-runtime/core-js/json/stringify.js"),r=a.n(o),s=a("./node_modules/vux/src/components/datetime/index.vue"),n=a("./node_modules/vux/src/components/spinner/index.vue"),i=a("./src/components/SearchCheckList.vue"),d=a("./src/utils/StoreUtils.js"),l=a("./src/webconfig.js"),c=a("./src/utils/DateUtils.js"),u=a("./src/api/index.js"),h=(s.a,n.a,i.a,Boolean,Boolean,Boolean,Object,Object,String,{name:"LaborDialog",components:{Datetime:s.a,Spinner:n.a,SearchCheckList:i.a},data:function(){return{currentAddMe:this.addme,currentAdd:this.add,currentAddLaborData:this.addLaborData,showLaborSubmitButton:!0,showAddLaborDlgForUsersPickUpDlg:!1,storeUsers:[],users:[],usersModel:[],selectedAddLaborName:"请选择",showAddLaborDlgForBranchesPickUpDlg:!1,storeBranches:[],branches:[],branchesModel:[],selectedBranchName:"请选择",currentUpdate:this.update,currentUpdateLaborData:this.updateLaborData}},props:{add:{type:Boolean,default:!1},addme:{type:Boolean,default:!1},update:{type:Boolean,default:!1},addLaborData:{type:Object,default:function(){return{userid:"",username:"",branchid:null,newBranchName:null,unit:"工日",price:"",startdate:Object(c.b)("YYYY-MM-DD"),enddate:""}}},updateLaborData:{type:Object,default:function(){return{laborid:null,userid:null,branchid:null,newBranchName:null,price:"",startdate:"",enddate:""}}},updateKeyword:{type:String,default:"修改人工"}},watch:{add:function(e){this.currentAdd=e},currentAdd:function(e){e&&(this.showLaborSubmitButton=!0,this.fetchUsersAndBranches())},addme:function(e){this.currentAddMe=e},currentAddMe:function(e){e&&(this.showLaborSubmitButton=!0,this.fetchBranches())},update:function(e){this.currentUpdate=e},currentUpdate:function(e){e&&(this.showLaborSubmitButton=!0,this.fetchBranches())},addLaborData:function(e){this.currentAddLaborData=e}},methods:{saveLaborPriceChange:function(){},addBackButton:function(){this.$emit("on-click-add-back")},updateBackButton:function(){this.$emit("on-click-update-back")},fetchUsersAndBranches:function(){var e=this;this.companyid&&(this.users=[],this.usersModel=[],u.b.get("/labor/users/"+this.companyid).then(function(t){1e3===t.data.code&&(t.data.data.forEach(function(t){e.users.push({key:t.userkey.toString(),value:t.nickname})}),e.usersModel.push(e.users[0].key))}).catch(function(e){alert("获取人工信息出错: "+e)})),this.fetchBranches()},fetchBranches:function(){var e=this;this.branches=[],u.b.get("/labor/branches").then(function(t){1e3===t.data.code&&(t.data.data.forEach(function(t){e.branches.push({key:t.branchid.toString(),value:t.branchname})}),e.add&&(e.branchesModel=[e.branches[0].key]),e.update&&(e.branchesModel=[e.updateLaborData.branchid.toString()]),e.addme&&(e.branchesModel=[e.branches[0].key]))}).catch(function(e){alert("获取工种列表出错: "+e)})},usersCheckChange:function(e,t){0<e.length&&(this.selectedAddLaborName=t.toString(),this.currentAddLaborData.username=t[0].toString(),this.currentAddLaborData.userid=e[0])},branchCheckChange:function(e,t){console.log("value is: "+r()(e)+","+r()(t)),0<e.length&&(this.currentAdd&&(this.selectedBranchName=t.toString(),this.currentAddLaborData.newBranchName=null,this.currentAddLaborData.branchid=e[0]),this.currentAddMe&&(this.selectedBranchName=t.toString(),this.currentAddLaborData.newBranchName=null,this.currentAddLaborData.branchid=e[0]),this.currentUpdate&&(this.selectedBranchName=t.toString(),this.updateLaborData.newBranchName=null,this.currentUpdateLaborData.branchid=e[0]))},saveBranchName:function(e){this.showAddLaborDlgForBranchesPickUpDlg=!1,this.currentAdd&&(this.currentAddLaborData.branchid=null,this.currentAddLaborData.newBranchName=e,this.selectedBranchName=e),this.currentAddMe&&(this.currentAddLaborData.branchid=null,this.currentAddLaborData.newBranchName=e,this.selectedBranchName=e),this.currentUpdate&&(this.currentUpdateLaborData.branchid=null,this.currentUpdateLaborData.newBranchName=e,this.selectedBranchName=e)},handleAddLabor:function(){var e=this;this.showLaborSubmitButton=!1,console.log("结果是： "+r()(this.currentAddLaborData));var t=d.a.get(l.a.StoreProject);return t?0===this.currentAddLaborData.userid.length?(this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择员工姓名，员工姓名不能为空！"}),void(this.showLaborSubmitButton=!0)):null===this.currentAddLaborData.branchid&&""===this.currentAddLaborData.branchname?(this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择工种名称姓名，工种名称不能为空！"}),void(this.showLaborSubmitButton=!0)):""===this.currentAddLaborData.price||isNaN(this.currentAddLaborData.price)?(this.$vux.toast.show({type:"warn",time:5e3,text:"工种单价必须大于等于零！"}),void(this.showLaborSubmitButton=!0)):0>=this.currentAddLaborData.startdate.length?(this.$vux.toast.show({type:"warn",time:5e3,text:"工种对应的进场日期不能为空！"}),void(this.showLaborSubmitButton=!0)):(this.$vux.loading.show({text:"正在提交数据..."}),console.log("提交的数据是： "+r()(this.currentAddLaborData)),void u.b.post("/labor",{labor:this.currentAddLaborData,projectid:t.key}).then(function(t){e.$vux.loading.hide();var a=t.data.code;1e3===a?e.$emit("after-add",e.currentAddLaborData):1004===a&&(e.showLaborSubmitButton=!0,e.$vux.toast.show({type:"warn",time:5e3,text:"当前录入的人工已经存在，不能重复添加,请重新输入！"}))}).catch(function(t){alert("创建人工失败，错误码："+t),e.$vux.loading.hide(),e.showLaborSubmitButton=!0})):(this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择正确的项目，项目名称不能为空！"}),void(this.showLaborSubmitButton=!0))},handleUpdateLabor:function(){var e=this;this.showLaborSubmitButton=!1;var t=d.a.get(l.a.StoreProject);return t?null===this.currentUpdateLaborData.branchid&&""===this.currentUpdateLaborData.branchname?(this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择工种名称姓名，工种名称不能为空！"}),void(this.showLaborSubmitButton=!0)):""===this.currentUpdateLaborData.price||isNaN(this.currentUpdateLaborData.price)?(this.$vux.toast.show({type:"warn",time:5e3,text:"工种单价必须大于等于零！"}),void(this.showLaborSubmitButton=!0)):0>=this.currentUpdateLaborData.startdate.length?(this.$vux.toast.show({type:"warn",time:5e3,text:"工种对应的进场日期不能为空！"}),void(this.showLaborSubmitButton=!0)):(this.$vux.loading.show({text:"正在提交数  据..."}),console.log("提交的数据是： "+r()(this.currentUpdateLaborData)),void u.b.put("/labor/update",{labor:this.currentUpdateLaborData,projectid:t.key}).then(function(t){e.$vux.loading.hide();var a=t.data.code;1e3===a?e.$emit("after-update",e.currentUpdateLaborData):1004===a&&(e.showLaborSubmitButton=!0,e.$vux.toast.show({type:"warn",time:5e3,text:"当前录入的人工已经存在，不能重复添加,请重新输入！"}))}).catch(function(t){alert("创建人工失败，错误码："+t),e.$vux.loading.hide(),e.showLaborSubmitButton=!0})):(this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择正确的项目，项目名称不能为空！"}),void(this.showLaborSubmitButton=!0))},hideDateTime:function(e){"cancel"===e&&((this.currentAdd||this.currentAddMe)&&(this.currentAddLaborData.enddate=""),this.currentUpdate&&(this.currentUpdateLaborData.enddate=""))}},mounted:function(){var e=d.a.get(l.a.StoreUserInfoKey);this.companyid=e.customerdata.companyid}}),p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.currentAdd,callback:function(t){e.currentAdd=t},expression:"currentAdd"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0},title:"增加人工"},on:{"on-click-back":e.addBackButton}},[e.showLaborSubmitButton?a("span",{staticStyle:{"font-size":"18px"},attrs:{slot:"right"},on:{click:e.handleAddLabor},slot:"right"},[e._v("\n        保存\n      ")]):a("spinner",{attrs:{slot:"right",type:"android",size:"28px"},slot:"right"})],1),e._v(" "),a("group",{attrs:{title:"增加人工基本信息"}},[a("cell",{attrs:{title:"选择一个人工姓名","inline-desc":"请选择一个人工动态(必选)",value:e.selectedAddLaborName,"is-link":""},nativeOn:{click:function(t){e.showAddLaborDlgForUsersPickUpDlg=!0}}}),e._v(" "),a("cell",{attrs:{title:"选择一个工种名称","inline-desc":"请选择一个工种名称(必选)",value:e.selectedBranchName,"is-link":""},nativeOn:{click:function(t){e.showAddLaborDlgForBranchesPickUpDlg=!0}}}),e._v(" "),a("x-input",{attrs:{title:"人工单位",placeholder:"输入人工的单位，默认是工日"},model:{value:e.currentAddLaborData.unit,callback:function(t){e.$set(e.currentAddLaborData,"unit",t)},expression:"currentAddLaborData.unit"}}),e._v(" "),a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{staticClass:"price",attrs:{label:"人工单价"}},[a("el-input",{model:{value:e.currentAddLaborData.price,callback:function(t){e.$set(e.currentAddLaborData,"price",t)},expression:"currentAddLaborData.price"}},[a("template",{slot:"append"},[e._v("元")])],2)],1)],1),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"进场日期",placeholder:"输入人工的进场日期"},model:{value:e.currentAddLaborData.startdate,callback:function(t){e.$set(e.currentAddLaborData,"startdate",t)},expression:"currentAddLaborData.startdate"}}),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"离场日期","start-date":e.currentAddLaborData.startdate,placeholder:"输入人工的离场日期"},on:{"on-hide":e.hideDateTime},model:{value:e.currentAddLaborData.enddate,callback:function(t){e.$set(e.currentAddLaborData,"enddate",t)},expression:"currentAddLaborData.enddate"}})],1)],1)],1),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.currentAddMe,callback:function(t){e.currentAddMe=t},expression:"currentAddMe"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0},title:"增加人工"},on:{"on-click-back":e.addBackButton}},[e.showLaborSubmitButton?a("span",{staticStyle:{"font-size":"18px"},attrs:{slot:"right"},on:{click:e.handleAddLabor},slot:"right"},[e._v("\n        保存\n      ")]):a("spinner",{attrs:{slot:"right",type:"android",size:"28px"},slot:"right"})],1),e._v(" "),a("group",{attrs:{title:"增加人工基本信息"}},[a("cell",{attrs:{title:"人工姓名"}},[e._v(e._s(e.currentAddLaborData.username))]),e._v(" "),a("cell",{attrs:{title:"选择一个工种名称","inline-desc":"请选择一个工种名称(必选)",value:e.selectedBranchName,"is-link":""},nativeOn:{click:function(t){e.showAddLaborDlgForBranchesPickUpDlg=!0}}}),e._v(" "),a("x-input",{attrs:{title:"人工单位",placeholder:"输入人工的单位，默认是工日"},model:{value:e.currentAddLaborData.unit,callback:function(t){e.$set(e.currentAddLaborData,"unit",t)},expression:"currentAddLaborData.unit"}}),e._v(" "),a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{staticClass:"price",attrs:{label:"人工单价"}},[a("el-input",{model:{value:e.currentAddLaborData.price,callback:function(t){e.$set(e.currentAddLaborData,"price",t)},expression:"currentAddLaborData.price"}},[a("template",{slot:"append"},[e._v("元")])],2)],1)],1),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"进场日期",placeholder:"输入人工的进场日期"},model:{value:e.currentAddLaborData.startdate,callback:function(t){e.$set(e.currentAddLaborData,"startdate",t)},expression:"currentAddLaborData.startdate"}}),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"离场日期","start-date":e.currentAddLaborData.startdate,placeholder:"输入人工的离场日期"},on:{"on-hide":e.hideDateTime},model:{value:e.currentAddLaborData.enddate,callback:function(t){e.$set(e.currentAddLaborData,"enddate",t)},expression:"currentAddLaborData.enddate"}})],1)],1)],1),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.currentUpdate,callback:function(t){e.currentUpdate=t},expression:"currentUpdate"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0},title:e.updateKeyword},on:{"on-click-back":e.updateBackButton}},[e.showLaborSubmitButton?a("span",{staticStyle:{"font-size":"18px"},attrs:{slot:"right"},on:{click:e.handleUpdateLabor},slot:"right"},[e._v("\n        保存\n      ")]):a("spinner",{attrs:{slot:"right",type:"android",size:"28px"},slot:"right"})],1),e._v(" "),a("group",{attrs:{title:e.updateKeyword+"基本信息"}},[a("cell",{attrs:{title:"人工姓名"}},[e._v(e._s(e.currentUpdateLaborData.username))]),e._v(" "),a("cell",{attrs:{title:"选择一个工种名称","inline-desc":"请选择一个工种名称(必选)",value:e.selectedBranchName,"is-link":""},nativeOn:{click:function(t){e.showAddLaborDlgForBranchesPickUpDlg=!0}}}),e._v(" "),a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{staticClass:"price",attrs:{label:"人工单价"}},[a("el-input",{model:{value:e.currentUpdateLaborData.price,callback:function(t){e.$set(e.currentUpdateLaborData,"price",t)},expression:"currentUpdateLaborData.price"}},[a("template",{slot:"append"},[e._v("元")])],2)],1)],1),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"进场日期",placeholder:"输入人工的进场日期"},model:{value:e.currentUpdateLaborData.startdate,callback:function(t){e.$set(e.currentUpdateLaborData,"startdate",t)},expression:"currentUpdateLaborData.startdate"}}),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"离场日期","start-date":e.currentUpdateLaborData.startdate,placeholder:"输入人工的离场日期"},model:{value:e.currentUpdateLaborData.enddate,callback:function(t){e.$set(e.currentUpdateLaborData,"enddate",t)},expression:"currentUpdateLaborData.enddate"}})],1)],1)],1),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.showAddLaborDlgForUsersPickUpDlg,callback:function(t){e.showAddLaborDlgForUsersPickUpDlg=t},expression:"showAddLaborDlgForUsersPickUpDlg"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(t){e.showAddLaborDlgForUsersPickUpDlg=!1}}},[e._v("\n        可选人工列表\n      ")]),e._v(" "),a("search-check-list",{attrs:{data:e.users,keyword:"人工",max:1},on:{"on-change":e.usersCheckChange},model:{value:e.usersModel,callback:function(t){e.usersModel=t},expression:"usersModel"}})],1)],1),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.showAddLaborDlgForBranchesPickUpDlg,callback:function(t){e.showAddLaborDlgForBranchesPickUpDlg=t},expression:"showAddLaborDlgForBranchesPickUpDlg"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(t){e.showAddLaborDlgForBranchesPickUpDlg=!1}}},[e._v("\n        可选人工工种名称列表\n      ")]),e._v(" "),a("search-check-list",{attrs:{data:e.branches,keyword:"工种",max:1,canadd:""},on:{"on-change":e.branchCheckChange,"save-name":e.saveBranchName},model:{value:e.branchesModel,callback:function(t){e.branchesModel=t},expression:"branchesModel"}})],1)],1)])},staticRenderFns:[]};var b=a("./node_modules/vue-loader/lib/component-normalizer.js")(h,p,!1,function(e){a('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-2ad96173","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/components/LaborDialog.vue')},"data-v-2ad96173",null);t.a=b.exports},"./src/pages/LaborsEnter.vue":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("./node_modules/babel-runtime/core-js/json/stringify.js"),r=a.n(o),s=a("./node_modules/vux/src/components/badge/index.vue"),n=a("./node_modules/vux/src/components/button-tab/button-tab.vue"),i=a("./node_modules/vux/src/components/button-tab/button-tab-item.vue"),d=a("./node_modules/vux/src/components/checklist/index.vue"),l=a("./node_modules/vux/src/components/datetime/index.vue"),c=a("./node_modules/vux/src/components/flexbox/flexbox.vue"),u=a("./node_modules/vux/src/components/flexbox/flexbox-item.vue"),h=a("./node_modules/vux/src/components/form-preview/index.vue"),p=a("./node_modules/vux/src/components/grid/grid.vue"),b=a("./node_modules/vux/src/components/grid/grid-item.vue"),m=a("./node_modules/vux/src/components/group-title/index.vue"),v=a("./node_modules/vux/src/components/icon/index.vue"),x=a("./node_modules/vux/src/components/load-more/index.vue"),f=a("./node_modules/vux/src/components/popup/index.vue"),D=a("./node_modules/vux/src/components/previewer/index.vue"),w=a("./node_modules/vux/src/components/search/index.vue"),g=a("./node_modules/vux/src/components/spinner/index.vue"),L=a("./node_modules/vux/src/components/swipeout/swipeout.vue"),y=a("./node_modules/vux/src/components/swipeout/swipeout-button.vue"),k=a("./node_modules/vux/src/components/swipeout/swipeout-item.vue"),_=a("./node_modules/vux/src/components/swiper/swiper.vue"),B=a("./node_modules/vux/src/components/swiper/swiper-item.vue"),A=a("./node_modules/vux/src/components/x-number/index.vue"),S=a("./node_modules/vux/src/components/x-switch/index.vue"),j=a("./node_modules/vux/src/components/x-textarea/index.vue"),U=a("./src/components/sticky.js"),M=a("./node_modules/vue-feather-icons/dist/vue-feather-icons.es.js"),$=a("./src/webconfig.js"),E=a("./src/utils/StoreUtils.js"),H=a("./src/api/index.js"),F=a("./src/components/SelectProjectDialog.vue"),T=a("./src/components/LaborDialog.vue"),N=a("./src/components/SearchCheckList.vue"),P=a("./src/utils/DateUtils.js"),O=a("./src/utils/PlatformUtils.js"),Y=(U.a,N.a,n.a,i.a,M.d,f.a,A.a,S.a,j.a,x.a,p.a,b.a,m.a,_.a,B.a,k.a,y.a,L.a,s.a,c.a,u.a,D.a,d.a,h.a,w.a,l.a,v.a,F.a,g.a,T.a,{name:"MaterialLaborEnter",metaInfo:{title:"人工动态"},directives:{sticky:U.a},components:{SearchCheckList:N.a,ButtonTab:n.a,ButtonTabItem:i.a,PlusIcon:M.d,Popup:f.a,XNumber:A.a,XSwitch:S.a,XTextarea:j.a,LoadMore:x.a,Grid:p.a,GridItem:b.a,GroupTitle:m.a,Swiper:_.a,SwiperItem:B.a,SwipeoutItem:k.a,SwipeoutButton:y.a,Swipeout:L.a,Badge:s.a,Flexbox:c.a,FlexboxItem:u.a,Previewer:D.a,Checklist:d.a,FormPreview:h.a,Search:w.a,Datetime:l.a,Icon:v.a,SelectProjectDialog:F.a,Spinner:g.a,LaborDialog:T.a},data:function(){return{userinfo:{},showProjectSelectDlg:!1,project:{},showmenuOptions:!0,menuOptions:!1,showAddBtn:!0,shouldHover:!0,labors:{count:0,items:[]},showLaborDetailDlg:!1,laborDetaillaborid:null,laborExpenseHistory:[],laborDetailDlgHeaderTitle:"",laborTotalFormHeader:0,laborTotalFormHeaderBody:[],laborMonthFormHeader:0,laborMonthFormHeaderBody:[],showAddExpenseDlg:!1,expenseDlgHeader:"新增开支",expenseDlgTypeEnabled:!0,showExpenseSubmitButton:!0,expense:{expenseid:null,laborid:null,type:1e3,date:Object(P.b)("YYYY-MM-DD"),price:0,days:0,hours:0,comments:""},selectedExpenseName:"请选择",showAddExpenseDlgForTypePickUpDlg:!1,expenseStartDate:Object(P.b)("YYYY-MM-DD"),expenseTypes:[{key:1e3,value:"生活费"},{key:1001,value:"借钱"},{key:1002,value:"缺勤"},{key:1003,value:"加班"},{key:1004,value:"其他"}],expenseTypesModel:[1e3],updateExpenseIndex:0,showUpdateLaborDlg:!1,updatelaborItemIndex:0,updatelaborIndex:0,updateLaborData:{laborid:null,username:"",branchname:"",branchid:null,price:0,startdate:"",enddate:""},showAddLaborDlg:!1}},methods:{selectProject:function(e){this.project=e,this.showProjectSelectDlg=!1,this.fetchLabors()},switchProject:function(){this.showProjectSelectDlg=!0},clickMenuOptions:function(e){if("excel"===e)this.$router.push({name:"lstatistic",params:{projectid:this.project.key}});else if("copy"===e)if(Object(O.b)()){var t,a=this,o=this.$route.params.projectid;t=o?""+location.href:location.href+"/"+this.project.key.toString(),this.$copyText(t).then(function(){a.$vux.alert.show({buttonText:"好的",title:"人工动态提示",content:"地址复制成功! 你可在电脑端打开地址: "+t+" 进行人工动态的操作!"})},function(e){alert("不支持复制功能！"),console.log(e)})}else this.$vux.toast.show({time:3e3,text:"暂不支持桌面版操作！"})},hideMenuOptions:function(){this.showAddBtn=this.userinfo.canlabor},deleteLabor:function(e,t,a){var o=this;this.$vux.confirm.show({hideOnBlur:!0,title:"删除人工提示",content:"真的要删除该人工吗？",onConfirm:function(){H.b.delete("/labor/del/"+e.laborid).then(function(e){var r=e.data.code;1e3===r?(o.labors.items[t].result.splice(a,1),o.labors.count-=1,o.$vux.toast.show({time:4e3,text:"删除人工成功！"})):o.$vux.toast.show({type:"warn",time:4e3,text:"删除用户失败，错误码："+r})}).catch(function(e){o.$vux.toast.show({type:"warn",time:4e3,text:"删除用户失败，错误码："+e})})}})},updateLabor:function(e,t,a){this.showUpdateLaborDlg=!0,this.showAddBtn=!1,this.updatelaborItemIndex=t,this.updatelaborIndex=a,this.updateLaborData.laborid=e.laborid,this.updateLaborData.username=e.username,this.updateLaborData.branchname=e.branchname,this.updateLaborData.branchid=e.branchid,this.updateLaborData.price=e.price,this.updateLaborData.startdate=e.startdate,this.updateLaborData.enddate=""===e.enddate?"":e.enddate},afterUpdateLabor:function(){this.showUpdateLaborDlg=!1,this.showAddBtn=this.userinfo.canlabor,this.fetchLabors()},addLabor:function(){this.showAddLaborDlg=!0,this.showAddBtn=!1},afterAddLabor:function(){this.showAddLaborDlg=!1,this.showAddBtn=this.userinfo.canlabor,this.fetchLabors()},addNewExpense:function(e){this.showAddExpenseDlg=!0,this.showAddBtn=!1,this.showExpenseSubmitButton=!0,this.updateLaborData.username=e.username,this.expense.expenseid=null,this.expense.laborid=e.laborid,this.expenseDlgHeader="新增开支",this.expenseDlgTypeEnabled=!0,this.expenseStartDate=e.startdate},expenseTypesCheckChange:function(e,t){0<e.length?(this.selectedExpenseName=t.toString(),this.expense.type=e[0]):this.selectedExpenseName="请选择"},addExpenseBackHandle:function(){this.showAddExpenseDlg=!1,this.expense.expenseid||(this.showAddBtn=this.userinfo.canlabor)},handleSubmitExpense:function(){var e=this;return this.showExpenseSubmitButton=!1,this.expense.laborid?this.expense.type?this.expense.date?(this.$vux.loading.show({text:"正在提交数据..."}),console.log("提交的数据是： "+r()(this.expense)),void H.b.post("/labor/expense",this.expense).then(function(t){e.$vux.loading.hide();var a=t.data.code;if(1e3!==a)1007===a&&(e.showExpenseSubmitButton=!0,e.$vux.toast.show({type:"warn",time:5e3,text:"当前录入的费用支出异常，无法录入！"}));else if(e.showAddExpenseDlg=!1,e.showAddBtn=e.userinfo.canlabor,e.expense.expenseid){var o=e.laborExpenseHistory[e.updateExpenseIndex];o.comments=e.expense.comments,o.date=e.expense.date,o.days=e.expense.days,o.hours=e.expense.hours,o.fees=e.expense.price}}).catch(function(t){alert("录入开支明细失败:"+t),e.$vux.loading.hide(),e.showExpenseSubmitButton=!0})):void this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择支出费用时间，支出费用时间不能为空！"}):void this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择支出费用类型，支出费用类型不能为空！"}):void this.$vux.toast.show({type:"warn",time:5e3,text:"没有选择该费用对应的人工，费用的人工名称不能为空！"})},deleteExpense:function(e,t){var a=e.expenseid;if(a){var o=this;this.$vux.confirm.show({hideOnBlur:!0,title:"删除费用支出明细提示",content:"真的要删除该笔费用明细吗？",onConfirm:function(){H.b.delete("/labor/del/expense/"+a).then(function(e){var a=e.data.code;1e3===a?(o.laborExpenseHistory.splice(t,1),o.$vux.toast.show({time:4e3,text:"删除费用明细成功！"})):o.$vux.toast.show({type:"warn",text:"删除费用明细失败，错误码："+a})}).catch(function(e){o.$vux.toast.show({type:"warn",text:"删除费用明细失败，错误码："+e})})}})}},updateExpense:function(e,t){this.showAddExpenseDlg=!0,this.showAddBtn=!1,this.showExpenseSubmitButton=!0,this.updateExpenseIndex=t,this.expenseDlgHeader="修改开支",this.expenseDlgTypeEnabled=!1,this.expense.expenseid=e.expenseid,this.expense.laborid=this.laborDetaillaborid,this.expense.type=e.expensetypekey,this.expense.date=e.date,this.expense.days=e.days,this.expense.hours=e.hours,this.expense.price=e.fees,this.expense.comments=e.comments,this.selectedExpenseName=e.expensetype},fetchLabors:function(){var e=this;this.$vux.loading.show({text:"获取人工列表数据..."});var t;t=this.userinfo.canlabor?"/labor/labors/"+this.project.key:"/labor/labor/"+this.userinfo.userid+"/"+this.project.key,H.b.get(t).then(function(t){e.$vux.loading.hide(),1e3===t.data.code&&(e.labors=t.data.data)}).catch(function(t){e.$vux.loading.hide(),alert("获取人工列表数据报错："+t)})},handleShowLaborDetailDlg:function(e){this.showLaborDetailDlg=!0,this.showAddBtn=!1,this.laborDetaillaborid=e.laborid,this.updateLaborData.username=e.username,this.expenseStartDate=e.startdate,this.fetchLaborDetail(e)},fetchLaborDetail:function(e){var t=this;this.laborTotalFormHeaderBody=[],this.laborMonthFormHeaderBody=[],H.b.post("/labor/detail",e).then(function(a){var o=a.data.code;if(1e3===o){var r=a.data.data.month,s=a.data.data.total,n=a.data.data.history,i=r.days,d=r.price,l=r.balance,c=r.prices,u=r.absentdays,h=r.overtimehours,p=s.days,b=s.absentdays,m=s.overtimehours,v=s.prices,x=s.balance;t.laborDetailDlgHeaderTitle=""===e.enddate?"今天":e.enddate,t.laborTotalFormHeader=x,t.laborMonthFormHeader=l,t.laborTotalFormHeaderBody.push({label:"进场日期",value:e.startdate}),t.laborTotalFormHeaderBody.push({label:"离场日期",value:t.laborDetailDlgHeaderTitle}),t.laborTotalFormHeaderBody.push({label:"单价(每工日)",value:d}),t.laborTotalFormHeaderBody.push({label:"总工日",value:p}),t.laborTotalFormHeaderBody.push({label:"缺勤(天)",value:b}),t.laborTotalFormHeaderBody.push({label:"加班小时",value:m}),t.laborTotalFormHeaderBody.push({label:"工资总额(元)",value:v}),t.laborMonthFormHeaderBody.push({label:"本月总工日(截止到今天)",value:i}),t.laborMonthFormHeaderBody.push({label:"本月缺勤(天)",value:u}),t.laborMonthFormHeaderBody.push({label:"本月加班小时",value:h}),t.laborMonthFormHeaderBody.push({label:"本月工资总额(元)",value:c}),t.laborMonthFormHeaderBody.push({label:"本月工资余额(元)",value:l}),t.laborExpenseHistory=n}else if(1001===o){var f=a.data.data.price,D=a.data.data.history;t.laborDetailDlgHeaderTitle=""===e.enddate?"今天":e.enddate,t.laborTotalFormHeader="未到进场日期",t.laborMonthFormHeader="未到进场日期",t.laborTotalFormHeaderBody.push({label:"进场日期",value:e.startdate}),t.laborTotalFormHeaderBody.push({label:"离场日期",value:t.laborDetailDlgHeaderTitle}),t.laborTotalFormHeaderBody.push({label:"单价(每工日)",value:f}),t.laborExpenseHistory=D}}).catch(function(e){alert("获取人工支出费用明细出错，错误码："+e)})},covertLaborDetailAmount:function(e){var t=e.expensetypekey;return 1002===t?e.days+"天":1003===t?e.hours+"小时":e.fees+"元"}},mounted:function(){this.$store.dispatch("UpdateShowHeader",!1),this.$store.dispatch("UpdateShowTabbar",!0);var e=E.a.get($.a.StoreUserInfoKey);this.userinfo=e.customerdata,this.showAddBtn=this.userinfo.canlabor,this.showmenuOptions=this.userinfo.canlabor;var t=E.a.get($.a.StoreProject);t?(this.project=t,this.fetchLabors()):this.showProjectSelectDlg=!0}}),C={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("x-header",{attrs:{slot:"header","left-options":{showBack:!0,backText:"返回"},title:"人工动态明细"},slot:"header"},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.showmenuOptions,expression:"showmenuOptions"}],attrs:{slot:"right"},on:{click:function(t){e.menuOptions=!e.menuOptions}},slot:"right"},[a("svg",{staticClass:"vux-x-icon vux-x-icon-navicon",staticStyle:{fill:"#fff",position:"relative",top:"-8px",left:"-3px"},attrs:{type:"navicon",size:"35",xmlns:"http://www.w3.org/2000/svg",width:"35",height:"35",viewBox:"0 0 512 512"}},[a("path",{attrs:{d:"M96 241h320v32H96zm0-96h320v32H96zm0 192h320v32H96z"}})])])]),e._v(" "),e.showAddBtn?a("div",{staticClass:"fixbtn",class:[{hover:e.shouldHover}],on:{mouseenter:function(t){e.shouldHover=!0},mouseleave:function(t){e.shouldHover=!1},click:e.addLabor}},[e._t("default",[a("plus-icon",{staticStyle:{color:"white"}})])],2):e._e(),e._v(" "),a("actionsheet",{attrs:{menus:{copy:"复制地址(电脑端编辑)",excel:"汇总统计"},"close-on-clicking-mask":!0,"show-cancel":""},on:{"on-click-menu":e.clickMenuOptions,"on-after-hide":e.hideMenuOptions},model:{value:e.menuOptions,callback:function(t){e.menuOptions=t},expression:"menuOptions"}}),e._v(" "),a("select-project-dialog",{attrs:{show:e.showProjectSelectDlg},on:{"on-click-back":function(t){e.showProjectSelectDlg=!1},"on-select-project":e.selectProject,"on-click-empty-button":function(t){e.$router.push({name:"pupload"})}}}),e._v(" "),a("group-title",[e._v("当前项目:"+e._s(e.project.value?e.project.value:"未知")+"   "),a("a",{staticStyle:{color:"#00a7f5"},on:{click:function(t){return t.preventDefault(),e.switchProject(t)}}},[e._v("切换项目")])]),e._v(" "),a("group-title",[e._v("人工数据列表")]),e._v(" "),e.labors.count>0?a("div",e._l(e.labors.items,function(t,o){return a("div",{key:o},[a("group-title",{staticClass:"branch-title"},[e._v("工种: "+e._s(t.branchname))]),e._v(" "),a("swipeout",e._l(t.result,function(t,r){return a("swipeout-item",{key:r,attrs:{threshold:.5,"underlay-color":"#ccc"}},[a("div",{attrs:{slot:"right-menu"},slot:"right-menu"},[a("swipeout-button",{attrs:{"background-color":"#336DD6"},nativeOn:{click:function(a){e.addNewExpense(t)}}},[e._v("支出")]),e._v(" "),a("swipeout-button",{attrs:{type:"primary"},nativeOn:{click:function(a){e.updateLabor(t,o,r)}}},[e._v("修改")]),e._v(" "),a("swipeout-button",{attrs:{"background-color":"#D23934"},nativeOn:{click:function(a){e.deleteLabor(t,o,r)}}},[e._v("删除")])],1),e._v(" "),a("div",{staticClass:"demo-content vux-1px-tb",attrs:{slot:"content"},slot:"content"},[a("cell",{attrs:{title:t.username,"inline-desc":"工种名称: "+t.branchname+", 人工单价："+t.price+"/工日, 进场日期："+t.startdate+", 离场日期："+(t.enddate?t.enddate:"无"),"is-link":""},nativeOn:{click:function(a){e.handleShowLaborDetailDlg(t)}}})],1)])}))],1)})):a("div",[a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("load-more",{attrs:{"show-loading":!1,tip:"没有人工数据！","background-color":"#fbf9fe"}}),e._v(" "),a("flexbox",[a("flexbox-item"),e._v(" "),e.userinfo.canlabor?a("flexbox-item",[a("x-button",{attrs:{type:"primary","action-type":"button",mini:""},nativeOn:{click:function(t){return e.addLabor(t)}}},[e._v("新建人工\n        ")])],1):e._e(),e._v(" "),a("flexbox-item")],1)],1),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.showLaborDetailDlg,callback:function(t){e.showLaborDetailDlg=t},expression:"showLaborDetailDlg"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0},title:"人工费用明细"},on:{"on-click-back":function(t){e.showLaborDetailDlg=!1,e.showAddBtn=e.userinfo.canlabor}}}),e._v(" "),a("group-title",[e._v("以下数据截止离场日期: "+e._s(e.laborDetailDlgHeaderTitle))]),e._v(" "),a("form-preview",{attrs:{"header-label":"余款(元)","header-value":e.laborTotalFormHeader,"body-items":e.laborTotalFormHeaderBody}}),e._v(" "),a("form-preview",{attrs:{"header-label":"本月余款(元)","header-value":e.laborMonthFormHeader,"body-items":e.laborMonthFormHeaderBody}}),e._v(" "),a("group",{attrs:{title:"支出费用明细"}},[e.laborExpenseHistory.length>0?a("swipeout",e._l(e.laborExpenseHistory,function(t,o){return a("swipeout-item",{key:o,attrs:{threshold:.5,"underlay-color":"#ccc"}},[a("div",{attrs:{slot:"right-menu"},slot:"right-menu"},[a("swipeout-button",{attrs:{"background-color":"#D23934"},nativeOn:{click:function(a){e.deleteExpense(t,o)}}},[e._v("删除")]),e._v(" "),a("swipeout-button",{attrs:{type:"primary"},nativeOn:{click:function(a){e.updateExpense(t,o)}}},[e._v("修改")])],1),e._v(" "),a("div",{staticClass:"demo-content vux-1px-tb",attrs:{slot:"content"},slot:"content"},[a("cell",{attrs:{title:t.expensetype,"inline-desc":t.comments?"["+t.comments+"]":""}},[a("div",[a("span",[e._v(e._s(e.covertLaborDetailAmount(t)))]),a("br"),e._v(" "),a("span",[e._v(e._s(t.date))])])])],1)])})):a("div",[a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("load-more",{attrs:{"show-loading":!1,tip:"没有任何费用明细记录!","background-color":"#fbf9fe"}})],1)],1)],1)],1),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.showAddExpenseDlg,callback:function(t){e.showAddExpenseDlg=t},expression:"showAddExpenseDlg"}},[a("x-header",{attrs:{title:e.expenseDlgHeader,"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":e.addExpenseBackHandle}},[e.showExpenseSubmitButton?a("span",{staticStyle:{"font-size":"18px"},attrs:{slot:"right"},on:{click:e.handleSubmitExpense},slot:"right"},[e._v("\n          保存\n        ")]):a("spinner",{attrs:{slot:"right",type:"android",size:"28px"},slot:"right"})],1),e._v(" "),a("group",{attrs:{title:"支出费用基本信息"}},[a("cell",{attrs:{title:"人工姓名"},model:{value:e.updateLaborData.username,callback:function(t){e.$set(e.updateLaborData,"username",t)},expression:"updateLaborData.username"}}),e._v(" "),e.expenseDlgTypeEnabled?a("cell",{attrs:{title:"选择一个支出的类型","inline-desc":"请选择一个费用支出类型(必选)",value:e.selectedExpenseName,"is-link":""},nativeOn:{click:function(t){e.showAddExpenseDlgForTypePickUpDlg=!0}}}):a("cell",{attrs:{title:"选择一个支出的类型","inline-desc":"请选择一个费用支出类型(必选)",value:e.selectedExpenseName,"is-link":""}}),e._v(" "),[1e3,1001,1004].indexOf(e.expense.type)>=0?a("x-input",{attrs:{title:"支出费用",placeholder:"输入人工的单价",min:0},model:{value:e.expense.price,callback:function(t){e.$set(e.expense,"price",t)},expression:"expense.price"}},[a("span",{attrs:{slot:"right"},slot:"right"},[e._v("元")])]):e._e(),e._v(" "),[1002].indexOf(e.expense.type)>=0?a("x-input",{attrs:{title:"缺勤天数",placeholder:"输入缺勤的天数",min:0},model:{value:e.expense.days,callback:function(t){e.$set(e.expense,"days",t)},expression:"expense.days"}},[a("span",{attrs:{slot:"right"},slot:"right"},[e._v("天")])]):e._e(),e._v(" "),[1003].indexOf(e.expense.type)>=0?a("x-input",{attrs:{title:"加班时间",placeholder:"输入该加班的时间",min:0},model:{value:e.expense.hours,callback:function(t){e.$set(e.expense,"hours",t)},expression:"expense.hours"}},[a("span",{attrs:{slot:"right"},slot:"right"},[e._v("小时")])]):e._e(),e._v(" "),a("datetime",{attrs:{"min-year":2018,format:"YYYY-MM-DD",title:"费用时间",placeholder:"输入该支出费用的时间","start-date":e.expenseStartDate},model:{value:e.expense.date,callback:function(t){e.$set(e.expense,"date",t)},expression:"expense.date"}}),e._v(" "),a("x-textarea",{attrs:{max:150,placeholder:"输入该部分费用的一些额外备注信息"},model:{value:e.expense.comments,callback:function(t){e.$set(e.expense,"comments","string"==typeof t?t.trim():t)},expression:"expense.comments"}})],1)],1)],1),e._v(" "),a("labor-dialog",{attrs:{update:e.showUpdateLaborDlg,updateLaborData:e.updateLaborData},on:{"on-click-update-back":function(t){e.showUpdateLaborDlg=!1,e.showAddBtn=e.userinfo.canlabor},"on-click-after-back":function(t){e.showAddBtn=e.userinfo.canlabor},"after-update":e.afterUpdateLabor}}),e._v(" "),a("labor-dialog",{attrs:{add:e.showAddLaborDlg},on:{"on-click-add-back":function(t){e.showAddLaborDlg=!1,e.showAddBtn=e.userinfo.canlabor},"after-add":e.afterAddLabor}}),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.showAddExpenseDlgForTypePickUpDlg,callback:function(t){e.showAddExpenseDlgForTypePickUpDlg=t},expression:"showAddExpenseDlgForTypePickUpDlg"}},[a("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(t){e.showAddExpenseDlgForTypePickUpDlg=!1}}},[e._v("\n        可选支出费用类型列表\n      ")]),e._v(" "),a("search-check-list",{attrs:{data:e.expenseTypes,keyword:"支出",max:1},on:{"on-change":e.expenseTypesCheckChange},model:{value:e.expenseTypesModel,callback:function(t){e.expenseTypesModel=t},expression:"expenseTypesModel"}})],1)],1)],1)},staticRenderFns:[]};var I=a("./node_modules/vue-loader/lib/component-normalizer.js")(Y,C,!1,function(e){a('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-044f0194","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/LaborsEnter.vue')},"data-v-044f0194",null);t.default=I.exports}});