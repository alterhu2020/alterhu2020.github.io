<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx Linux安装及其环境配置 | 堆栈云</title>
    <meta name="description" content="人生处万类，知识最为贤。 —— 韩愈">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="堆栈云">
  <link rel="stylesheet" href="/fonts/fonts.css">
  <link rel="icon" href="/favicon.ico">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="apple-touch-icon" href="/img/logo.png">
  <meta property="keywords" content="堆栈云,java,博客,技术培训,前端培训,后端培训,ionic,springboot,vue,小程序,安卓app,苹果App,技术博客,分享,vuejs,python,灵鸽,爬虫,python爬虫">
  <meta property="description" content="堆栈云，点滴记录贵在坚持">
  <script id="cookieinfo" src="https://cookieinfoscript.com/js/cookieinfo.min.js" data-message="我们使用cookies来提高用户体验,继续浏览网站表示同意我们使用cookies." data-linkmsg="了解更多" data-bg="#645862" data-fg="#FFFFFF" data-link="#F1D600" data-cookie="CookieInfoScript" data-text-align="left" data-close-text="知道了!"></script>
  <script async="true" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script async="true" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>(adsbygoogle = window.adsbygoogle || []).push({  google_ad_client: 'ca-pub-1893384651266286',  enable_page_level_ads: true });</script>
    <meta property="article:modified_time" content="Thu Oct 24 2019 10:30:02 GMT+0800 (GMT+08:00)"><meta property="og:site_name" content="堆栈云"><meta property="og:title" content="Nginx Linux安装及其环境配置"><meta property="og:type" content="article"><meta property="og:url" content="/blog/setup/nginx.html"><meta name="twitter:title" content="Nginx Linux安装及其环境配置"><meta name="twitter:url" content="/blog/setup/nginx.html"><meta name="twitter:card" content="summary_large_image">
    <link rel="preload" href="/assets/css/0.styles.e064409b.css" as="style"><link rel="preload" href="/assets/js/app.017aad9b.js" as="script"><link rel="preload" href="/assets/js/4.aba833a4.js" as="script"><link rel="preload" href="/assets/js/3.107e6c4e.js" as="script"><link rel="preload" href="/assets/js/50.803ad9fe.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.e064409b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">堆栈云</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/CHANGELOG.html" class="nav-link">历史更新</a></div><div class="nav-item"><a href="/contact-me/" class="nav-link">留言板</a></div><div class="nav-item"><a href="https://code.pingbook.top/ant-design-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant-design-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://code.pingbook.top/ionic-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ionic-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/CHANGELOG.html" class="nav-link">历史更新</a></div><div class="nav-item"><a href="/contact-me/" class="nav-link">留言板</a></div><div class="nav-item"><a href="https://code.pingbook.top/ant-design-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant-design-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://code.pingbook.top/ionic-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ionic-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" class="sidebar-link">关于博客</a></li><li><a href="/blog/synax.html" class="sidebar-link">语法参考手册</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术版本更新</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/release/jdk.html" class="sidebar-link">JDK版本新特性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>环境配置和部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/setup/wordpress.html" class="sidebar-link">Wordpress Linux命令其环境配置</a></li><li><a href="/blog/setup/raspberry.html" class="sidebar-link">Raspberry Linux安装及其环境配置</a></li><li><a href="/blog/setup/linux.html" class="sidebar-link">Debian Linux命令其环境配置</a></li><li><a href="/blog/setup/nginx.html" class="active sidebar-link">Nginx Linux安装及其环境配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/setup/nginx.html#nginx安装步骤" class="sidebar-link">Nginx安装步骤</a></li><li class="sidebar-sub-header"><a href="/blog/setup/nginx.html#安装nginx-service服务" class="sidebar-link">安装nginx.service服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/setup/nginx.html#参考配置文件：-nginxconfig助手" class="sidebar-link">参考配置文件： nginxconfig助手</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/setup/nginx.html#配置501-404默认页面" class="sidebar-link">配置501,404默认页面</a></li></ul></li><li><a href="/blog/setup/python.html" class="sidebar-link">Python Linux安装及其环境配置</a></li><li><a href="/blog/setup/mysql.html" class="sidebar-link">Debian MYSQL8安装及其环境配置</a></li><li><a href="/blog/setup/node-nuxt.html" class="sidebar-link">nuxt生产环境安装及其配置</a></li><li><a href="/blog/setup/uwsgi.html" class="sidebar-link">Uwsgi Linux安装及其环境配置</a></li><li><a href="/blog/setup/tomcat.html" class="sidebar-link">Tomcat Linux安装及其环境配置</a></li><li><a href="/blog/setup/redis.html" class="sidebar-link">Redis Linux安装及其环境配置</a></li><li><a href="/blog/setup/sqlalchemy.html" class="sidebar-link">SQLAlchemy Linux安装及其环境配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>2019年归档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019/how-to-remove-search-index-forever.html" class="sidebar-link">/blog/2019/how-to-remove-search-index-forever.html</a></li><li><a href="/blog/2019/spring-list-params-same-key.html" class="sidebar-link">springboot List param或者http Get请求相同的参数名称覆盖不能发送</a></li><li><a href="/blog/2019/how-to-cross-gfw.html" class="sidebar-link">可用的科学上网,翻墙方式(2019年最新更新)</a></li><li><a href="/blog/2019/07-04-what.html" class="sidebar-link">7月4日整理</a></li><li><a href="/blog/2019/06-29-what.html" class="sidebar-link">6月29日整理</a></li><li><a href="/blog/2019/06-26-what.html" class="sidebar-link">6月26日整理</a></li><li><a href="/blog/2019/06-22-what.html" class="sidebar-link">6月22日整理</a></li><li><a href="/blog/2019/06-21-what.html" class="sidebar-link">6月21日整理</a></li><li><a href="/blog/2019/06-17-what.html" class="sidebar-link">6月17日整理</a></li><li><a href="/blog/2019/06-13-what.html" class="sidebar-link">6月13日整理</a></li><li><a href="/blog/2019/06-12-what.html" class="sidebar-link">6月12日整理</a></li><li><a href="/blog/2019/06-09-what.html" class="sidebar-link">6月9日整理</a></li><li><a href="/blog/2019/06-02-what.html" class="sidebar-link">6月2日整理</a></li><li><a href="/blog/2019/06-01-what.html" class="sidebar-link">6月1日整理</a></li><li><a href="/blog/2019/05-31-what.html" class="sidebar-link">5月31日整理</a></li><li><a href="/blog/2019/05-29-what.html" class="sidebar-link">5月29日整理</a></li><li><a href="/blog/2019/05-26-what.html" class="sidebar-link">5月26日整理</a></li><li><a href="/blog/2019/05-25-what.html" class="sidebar-link">5月25日整理</a></li><li><a href="/blog/2019/05-24-what.html" class="sidebar-link">5月24日整理</a></li><li><a href="/blog/2019/05-22-what.html" class="sidebar-link">5月22日整理</a></li><li><a href="/blog/2019/05-20-what.html" class="sidebar-link">5月20日整理</a></li><li><a href="/blog/2019/05-15-what.html" class="sidebar-link">5月15日整理</a></li><li><a href="/blog/2019/05-14-what.html" class="sidebar-link">5月14日整理</a></li><li><a href="/blog/2019/05-11-what.html" class="sidebar-link">5月11日整理</a></li><li><a href="/blog/2019/05-10-what.html" class="sidebar-link">5月10日整理</a></li><li><a href="/blog/2019/05-09-what.html" class="sidebar-link">5月9日整理</a></li><li><a href="/blog/2019/05-06-what.html" class="sidebar-link">5月6日整理</a></li><li><a href="/blog/2019/05-04-what.html" class="sidebar-link">5月4日整理</a></li><li><a href="/blog/2019/05-02-what.html" class="sidebar-link">5月2日整理</a></li><li><a href="/blog/2019/04-30-what.html" class="sidebar-link">4月30日整理</a></li><li><a href="/blog/2019/04-29-what.html" class="sidebar-link">4月29日整理</a></li><li><a href="/blog/2019/04-28-what.html" class="sidebar-link">4月28日整理</a></li><li><a href="/blog/2019/04-26-what.html" class="sidebar-link">4月26日整理</a></li></ul></section></li><li><a href="/blog/todo/" class="sidebar-link">亟待处理</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/tools/idea.html" class="sidebar-link">【开发工具】IDEA</a></li><li><a href="/blog/tools/vscode.html" class="sidebar-link">【开发工具】VS Code</a></li><li><a href="/blog/tools/ps.html" class="sidebar-link">【设计工具】PhotoShop</a></li></ul></section></li><li><a href="/blog/video/" class="sidebar-link">优秀影视作品集</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>友情链接</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://mybatis.plus/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【后端】Mybatis Plus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="http://www.ruanyifeng.com/blog/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】阮一峰博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://www.jianshu.com/u/4ca93d60a9fe" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】IT晴天<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】awesome vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://ionicframework.com/docs/components" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】Ionic Vue Components<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/vueComponent/ant-design-vue-awesome" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】awesome ant-design-vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/ulivz/awesome-vuepress" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】awesome-vuepress<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【其它】程序员的工具集<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><p>参考：<a href="https://serverfault.com/questions/214242/can-i-hide-all-server-os-info/279389#279389" target="_blank" rel="noopener noreferrer">修改nginx的Server名称,修改两个文件:ngx_http_header_filter_module.c和nginx.h<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="nginx安装步骤"><a href="#nginx安装步骤" aria-hidden="true" class="header-anchor">#</a> Nginx安装步骤</h2> <div class="language- extra-class"><pre class="language-text"><code>$ cd /opt
$ sudo mkdir nginx-modules
$ cd nginx-modules
删除$ wget https://github.com/openresty/headers-more-nginx-module/archive/v0.33.tar.gz 
删除$ tar xvf v0.33.tar.gz headers-more-nginx-module-0.33

$ wget http://zlib.net/zlib-1.2.11.tar.gz
$ tar xvf zlib-1.2.11.tar.gz
$ apt install git
$ git clone https://github.com/eustas/ngx_brotli
$ cd ngx_brotli &amp;&amp; git submodule update --init

$ cd ..
$ wget https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz
$ tar xvf pcre-8.43.tar.gz

$ wget https://www.openssl.org/source/openssl-1.1.1c.tar.gz
$ tar xvf openssl-1.1.1c.tar.gz
$ sudo apt install build-essential -y
--- 以下配置可参考： [Compile from source](https://github.com/jukbot/setup-nginx-webserver/blob/master/README.md)
$ wget http://nginx.org/download/nginx-1.17.3.tar.gz
$ tar zxvf nginx-1.17.3.tar.gz
$ cd nginx-1.17.3/src/http/
$ nano ngx_http_header_filter_module.c
$ sudo nano src/core/nginx.h
$ sudo nano src/http/ngx_http_special_response.c
$ sudo mkdir /var/lib/nginx
$ ./configure --prefix=/usr/local/nginx \
            --sbin-path=/usr/sbin/nginx \
            --modules-path=/usr/lib/nginx/modules \
            --conf-path=/etc/nginx/nginx.conf \
            --error-log-path=/var/log/nginx/error.log \
            --http-log-path=/var/log/nginx/access.log \
            --pid-path=/run/nginx.pid \
            --lock-path=/var/lock/nginx.lock \
            --user=www-data \
            --group=www-data \
            --http-client-body-temp-path=/var/lib/nginx/body \
            --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \
            --http-proxy-temp-path=/var/lib/nginx/proxy \
            --http-scgi-temp-path=/var/lib/nginx/scgi \
            --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \
            --with-openssl=../nginx-modules/openssl-1.1.1c \
            --with-openssl-opt=enable-ec_nistp_64_gcc_128 \
            --with-openssl-opt=no-nextprotoneg \
            --with-openssl-opt=no-weak-ssl-ciphers \
            --with-openssl-opt=no-ssl3 \
            --with-pcre=../nginx-modules/pcre-8.43 \
            --with-pcre-jit \
            --with-zlib=../nginx-modules/zlib-1.2.11 \
            --with-compat \
            --with-file-aio \
            --with-threads \
            --with-http_addition_module \
            --with-http_auth_request_module \
            --with-http_dav_module \
            --with-http_flv_module \
            --with-http_mp4_module \
            --with-http_gunzip_module \
            --with-http_gzip_static_module \
            --with-http_random_index_module \
            --with-http_realip_module \
            --with-http_slice_module \
            --with-http_ssl_module \
            --with-http_sub_module \
            --with-http_stub_status_module \
            --with-http_v2_module \
            --with-http_secure_link_module \
            --with-mail \
            --with-mail_ssl_module \
            --with-stream \
            --with-stream_realip_module \
            --with-stream_ssl_module \
            --with-stream_ssl_preread_module \
            --with-debug \
            --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' \
            --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' \
            --add-module=../nginx-modules/ngx_brotli

$ make   #这个操作需要花费十分钟左右 
$ sudo make install 
$ ~useradd -d /etc/nginx/ -s /sbin/nologin nginx~
</code></pre></div><h2 id="安装nginx-service服务"><a href="#安装nginx-service服务" aria-hidden="true" class="header-anchor">#</a> 安装nginx.service服务</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>$ <span class="token function">sudo</span>  <span class="token function">nano</span> /lib/systemd/system/nginx.service 
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>A high performance web server and a reverse proxy server
Documentation<span class="token operator">=</span>man:nginx<span class="token punctuation">(</span>8<span class="token punctuation">)</span>
After<span class="token operator">=</span>network.target

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Type<span class="token operator">=</span>forking
PIDFile<span class="token operator">=</span>/run/nginx.pid
ExecStartPre<span class="token operator">=</span>/usr/sbin/nginx -t -q -g <span class="token string">'daemon on; master_process on;'</span>
ExecStartPost<span class="token operator">=</span>/bin/sleep 0.1
ExecStart<span class="token operator">=</span>/usr/sbin/nginx -g <span class="token string">'daemon on; master_process on;'</span>
ExecReload<span class="token operator">=</span>/usr/sbin/nginx -g <span class="token string">'daemon on; master_process on;'</span> -s reload
ExecStop<span class="token operator">=</span>-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid
TimeoutStopSec<span class="token operator">=</span>5
KillMode<span class="token operator">=</span>mixed

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi-user.target

</code></pre></div><blockquote><p>nginx.service: Failed to read PID from file /run/nginx.pid: Invalid argument</p></blockquote> <p>That warning with the nginx.pid file is a know bug (at least for Ubutnu if not for other distros as well). More details here: https://bugs.launchpad.net/ubuntu/+source/nginx/+bug/1581864</p> <p>Workaround (on a ssh console, as root, use the commands bellow):</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> /etc/systemd/system/nginx.service.d
<span class="token function">printf</span> <span class="token string">&quot;[Service]\nExecStartPost=/bin/sleep 0.1\n&quot;</span> <span class="token operator">&gt;</span> /etc/systemd/system/nginx.service.d/override.conf
systemctl daemon-reload
systemctl restart nginx 

</code></pre></div><h1 id="nginx配置助手"><a href="#nginx配置助手" aria-hidden="true" class="header-anchor">#</a> nginx配置助手</h1> <div class="language-shell extra-class"><pre class="language-shell"><code>-- 参考地址<span class="token punctuation">[</span>安装certbot<span class="token punctuation">]</span><span class="token punctuation">(</span>https://certbot.eff.org/lets-encrypt/debianstretch-nginx<span class="token punctuation">)</span>
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> certbot

</code></pre></div><h3 id="参考配置文件：-nginxconfig助手"><a href="#参考配置文件：-nginxconfig助手" aria-hidden="true" class="header-anchor">#</a> 参考配置文件： <a href="https://nginxconfig.io/?0.domain=pingbook.top&amp;0.path=%2Fwww&amp;0.document_root=%2Fpingbook.top&amp;0.redirect=false&amp;0.email=alterhu2020@gmail.com&amp;0.php=false&amp;0.proxy_path=%2Fproxy&amp;0.proxy_pass=http:%2F%2F127.0.0.1:9000&amp;0.fallback_html&amp;0.access_log_domain&amp;0.error_log_domain&amp;directory_letsencrypt=%2Fwww%2F_letsencrypt%2F&amp;server_tokens&amp;limit_req&amp;brotli&amp;log_not_found&amp;client_max_body_size=320&amp;symlink=false" target="_blank" rel="noopener noreferrer">nginxconfig助手<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <div class="language- extra-class"><pre class="language-text"><code></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Symlink vhost配置文件</p> <p>注意: 在<code>Symlink vhost</code> 中不要勾选enable。</p></div> <h1 id="其他"><a href="#其他" aria-hidden="true" class="header-anchor">#</a> 其他</h1> <h2 id="配置501-404默认页面"><a href="#配置501-404默认页面" aria-hidden="true" class="header-anchor">#</a> 配置501,404默认页面</h2> <p>参考链接: <a href="https://blog.adriaan.io/one-nginx-error-page-to-rule-them-all.html" target="_blank" rel="noopener noreferrer">One NGINX error page to rule them all<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- extra-class"><pre class="language-text"><code>$ nano /etc/nginx/nginx.conf
# Generated by nginxconfig.io
# https://nginxconfig.io/?0.domain=pingbook.top&amp;0.path=%2Fwww&amp;0.redirect=false&amp;0.email=alterhu2020@gmail.com&amp;0.php=false&amp;0.proxy&amp;0.proxy_path=%2Fproxy&amp;0.proxy_pass=http:%2F%2F127.0.0.1:9000&amp;0.fallback_html&amp;0.access_log_domain&amp;0.error_log_domain&amp;directory_letsencrypt=%2Fwww%2F_letsencrypt%2F&amp;limit_req&amp;brotli&amp;log_not_found&amp;client_max_body_size=32&amp;symlink=false

user www-data;
pid /run/nginx.pid;
worker_processes auto;
worker_rlimit_nofile 65535;

events {
	multi_accept on;
	worker_connections 65535;
}

http {
	charset utf-8;
	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;
	server_tokens off;
	types_hash_max_size 2048;
	client_max_body_size 32M;

	# MIME
	include mime.types;
	default_type application/octet-stream;

	# logging
	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log warn;

	# limits
	limit_req_log_level warn;
	limit_req_zone $binary_remote_addr zone=login:10m rate=10r/m;

	# SSL
	ssl_session_timeout 1d;
	ssl_session_cache shared:SSL:10m;
	ssl_session_tickets off;

	# Diffie-Hellman parameter for DHE ciphersuites
	ssl_dhparam /etc/nginx/dhparam.pem;

	# Mozilla Intermediate configuration
	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;

	# OCSP Stapling
	ssl_stapling on;
	ssl_stapling_verify on;
	resolver 1.1.1.1 1.0.0.1 8.8.8.8 8.8.4.4 208.67.222.222 208.67.220.220 valid=60s;
	resolver_timeout 2s;
        
     # error pages
	map $status $status_text {
		400 'Bad Request';
		401 'Unauthorized';
		402 'Payment Required';
		403 'Forbidden';
		404 'Not Found';
		405 'Method Not Allowed';
		406 'Not Acceptable';
		407 'Proxy Authentication Required';
		408 'Request Timeout';
		409 'Conflict';
		410 'Gone';
		411 'Length Required';
		412 'Precondition Failed';
		413 'Payload Too Large';
		414 'URI Too Long';
		415 'Unsupported Media Type';
		416 'Range Not Satisfiable';
		417 'Expectation Failed';
		418 'I\'m a teapot';
		421 'Misdirected Request';
		422 'Unprocessable Entity';
		423 'Locked';
		424 'Failed Dependency';
		426 'Upgrade Required';
		428 'Precondition Required';
		429 'Too Many Requests';
		431 'Request Header Fields Too Large';
		451 'Unavailable For Legal Reasons';
		500 'Internal Server Error';
		501 'Not Implemented';
		502 'Bad Gateway';
		503 'Service Unavailable';
		504 'Gateway Timeout';
		505 'HTTP Version Not Supported';
		506 'Variant Also Negotiates';
		507 'Insufficient Storage';
		508 'Loop Detected';
		510 'Not Extended';
		511 'Network Authentication Required';
		default 'Oppos, Something is wrong';
        }

	# load configs
	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}

</code></pre></div><p>in the <code>/etc/nginx/nginxconfig.io/general.conf</code> file, put code as following also create file: <code>error.html</code> in directory: <code>/www/_error</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 421 422 423 424 426 428 429 431 451 500 501 502 503 504 505 506 507 508 510 511 /error.html;

location = /error.html {
  ssi on;
  internal;
  root /www/_error;
}

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">10/24/2019, 10:30:02 AM</span></div> <div style="text-align: center; margin-left: 20px;color: #2c3e50;font-weight: 300;font-size: 15px;"><span id="busuanzi_container_page_pv">
        本文浏览量
        <span id="busuanzi_value_page_pv"></span>次
      </span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/setup/linux.html" class="prev">Debian Linux命令其环境配置</a></span> <span class="next"><a href="/blog/setup/python.html">Python Linux安装及其环境配置</a>→
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.017aad9b.js" defer></script><script src="/assets/js/4.aba833a4.js" defer></script><script src="/assets/js/3.107e6c4e.js" defer></script><script src="/assets/js/50.803ad9fe.js" defer></script>
  </body>
</html>
