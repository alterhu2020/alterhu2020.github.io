(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{310:function(t,n,e){"use strict";e.r(n);var r=e(6),i=Object(r.a)({},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("参考："),e("a",{attrs:{href:"https://serverfault.com/questions/214242/can-i-hide-all-server-os-info/279389#279389",target:"_blank",rel:"noopener noreferrer"}},[t._v("修改nginx的Server名称,修改两个文件:ngx_http_header_filter_module.c和nginx.h"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"nginx安装步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx安装步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" Nginx安装步骤")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ cd /opt\n$ sudo mkdir nginx-modules\n$ cd nginx-modules\n\n// zlib安装\n$ wget http://zlib.net/zlib-1.2.11.tar.gz\n$ tar xvf zlib-1.2.11.tar.gz\n\n// ngx-brotli安装\n$ apt install git\n$ git clone https://github.com/google/ngx_brotli\n$ cd ngx_brotli && git submodule update --init --recursive --progress\n\n// pcre安装\n$ cd ..\n$ wget https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz\n$ tar xvf pcre-8.43.tar.gz\n\n// OpenSSL安装\n$ wget https://www.openssl.org/source/openssl-1.1.1c.tar.gz\n$ tar xvf openssl-1.1.1c.tar.gz\n$ sudo apt install build-essential -y\n\n// nginx安装\n配置可参考： [Compile from source](https://github.com/jukbot/setup-nginx-webserver/blob/master/README.md)\n$ wget http://nginx.org/download/nginx-1.17.3.tar.gz\n$ tar zxvf nginx-1.17.3.tar.gz\n$ cd nginx-1.17.3/src/http/\n$ nano ngx_http_header_filter_module.c\n$ sudo nano src/core/nginx.h\n$ sudo nano src/http/ngx_http_special_response.c\n$ sudo mkdir /var/lib/nginx\n\n// 运行安装\n$ ./configure --prefix=/usr/local/nginx \\\n            --sbin-path=/usr/sbin/nginx \\\n            --modules-path=/usr/lib/nginx/modules \\\n            --conf-path=/etc/nginx/nginx.conf \\\n            --error-log-path=/var/log/nginx/error.log \\\n            --http-log-path=/var/log/nginx/access.log \\\n            --pid-path=/run/nginx.pid \\\n            --lock-path=/var/lock/nginx.lock \\\n            --user=www-data \\\n            --group=www-data \\\n            --http-client-body-temp-path=/var/lib/nginx/body \\\n            --http-fastcgi-temp-path=/var/lib/nginx/fastcgi \\\n            --http-proxy-temp-path=/var/lib/nginx/proxy \\\n            --http-scgi-temp-path=/var/lib/nginx/scgi \\\n            --http-uwsgi-temp-path=/var/lib/nginx/uwsgi \\\n            --with-openssl=../nginx-modules/openssl-1.1.1c \\\n            --with-openssl-opt=enable-ec_nistp_64_gcc_128 \\\n            --with-openssl-opt=no-nextprotoneg \\\n            --with-openssl-opt=no-weak-ssl-ciphers \\\n            --with-openssl-opt=no-ssl3 \\\n            --with-pcre=../nginx-modules/pcre-8.43 \\\n            --with-pcre-jit \\\n            --with-zlib=../nginx-modules/zlib-1.2.11 \\\n            --with-compat \\\n            --with-file-aio \\\n            --with-threads \\\n            --with-http_addition_module \\\n            --with-http_auth_request_module \\\n            --with-http_dav_module \\\n            --with-http_flv_module \\\n            --with-http_mp4_module \\\n            --with-http_gunzip_module \\\n            --with-http_gzip_static_module \\\n            --with-http_random_index_module \\\n            --with-http_realip_module \\\n            --with-http_slice_module \\\n            --with-http_ssl_module \\\n            --with-http_sub_module \\\n            --with-http_stub_status_module \\\n            --with-http_v2_module \\\n            --with-http_secure_link_module \\\n            --with-mail \\\n            --with-mail_ssl_module \\\n            --with-stream \\\n            --with-stream_realip_module \\\n            --with-stream_ssl_module \\\n            --with-stream_ssl_preread_module \\\n            --with-debug \\\n            --with-cc-opt='-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2' \\\n            --with-ld-opt='-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now' \\\n            --add-module=../nginx-modules/ngx_brotli\n\n$ make   #这个操作需要花费十分钟左右 \n$ sudo make install \n")])])]),e("h2",{attrs:{id:"安装nginx-service服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx-service服务","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装nginx.service服务")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo  nano /lib/systemd/system/nginx.service \n[Unit]\nDescription=A high performance web server and a reverse proxy server\nDocumentation=man:nginx(8)\nAfter=network.target\n\n[Service]\nType=forking\nPIDFile=/run/nginx.pid\nExecStartPre=/usr/sbin/nginx -t -q -g 'daemon on; master_process on;'\nExecStartPost=/bin/sleep 0.1\nExecStart=/usr/sbin/nginx -g 'daemon on; master_process on;'\nExecReload=/usr/sbin/nginx -g 'daemon on; master_process on;' -s reload\nExecStop=-/sbin/start-stop-daemon --quiet --stop --retry QUIT/5 --pidfile /run/nginx.pid\nTimeoutStopSec=5\nKillMode=mixed\n\n[Install]\nWantedBy=multi-user.target\n\n")])])]),e("blockquote",[e("p",[t._v("nginx.service: Failed to read PID from file /run/nginx.pid: Invalid argument")])]),t._v(" "),e("p",[t._v("That warning with the nginx.pid file is a know bug (at least for Ubutnu if not for other distros as well). More details here: https://bugs.launchpad.net/ubuntu/+source/nginx/+bug/1581864")]),t._v(" "),e("p",[t._v("Workaround (on a ssh console, as root, use the commands bellow):")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('mkdir /etc/systemd/system/nginx.service.d\nprintf "[Service]\\nExecStartPost=/bin/sleep 0.1\\n" > /etc/systemd/system/nginx.service.d/override.conf\nsystemctl daemon-reload\nsystemctl restart nginx \n\n')])])]),e("h1",{attrs:{id:"nginx配置助手"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置助手","aria-hidden":"true"}},[t._v("#")]),t._v(" nginx配置助手")]),t._v(" "),e("ol",[e("li",[t._v("安装cerbot配置SSL")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("$ sudo apt-get install certbot\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("配置nginx和SSL")])]),t._v(" "),e("p",[t._v("参考配置文件,每次只需要修改对应的域名(Domain)和目录(Path):\n"),e("a",{attrs:{href:"https://www.digitalocean.com/community/tools/nginx#?0.domain=pingbook.top&0.path=%2Fwww%2Fpingbook%2Fweb%2Fwww.pingbook.top&0.document_root=&0.redirect=false&0.email=alterhu2020@gmail.com&0.php=false&0.proxy&0.index=index.html&0.fallback_html&0.access_log_domain&0.error_log_domain&directory_letsencrypt=%2Fwww%2F_letsencrypt%2F&brotli&log_not_found&client_max_body_size=160&symlink=false",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginxconfig助手"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"warning custom-block"},[e("p",{staticClass:"custom-block-title"},[t._v("Symlink vhost配置文件")]),t._v(" "),e("p",[t._v("注意: 在"),e("code",[t._v("Symlink vhost")]),t._v(" 中不要勾选enable。\n完成以上的配置后不行看任意修改文件")])]),t._v(" "),e("h2",{attrs:{id:"配置501-404默认页面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置501-404默认页面","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置501,404默认页面")]),t._v(" "),e("p",[t._v("修改文件: "),e("code",[t._v("/etc/nginx/nginx.conf")]),t._v(",参考链接: "),e("a",{attrs:{href:"https://blog.adriaan.io/one-nginx-error-page-to-rule-them-all.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("One NGINX error page to rule them all"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("\nhttp {\n     # error pages\n\tmap $status $status_text {\n\t\t400 'Bad Request';\n\t\t401 'Unauthorized';\n\t\t402 'Payment Required';\n\t\t403 'Forbidden';\n\t\t404 'Not Found';\n\t\t405 'Method Not Allowed';\n\t\t406 'Not Acceptable';\n\t\t407 'Proxy Authentication Required';\n\t\t408 'Request Timeout';\n\t\t409 'Conflict';\n\t\t410 'Gone';\n\t\t411 'Length Required';\n\t\t412 'Precondition Failed';\n\t\t413 'Payload Too Large';\n\t\t414 'URI Too Long';\n\t\t415 'Unsupported Media Type';\n\t\t416 'Range Not Satisfiable';\n\t\t417 'Expectation Failed';\n\t\t418 'I\\'m a teapot';\n\t\t421 'Misdirected Request';\n\t\t422 'Unprocessable Entity';\n\t\t423 'Locked';\n\t\t424 'Failed Dependency';\n\t\t426 'Upgrade Required';\n\t\t428 'Precondition Required';\n\t\t429 'Too Many Requests';\n\t\t431 'Request Header Fields Too Large';\n\t\t451 'Unavailable For Legal Reasons';\n\t\t500 'Internal Server Error';\n\t\t501 'Not Implemented';\n\t\t502 'Bad Gateway';\n\t\t503 'Service Unavailable';\n\t\t504 'Gateway Timeout';\n\t\t505 'HTTP Version Not Supported';\n\t\t506 'Variant Also Negotiates';\n\t\t507 'Insufficient Storage';\n\t\t508 'Loop Detected';\n\t\t510 'Not Extended';\n\t\t511 'Network Authentication Required';\n\t\tdefault 'Oppos, Something is wrong';\n    }\n}\n\n")])])]),e("p",[t._v("in the "),e("code",[t._v("/etc/nginx/nginxconfig.io/general.conf")]),t._v(" file, put code as following also create file: "),e("code",[t._v("error.html")]),t._v(" in directory: "),e("code",[t._v("/www/_error")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 421 422 423 424 426 428 429 431 451 500 501 502 503 504 505 506 507 508 510 511 /error.html;\n\nlocation = /error.html {\n  ssi on;\n  internal;\n  root /www/_error;\n}\n\n")])])])])},[],!1,null,null,null);n.default=i.exports}}]);