webpackJsonp([55],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-3d1e25a0","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/after-less-loader.js!./node_modules/less-loader/index.js?{"minimize":true,"sourceMap":true}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoContractAdd.vue':function(e,t){},"./src/pages/PanoContractAdd.vue":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("./node_modules/babel-runtime/core-js/json/stringify.js"),s=o.n(a),r=o("./node_modules/babel-runtime/helpers/slicedToArray.js"),c=o.n(r),n=o("./node_modules/babel-runtime/core-js/object/entries.js"),i=o.n(n),l=o("./node_modules/vue-feather-icons/dist/vue-feather-icons.es.js"),p=o("./node_modules/vux/src/components/checklist/index.vue"),u=o("./node_modules/vux/src/components/datetime/index.vue"),d=o("./node_modules/vux/src/components/flexbox/flexbox.vue"),h=o("./node_modules/vux/src/components/flexbox/flexbox-item.vue"),v=o("./node_modules/vux/src/components/group-title/index.vue"),m=o("./node_modules/vux/src/components/load-more/index.vue"),f=o("./node_modules/vux/src/components/popup/index.vue"),x=o("./node_modules/vux/src/components/previewer/index.vue"),k=o("./node_modules/vux/src/components/search/index.vue"),g=o("./node_modules/vux/src/components/x-textarea/index.vue"),y=o("./src/utils/StoreUtils.js"),b=o("./src/webconfig.js"),_=o("./src/api/index.js"),w=o("./src/utils/StringUtils.js"),C=o("./src/utils/DateUtils.js"),M=o("./src/utils/PlatformUtils.js"),S=o("./src/utils/ElectronUtils.js"),$=(l.d,v.a,x.a,d.a,h.a,u.a,f.a,p.a,m.a,k.a,g.a,{name:"PanoContractAdd",components:{PlusIcon:l.d,GroupTitle:v.a,Previewer:x.a,Flexbox:d.a,FlexboxItem:h.a,Datetime:u.a,Popup:f.a,Checklist:p.a,LoadMore:m.a,Search:k.a,XTextarea:g.a},data:function(){return{purchase:{reason:"",name:"",size:"",quanlity:"",unit:"",price:"",note:""},makecopyersSearchModel:"",makecopyersSearchResults:[],makeCopyersModel:[],makeCopyers:[],storedMakeCopyers:[],showMakecopyPickUpDialog:!1,selectMakecopyNames:"请选择抄送人",approversSearchModel:"",approversSearchResults:[],approversModel:[],approvers:[],storedApprovers:[],showApprovePickUpDialog:!1,selectApproverName:"请选择审批人",readonly:!1,contractType:"",contract:{number:"",date:Object(C.b)("YYYY-MM-DD"),fromprincipal:"",toprincipal:"",contractfiles:[]},maxContractNumber:5,shouldHover:!0,userid:"",disabledSubmitBtn:!1}},methods:{submitPurchase:function(){},showPurchaseTypePopup:function(){},makecopyersCancelSearch:function(){this.makeCopyers=this.storedMakeCopyers},makecopyersClickSearchResult:function(e){var t=e.title,o=e.other;this.makeCopyersModel.push(o),this.selectMakecopyNames=t},makecopyersInputSearchChange:function(e){var t=this;t.makecopyersSearchResults=[],this.makeCopyers.forEach(function(o){Object(w.c)(o.value,e)&&t.makecopyersSearchResults.push({title:o.value,other:o.key})})},makecopyersSearchFocus:function(){this.makecopyersSearchResults=[]},approversCancelSearch:function(){this.approvers=this.storedApprovers},approversClickSearchResult:function(e){var t=e.title,o=e.other;this.approversModel.push(o),this.selectApproverName=t},approversInputSearchChange:function(e){var t=this;t.approversSearchResults=[],this.approvers.forEach(function(o){Object(w.c)(o.value,e)&&t.approversSearchResults.push({title:o.value,other:o.key})})},approversSearchFocus:function(){this.approversSearchResults=[]},selectMakecopyChange:function(e,t){this.selectMakecopyNames=0>=e.length?"请选择抄送人":t.toString()},showMakecopyPickupHandle:function(){this.showMakecopyPickUpDialog=!0},selectApproveChange:function(e,t){this.selectApproverName=0>=e.length?"请选择审批人":t[0]},showApprovePickupHandle:function(){this.showApprovePickUpDialog=!0},onPreviewImage:function(e){this.$refs.previewer.show(e)},onRemoveImage:function(e){this.contract.contractfiles.splice(e)},uploadContractImage:function(){var e=this,t=b.a.ApiServerURI+"/v1/upload/file";this.$device.isWechat?this.$wechat.chooseImage({count:1,sizeType:["original"],sourceType:["album"],success:function(o){var a=o.localIds[0];e.$wechat.uploadImage({localId:a.toString(),isShowProgressTips:1,success:function(o){var a=o.serverId,s=new FormData;i()({type:6}).forEach(function(e){var t=c()(e,2),o=t[0],a=t[1];s.append(o,a)}),s.append("mediaid",a),_.b.post(t,s,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(1e3===t.data.code){e.loading=!1;var o=t.data.data.url;e.$vux.toast.show({text:"合同审核单上传成功!"}),e.contract.contractfiles.push({src:o,msrc:o,w:1200,h:1e3}),y.a.set(b.a.StoreContractfiles,e.contract.contractfiles)}}).catch(function(t){e.loading=!1,e.onError(t,a)})},cancel:function(){e.loading=!1},fail:function(t){e.loading=!1,e.$vux.toast.show({type:"warn",text:"微信接口异常出错无法上传合同单,错误代码:"+s()(t)})}})}}):this.$vux.toast.show({type:"warn",time:6e3,text:"上传图片只能在微信手机端操作，你可以先保存当前录入信息，然后再在手机上修改操作！"})},submitContract:function(){var e=this;if(0>this.contract.number.length)this.$vux.alert.show({content:"合同编号不能为空!"});else if("请选择"!==this.contract.date)if(2>this.contract.fromprincipal.length)this.$vux.alert.show({content:"合同的我方负责人不能为空或者是输入非法!"});else if(2>this.contract.toprincipal.length)this.$vux.alert.show({content:"合同的对方负责人不能为空或者是输入非法!"});else if(0>=this.contract.contractfiles.length)this.$vux.alert.show({content:"合同的附件或者图片不能为空!"});else if(0>=this.approversModel.length)this.$vux.alert.show({content:"合同的审批人不能为空!"});else{var t=null,o=[];if(this.storedApprovers.some(function(o,a){if(o.key===e.approversModel[0].toString())return t=e.storedApprovers[a],!0}),this.makeCopyersModel.forEach(function(t){e.storedMakeCopyers.some(function(a,s){if(a.key===t.toString())return o.push(e.storedMakeCopyers[s]),!0})}),t&&0<o.length){var a={userid:this.userid,contract:this.contract,approver:t,makecopyers:o};this.$vux.loading.show({text:"正在提交合同审核信息..."}),this.disabledSubmitBtn=!0,_.b.post("/contract/add",a).then(function(t){e.$vux.loading.hide(),e.disabledSubmitBtn=!1;var o=t.data.code;1e3===o?(Object(M.b)()?e.$router.go(-1):Object(S.a)(),e.$vux.toast.show({time:3e4,text:"你的合同已经提交,正在等待审核,请耐心等待审核结果!"})):1008===o?e.$vux.alert.show({content:"合同编号已存在,不能重复添加!"}):e.$vux.alert.show({content:"创建合同失败,失败代码: "+o+"!"})}).catch(function(t){e.$vux.loading.hide(),e.disabledSubmitBtn=!1,alert("合同提交审核失败,遇到异常: "+t)})}else alert("审批人和抄送人不能为空！")}else this.$vux.alert.show({content:"合同的签约日期不能为空!"})},fetchCompanyUsers:function(){var e=this,t=y.a.get(b.a.StoreUserInfoKey),o=t.customerdata.companyid;this.userid=t.customerdata.userid,this.$vux.loading.show({text:"正在加载数据..."}),this.storedApprovers=[],_.b.get("/contract/users/"+o).then(function(t){var o=t.data.code;(e.$vux.loading.hide(),1e3===o)&&(t.data.data.forEach(function(t){t.userid!==e.userid&&e.storedApprovers.push({key:t.userkey.toString(),value:t.nickname,openid:t.openid})}),e.approvers=e.storedApprovers,e.storedMakeCopyers=e.storedApprovers,e.makeCopyers=e.storedApprovers,e.approversModel=[e.approvers[0].key],e.makeCopyersModel=[e.makeCopyers[0].key])}).catch(function(t){e.$vux.loading.hide(),console.log("获取账号列表出错: "+t)})}},mounted:function(){this.$store.dispatch("UpdateShowHeader",!0),this.$store.dispatch("UpdateShowTabbar",!1);var e=this.$route.params.type;"1000"===e?(this.contractType="合同审批",this.fetchCompanyUsers()):"1001"===e&&(this.contractType="采购")}}),j={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("x-header",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"100"},attrs:{slot:"header","left-options":{showBack:!0,backText:"返回"},title:e.contractType},slot:"header"}),e._v(" "),"1000"===e.$route.params.type?o("div",[o("group",[o("x-input",{attrs:{title:"合同编号",placeholder:"请输入合同编号"},model:{value:e.contract.number,callback:function(t){e.$set(e.contract,"number",t)},expression:"contract.number"}}),e._v(" "),o("datetime",{attrs:{format:"YYYY-MM-DD",title:"签约日期",placeholder:"请选择日期","min-year":2018},model:{value:e.contract.date,callback:function(t){e.$set(e.contract,"date",t)},expression:"contract.date"}}),e._v(" "),o("x-input",{attrs:{title:"我方负责人",placeholder:"请输入我方负责人"},model:{value:e.contract.fromprincipal,callback:function(t){e.$set(e.contract,"fromprincipal",t)},expression:"contract.fromprincipal"}}),e._v(" "),o("x-input",{attrs:{title:"对方负责人",placeholder:"请输入对方负责人"},model:{value:e.contract.toprincipal,callback:function(t){e.$set(e.contract,"toprincipal",t)},expression:"contract.toprincipal"}})],1),e._v(" "),o("group-title",[e._v("合同附件/图片(最多上传五张)")]),e._v(" "),o("flexbox",{attrs:{gutter:0,wrap:"wrap"}},[e._l(e.contract.contractfiles,function(t,a){return o("flexbox-item",{key:a,staticStyle:{height:"80px"},attrs:{span:4},nativeOn:{click:function(t){e.onPreview(a)}}},[o("div",{staticClass:"vux-upload-bg"},[o("div",{staticClass:"vux-upload-content",style:{backgroundImage:"url("+t.src+")",height:"80px"}},[e.readonly?e._e():o("svg",{staticClass:"vux-x-icon vux-x-icon-ios-close red",attrs:{type:"ios-close",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 512 512"},on:{click:function(o){e.onRemove(a,t)}}},[o("path",{staticClass:"st0",attrs:{d:"M403.1 108.9c-81.2-81.2-212.9-81.2-294.2 0s-81.2 212.9 0 294.2c81.2 81.2 212.9 81.2 294.2 0s81.2-213 0-294.2zM352 340.2L340.2 352l-84.4-84.2-84 83.8-11.8-11.8 84-83.8-84-83.8 11.8-11.8 84 83.8 84.4-84.2 11.8 11.8-84.4 84.2 84.4 84.2z"}})])])])])}),e._v(" "),o("previewer",{ref:"previewer",attrs:{list:e.contract.contractfiles}}),e._v(" "),e.contract.contractfiles.length<e.maxContractNumber?o("flexbox-item",{attrs:{span:4}},[o("div",{staticClass:"vux-upload-bg"},[o("div",[o("svg",{staticClass:"icon",staticStyle:{height:"60px",width:"60px","margin-left":"15px"},attrs:{slot:"icon","aria-hidden":"true"},on:{click:e.uploadContractImage},slot:"icon"},[o("use",{attrs:{"xlink:href":"#plus"}})])])])]):e._e()],2),e._v(" "),o("group",[o("cell",{attrs:{title:"审批人","is-link":"",value:e.selectApproverName},nativeOn:{click:function(t){return e.showApprovePickupHandle(t)}}}),e._v(" "),o("cell",{attrs:{title:"抄送人","is-link":"",value:e.selectMakecopyNames},nativeOn:{click:function(t){return e.showMakecopyPickupHandle(t)}}})],1),e._v(" "),o("br"),e._v(" "),o("x-button",{attrs:{gradients:["#1D62F0","#19D5FD"]},nativeOn:{click:function(t){return e.submitContract(t)}}},[e._v("提交")])],1):e._e(),e._v(" "),1001===e.$route.params.type?o("div",[o("group",[o("x-input",{attrs:{title:"申请事由",placeholder:"请输入申请的原因"},model:{value:e.purchase.reason,callback:function(t){e.$set(e.purchase,"reason",t)},expression:"purchase.reason"}}),e._v(" "),o("cell",{attrs:{title:"采购类型","is-link":""},nativeOn:{click:function(t){return e.showPurchaseTypePopup(t)}}})],1),e._v(" "),o("group",{attrs:{title:"采购明细"}},[o("x-input",{attrs:{title:"名称",placeholder:"请输入采购物品的名称"},model:{value:e.purchase.name,callback:function(t){e.$set(e.purchase,"name",t)},expression:"purchase.name"}}),e._v(" "),o("x-input",{attrs:{title:"规格",placeholder:"请输入采购物品的规格尺寸"},model:{value:e.purchase.size,callback:function(t){e.$set(e.purchase,"size",t)},expression:"purchase.size"}}),e._v(" "),o("x-input",{attrs:{title:"数量",placeholder:"请输入采购物品的数量"},model:{value:e.purchase.quanlity,callback:function(t){e.$set(e.purchase,"quanlity",t)},expression:"purchase.quanlity"}}),e._v(" "),o("x-input",{attrs:{title:"单位",placeholder:"请输入采购物品的计价单位"},model:{value:e.purchase.unit,callback:function(t){e.$set(e.purchase,"unit",t)},expression:"purchase.unit"}}),e._v(" "),o("x-input",{attrs:{title:"价格",placeholder:"请输入采购物品的价格"},model:{value:e.purchase.price,callback:function(t){e.$set(e.purchase,"price",t)},expression:"purchase.price"}})],1),e._v(" "),o("group",{attrs:{title:"备注"}},[o("x-textarea",{attrs:{placeholder:"请输入额外的备注信息"},model:{value:e.purchase.note,callback:function(t){e.$set(e.purchase,"note","string"==typeof t?t.trim():t)},expression:"purchase.note"}})],1),e._v(" "),o("group-title",[e._v("图片附件(最多上传五张)")]),e._v(" "),o("flexbox",{attrs:{gutter:0,wrap:"wrap"}},[e._l(e.contract.contractfiles,function(t,a){return o("flexbox-item",{key:a,staticStyle:{height:"80px"},attrs:{span:4},nativeOn:{click:function(t){e.onPreview(a)}}},[o("div",{staticClass:"vux-upload-bg"},[o("div",{staticClass:"vux-upload-content",style:{backgroundImage:"url("+t.src+")"}},[e.readonly?e._e():o("svg",{staticClass:"vux-x-icon vux-x-icon-ios-close red",attrs:{type:"ios-close",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 512 512"},on:{click:function(o){e.onRemove(a,t)}}},[o("path",{staticClass:"st0",attrs:{d:"M403.1 108.9c-81.2-81.2-212.9-81.2-294.2 0s-81.2 212.9 0 294.2c81.2 81.2 212.9 81.2 294.2 0s81.2-213 0-294.2zM352 340.2L340.2 352l-84.4-84.2-84 83.8-11.8-11.8 84-83.8-84-83.8 11.8-11.8 84 83.8 84.4-84.2 11.8 11.8-84.4 84.2 84.4 84.2z"}})])])])])}),e._v(" "),o("previewer",{ref:"previewer",attrs:{list:e.contract.contractfiles}}),e._v(" "),e.contract.contractfiles.length<e.maxContractNumber?o("flexbox-item",{attrs:{span:4}},[o("div",{staticClass:"vux-upload-bg"},[o("div",[o("svg",{staticClass:"icon",staticStyle:{height:"60px",width:"60px","margin-left":"15px"},attrs:{slot:"icon","aria-hidden":"true"},on:{click:e.uploadContractImage},slot:"icon"},[o("use",{attrs:{"xlink:href":"#plus"}})])])])]):e._e()],2),e._v(" "),o("group",[o("cell",{attrs:{title:"审批人","is-link":"",value:e.selectApproverName},nativeOn:{click:function(t){return e.showApprovePickupHandle(t)}}}),e._v(" "),o("cell",{attrs:{title:"抄送人","is-link":"",value:e.selectMakecopyNames},nativeOn:{click:function(t){return e.showMakecopyPickupHandle(t)}}})],1),e._v(" "),o("br"),e._v(" "),o("x-button",{attrs:{gradients:["#1D62F0","#19D5FD"],disable:e.disabledSubmitBtn},nativeOn:{click:function(t){return e.submitPurchase(t)}}},[e._v("提交")])],1):e._e(),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:e.showApprovePickUpDialog,callback:function(t){e.showApprovePickUpDialog=t},expression:"showApprovePickUpDialog"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(t){e.showApprovePickUpDialog=!1}}},[e._v("\n        可选审批人列表\n      ")]),e._v(" "),e.approvers.length>0?o("div",[o("search",{ref:"search",attrs:{placeholder:"输入要过滤的审批人姓名",position:"absolute","auto-scroll-to-top":"",top:"46px",results:e.approversSearchResults},on:{"on-focus":e.approversSearchFocus,"on-change":e.approversInputSearchChange,"on-result-click":e.approversClickSearchResult,"on-cancel":e.approversCancelSearch},model:{value:e.approversSearchModel,callback:function(t){e.approversSearchModel=t},expression:"approversSearchModel"}}),e._v(" "),o("checklist",{attrs:{title:"选择一个审批人(已经选择"+e.approversModel.length+"个审批人)",required:"",max:1,options:e.approvers},on:{"on-change":e.selectApproveChange},model:{value:e.approversModel,callback:function(t){e.approversModel=t},expression:"approversModel"}})],1):o("div",[o("load-more",{attrs:{"show-loading":!1,tip:"当前没有审核人数据"}})],1)],1)],1),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:e.showMakecopyPickUpDialog,callback:function(t){e.showMakecopyPickUpDialog=t},expression:"showMakecopyPickUpDialog"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(t){e.showMakecopyPickUpDialog=!1}}},[e._v("\n        可选抄送人列表\n      ")]),e._v(" "),e.makeCopyers.length>0?o("div",[o("search",{ref:"search",attrs:{placeholder:"输入要过滤的抄送人姓名",position:"absolute","auto-scroll-to-top":"",top:"46px",results:e.makecopyersSearchResults},on:{"on-focus":e.makecopyersSearchFocus,"on-change":e.makecopyersInputSearchChange,"on-result-click":e.makecopyersClickSearchResult,"on-cancel":e.makecopyersCancelSearch},model:{value:e.makecopyersSearchModel,callback:function(t){e.makecopyersSearchModel=t},expression:"makecopyersSearchModel"}}),e._v(" "),o("checklist",{attrs:{title:"选择一个或多个抄送人(已经选择"+e.makeCopyersModel.length+"个抄送人)",required:"",options:e.makeCopyers},on:{"on-change":e.selectMakecopyChange},model:{value:e.makeCopyersModel,callback:function(t){e.makeCopyersModel=t},expression:"makeCopyersModel"}})],1):o("div",[o("load-more",{attrs:{"show-loading":!1,tip:"当前没有抄送人数据"}})],1)],1)],1)],1)},staticRenderFns:[]};var P=o("./node_modules/vue-loader/lib/component-normalizer.js")($,j,!1,function(e){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-3d1e25a0","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/after-less-loader.js!./node_modules/less-loader/index.js?{"minimize":true,"sourceMap":true}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoContractAdd.vue')},"data-v-3d1e25a0",null);t.default=P.exports}});