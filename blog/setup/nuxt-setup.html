<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue nuxtjs插件类库配置集成 | 评布客博客</title>
    <meta name="description" content="人生处万类，知识最为贤。 —— 韩愈">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="alternate" type="application/rss+xml" href="/rss.xml" title="评布客博客">
  <link rel="stylesheet" href="/fonts/fonts.css">
  <link rel="icon" href="/favicon.ico">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <link rel="apple-touch-icon" href="/img/logo.png">
  <meta name="keywords" content="评布客,评布客博客,java,python,vue,技术培训,前端培训,后端培训,ionic,springboot,vue,小程序,安卓app,苹果App,技术博客,分享,vuejs,python,灵鸽,爬虫,python爬虫">
  <meta name="description" content="评布客博客，点滴记录贵在坚持">
  <meta name="google-site-verification" content="pyUtZja0WJ34YSL_6K0FkcYBU7pDR56XMU92nvDtz7k">
  <script async="true" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script async="true" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>(adsbygoogle = window.adsbygoogle || []).push({  google_ad_client: 'ca-pub-1893384651266286',  enable_page_level_ads: true });</script>
    <meta property="article:modified_time" content="Tue Jul 21 2020 21:40:51 GMT+0800 (GMT+08:00)"><meta property="og:site_name" content="评布客博客"><meta property="og:title" content="Vue nuxtjs插件类库配置集成"><meta property="og:type" content="article"><meta property="og:url" content="/blog/setup/nuxt-setup.html"><meta name="twitter:title" content="Vue nuxtjs插件类库配置集成"><meta name="twitter:url" content="/blog/setup/nuxt-setup.html"><meta name="twitter:card" content="summary_large_image">
    <link rel="preload" href="/assets/css/0.styles.998fa698.css" as="style"><link rel="preload" href="/assets/js/app.8398a555.js" as="script"><link rel="preload" href="/assets/js/3.5bbf39f9.js" as="script"><link rel="preload" href="/assets/js/91.6614cdff.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.998fa698.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">评布客博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/contact-me/" class="nav-link">留言板</a></div><div class="nav-item"><a href="/CHANGELOG.html" class="nav-link">历史更新</a></div><div class="nav-item"><a href="https://pingbook.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JVFast管理框架
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://code.pingbook.top/ant-design-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant-design-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://code.pingbook.top/ionic-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ionic-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/contact-me/" class="nav-link">留言板</a></div><div class="nav-item"><a href="/CHANGELOG.html" class="nav-link">历史更新</a></div><div class="nav-item"><a href="https://pingbook.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JVFast管理框架
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://code.pingbook.top/ant-design-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ant-design-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://code.pingbook.top/ionic-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ionic-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前序</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" class="sidebar-link">关于博客</a></li><li><a href="/blog/synax.html" class="sidebar-link">语法参考手册</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术版本更新</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/release/scrapy.html" class="sidebar-link">scrapy2版本新特性</a></li><li><a href="/blog/release/jdk.html" class="sidebar-link">JDK版本新特性</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>环境配置和部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/setup/video-edit-setup.html" class="sidebar-link">流行视频剪辑工具对比评测及其选型</a></li><li><a href="/blog/setup/genymotion-setup.html" class="sidebar-link">最新genymotion3资源下载及其配置</a></li><li><a href="/blog/setup/bitcoin-mining-setup.html" class="sidebar-link">比特币及其挖矿配置</a></li><li><a href="/blog/setup/how-picgo-vscode-setup.html" class="sidebar-link">如何在VSCode中配置PicGo图床</a></li><li><a href="/blog/setup/node-nuxt-setup.html" class="sidebar-link">Vue nuxtjs安装及其环境配置</a></li><li><a href="/blog/setup/nuxt-setup.html" class="active sidebar-link">Vue nuxtjs插件类库配置集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/setup/nuxt-setup.html#axios集成封装" class="sidebar-link">axios集成封装</a></li><li class="sidebar-sub-header"><a href="/blog/setup/nuxt-setup.html#express环境搭建" class="sidebar-link">express环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/setup/nuxt-setup.html#index-js入口express总配置代码如下：" class="sidebar-link">index.js入口express总配置代码如下：</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/setup/nuxt-setup.html#node-mysql库配置" class="sidebar-link">node-mysql库配置</a></li><li class="sidebar-sub-header"><a href="/blog/setup/nuxt-setup.html#snowflake雪花算法nodejs实现" class="sidebar-link">snowflake雪花算法nodejs实现</a></li></ul></li><li><a href="/blog/setup/ux-tool-best-setup.html" class="sidebar-link">流行通用UX/UI工具对比整理2020</a></li><li><a href="/blog/setup/fanqiang-setup.html" class="sidebar-link">翻墙工具环境配置</a></li><li><a href="/blog/setup/frp-linux-setup.html" class="sidebar-link">FRP内网穿透环境配置</a></li><li><a href="/blog/setup/artipub-setup.html" class="sidebar-link">artipub多平台博客发布工具使用配置</a></li><li><a href="/blog/setup/wordpress-setup.html" class="sidebar-link">Wordpress Linux命令其环境配置</a></li><li><a href="/blog/setup/raspberry-setup.html" class="sidebar-link">树莓派Linux安装及其环境配置</a></li><li><a href="/blog/setup/linux-setup.html" class="sidebar-link">Debian Linux命令其环境配置</a></li><li><a href="/blog/setup/nginx-setup.html" class="sidebar-link">Nginx Linux安装及其环境配置</a></li><li><a href="/blog/setup/python-setup.html" class="sidebar-link">Python Linux安装及其环境配置</a></li><li><a href="/blog/setup/python-scrapy-setup.html" class="sidebar-link">Scrapy爬虫配置</a></li><li><a href="/blog/setup/mysql-setup.html" class="sidebar-link">Debian MYSQL8安装及其环境配置</a></li><li><a href="/blog/setup/uwsgi-setup.html" class="sidebar-link">Python Uwsgi Linux安装及其环境配置</a></li><li><a href="/blog/setup/tomcat-setup.html" class="sidebar-link">Tomcat Linux安装及其环境配置</a></li><li><a href="/blog/setup/redis-setup.html" class="sidebar-link">Redis Linux安装及其环境配置</a></li><li><a href="/blog/setup/sqlalchemy-setup.html" class="sidebar-link">Python SQLAlchemy Linux安装及其环境配置</a></li><li><a href="/blog/setup/mail-setup.html" class="sidebar-link">各种主流邮件服务商配置</a></li><li><a href="/blog/setup/win10-environment-setup.html" class="sidebar-link">Windows10机器新环境配置</a></li><li><a href="/blog/setup/mac-setup.html" class="sidebar-link">Mac机器或者虚拟机相关配置配置</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2020年归档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2019年归档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开发工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>友情链接</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://www.yasminzy.com/nuxt/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】nuxt常用插件集成<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://mybatis.plus/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【后端】Mybatis Plus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="http://www.ruanyifeng.com/blog/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】阮一峰博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://www.jianshu.com/u/4ca93d60a9fe" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】IT晴天<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/vuejs/awesome-vue" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】awesome vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://ionicframework.com/docs/components" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】Ionic Vue Components<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/vueComponent/ant-design-vue-awesome" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】awesome ant-design-vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/ulivz/awesome-vuepress" target="_blank" rel="noopener noreferrer" class="sidebar-link">【前端】awesome-vuepress<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="sidebar-link">【其它】程序员的工具集<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><!----> <p></p><div class="table-of-contents"><ul><li><a href="#axios集成封装">axios集成封装</a></li><li><a href="#express环境搭建">express环境搭建</a><ul><li><a href="#index-js-入口express总配置代码如下：">index.js入口express总配置代码如下：</a></li></ul></li><li><a href="#node-mysql库配置">node-mysql库配置</a></li><li><a href="#snowflake雪花算法nodejs实现">snowflake雪花算法nodejs实现</a></li></ul></div><p></p> <h2 id="axios集成封装"><a href="#axios集成封装" class="header-anchor">#</a> axios集成封装</h2> <ol><li>在<code>nuxt.config.js</code>中配置<code>axios</code>:</li></ol> <div class="language- extra-class"><pre class="language-text"><code> modules: [
    ['@nuxtjs/axios', {
      progress: true,
      retry: false,
      credentials: true
    }],
</code></pre></div><ol start="2"><li>二次封装的可在外部文件中使用<code>$axios</code>的方法,文件为: <code>@/api/index.js</code>:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>// 外部js文件访问$axios实例的方案
let client

export function setClient (newclient) {
  client = newclient
}
// Request helpers
const request = {}
const reqMethods = ['request', 'delete', 'get', 'head', 'options', 'post', 'put', 'patch']
reqMethods.forEach((method) =&gt; {
  request['$' + method] = function () {
    if (!client) { throw new Error('apiClient not installed') }
    return client[method].apply(null, arguments).then(res =&gt; res &amp;&amp; res.data)
  }
})

export default request

</code></pre></div><ol start="3"><li>对应的axios插件中注上上面封装的axios对象，文件名为：<code>@/plugins/axios.js</code> ：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>// import { MessageBox, Message } from 'element-ui'
import cfg from '@/config'
import encrypt from '@/util/EncryptUtil'
import { setClient } from '@/api'

const enableSecret = cfg.secretEnabled
const tokenHeader = cfg.tokenHeader
const tokenRefreshHeader = cfg.tokenRefreshHeader
const updateTokenAction = 'sys/user/updateToken'
const logoutAction = 'sys/user/logout'
export default ({ $axios, error, store, router }) =&gt; {
  $axios.defaults.timeout = 30000
  // 拦截请求
  $axios.onRequest((config) =&gt; {
    //  配置对应的请求token
    const tokenInfo = store.getters.token
    if (tokenInfo) {
      config.headers[tokenHeader] = tokenInfo
    }
    // 是否进行加密数据请求包,只针对json put/post/delete格式的body数据进行加密,其他格式不进行加密
    const data = config.data
    if (enableSecret &amp;&amp; data &amp;&amp; data instanceof Object &amp; config.headers.common.Accept.startsWith('application/json')) {
      // 如果对应的有data数据并且需要加解密
      config.headers['Content-Type'] = 'application/json;charset=UTF-8'
      const jsonStr = JSON.stringify(data)
      const encryptJsonData = encrypt.encode(jsonStr)
      config.data = encryptJsonData
    }
  })
  $axios.onResponse((response) =&gt; {
    const refreshToken = response.headers[tokenRefreshHeader]
    const data = response.data
    // 更新token
    if (refreshToken) {
      store.dispatch(updateTokenAction, refreshToken)
    }
    if (data) {
      const code = data.code
      // 进行json数据的解密
      if (enableSecret &amp;&amp; (typeof data === 'string')) {
        const decodeJsonStr = encrypt.decode(data)
        response.data = JSON.parse(decodeJsonStr)
      }
      // 跳转页面
      if (code === 401) {
        store.dispatch(logoutAction).then(() =&gt; router.push({ name: cfg.page.loginComponentName }))
      }
    }
  })
  $axios.onError((error) =&gt; {
    console.log('err' + error)
  })
  // 暴露$axios对象,方便在外部文件访问对应的$axios实例
  setClient($axios)
  window.axios = $axios
}

</code></pre></div><h2 id="express环境搭建"><a href="#express环境搭建" class="header-anchor">#</a> express环境搭建</h2> <p>express与nuxt集成，添加如下类库：</p> <ol><li><code>consola</code>， 控制台颜色显示</li> <li><code>morgan</code>，日志记录，日志格式，配置输出到文件日志</li> <li><code>cors</code>， 跨域访问设置</li> <li><code>body-parser</code>， 直接解析返回的数据结果通过<code>res.body</code></li></ol> <h3 id="index-js入口express总配置代码如下："><a href="#index-js入口express总配置代码如下：" class="header-anchor">#</a> <code>index.js</code>入口express总配置代码如下：</h3> <div class="language- extra-class"><pre class="language-text"><code>const path = require('path')
const fs = require('fs')
const express = require('express')
const consola = require('consola')
const { Nuxt, Builder } = require('nuxt')
// start express app
const isDev = process.env.NODE_ENV !== 'production'
const rootPwd = process.cwd()
const app = express()
// ------cors: registering cors
const cors = require('cors')
app.use(cors())
// ------body-parser: configure body parser,grabbing the HTTP body, decoding the information, and appending it to the req.body
const bodyParser = require('body-parser')
app.use(bodyParser.urlencoded({ extended: false }))
app.use(bodyParser.json())
// ------morgan: configure morgan
const FileStreamRotator = require('file-stream-rotator')
const morgan = require('morgan')
const devModify = '[:date[clf]] &quot;:method :url HTTP/:http-version&quot; :status - :res[content-length] - :response-time ms &quot;:referrer&quot; &quot;:user-agent&quot;'
const combinedModify = ':remote-addr - :remote-user [:date[clf]] &quot;:method :url HTTP/:http-version&quot; :status :response-time ms &quot;:referrer&quot; &quot;:user-agent&quot;'
const morganFormat = isDev ? devModify : combinedModify
// ensure log directory exists
const logDirectory = path.join(rootPwd, 'logs')
fs.existsSync(logDirectory) || fs.mkdirSync(logDirectory)
// 1. create stream
// const accessLogStream = fs.createWriteStream(logPath, { flags: 'a' })
// 2. create a rotating write stream
const accessLogStream = FileStreamRotator.getStream({
  date_format: 'YYYYMMDD',
  filename: path.join(logDirectory, 'access-%DATE%.log'),
  frequency: 'daily',
  verbose: false
})
app.use(morgan(morganFormat, { stream: accessLogStream })) // configire morgan

// Router: Import API Routes
const config = require('./api/config')
const api = require('./api/controller')
app.use(config.prefix, api)
async function start () {
  // Init Nuxt.js
  const nuxtConfig = require('../../nuxt.config.js')
  // Import and Set Nuxt.js options
  nuxtConfig.dev = isDev
  const nuxt = new Nuxt(nuxtConfig)
  const { host, port } = nuxt.options.server

  await nuxt.ready()
  // Build only in dev mode
  if (nuxtConfig.dev) {
    const builder = new Builder(nuxt)
    await builder.build()
  }

  // Give nuxt middleware to express
  app.use(nuxt.render)

  // Listen the server
  app.listen(port, host)
  consola.ready({
    message: `Server listening on http://${host}:${port}`,
    badge: true
  })
}
start()


</code></pre></div><h2 id="node-mysql库配置"><a href="#node-mysql库配置" class="header-anchor">#</a> node-mysql库配置</h2> <p>推荐类库: https://github.com/mysqljs/mysql#install</p> <p>类库代码:</p> <div class="language- extra-class"><pre class="language-text"><code>const mysql = require('mysql')
const config = require('../config')
// 雪花算法计算id
const Snowflake = require('./snowflake')
const idWorker = new Snowflake(config.snowflake.worker_id, config.snowflake.datacenter_id)
// 建立连接池，并设置连接池
const pool = mysql.createPool(config.db)
pool.on('acquire', function (connection) {
  console.log('Connection %d acquired', connection.threadId)
})
pool.on('enqueue', function () {
  console.log('Waiting for available connection slot')
})
pool.on('release', function (connection) {
  console.log('Connection %d released', connection.threadId)
})

/**
 * select,update,delete,insert操作
 * @param query
 * @param bindParameters
 * @return 返回结果
 *     得到返回id: results.insertId
 *     得到insert, update or delete的数据条数: results.affectedRows
 *     得到update更改的条数，如果数据没有更改则不会计数： results.changedRows
 *     得到count(1)对应的数据条数: results[0].count
 */
const exec = function (query, ...bindParameters) {
  return new Promise((resolve, reject) =&gt; {
    pool.getConnection((err, connection) =&gt; {
      if (err) {
        console.log('CONNECT Thread ', connection.threadId, ', ERROR:', err.message)
        resolve(err)
      } else {
        connection.query(query, bindParameters, (error, results, fields) =&gt; {
          // When done with the connection, release it.
          // if (error) { throw error }
          // Handle error after the release.
          connection.release()
          resolve(error, results, fields)
        })
      }
    })
  })
}
const nextId = function () {
  return idWorker.nextId()
}

module.exports = { exec, nextId }

</code></pre></div><h2 id="snowflake雪花算法nodejs实现"><a href="#snowflake雪花算法nodejs实现" class="header-anchor">#</a> snowflake雪花算法nodejs实现</h2> <p>代码如下:</p> <div class="language- extra-class"><pre class="language-text"><code>/**
 * 网上搜到的方案基本是按照推特的方案（10位的数据机器位分成 5位机器ID + 5位数据ID ），目前代码按照这个方案来做的；
 * 代码是参考网上的一个 Java 版本的实现方案：https://www.cnblogs.com/relucent/p/4955340.html 编写的，
 * 这个Java方案的实现是参考：https://github.com/twitter-archive/snowflake
 *
 * 名词说明：
 * Twitter_Snowflake
 * SnowFlake的结构如下(每部分用-分开):
 *
 * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000
 * A-|--------------------B--------------------------|-------C-------|------D------|
 *
 * A区：1位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，所以id一般是正数，最高位是0
 * B区：41位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)得到的值，
 *      这里的的开始时间截，一般是我们的id生成器开始使用的时间，由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。41位的时间截，可以使用69年，
 *      年T = (1n &lt;&lt; 41n) / (1000n * 60n * 60n * 24n * 365n) = 69n
 * C区：10位的数据机器位，可以部署在1024个节点，包括5位datacenterId和5位workerId（2^5 * 2^5 = 1024）
 * D区：12位序列，毫秒内的计数，12位 的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号（2^12=4096）
 * 加起来刚好64位，为一个Long型。
 *
 * SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据ID和机器ID作区分)，并且效率较高。
 * 理论1S内生成的ID数量是 1000*4096 = 4096000（四百零九万六千个）
 * 代码中使用Bigint实现，该类型在Node10.X版本才开始支持，返回出去的结果是Bigint转为String后的字符串类型，toString方法消耗总性能的三分之一时间；
 * 性能测试结果：
 *      生成100W条ID，      约850-1000ms；  如果不toString后再转，  时间约 640-660ms
 *      生成409.6WW条ID，   约3600-3850ms； 如果不toString后再转，  时间约约 2600-2800ms
 */

//= =============================Constructors=====================================
/**
 * 构造函数
 * @param workerId 工作ID (0~31)
 * @param datacenterId 数据标识ID (0~31)
 */

const Snowflake = (function () {
  function Snowflake (_workerId, _dataCenterId) {
    /** 开始时间截 ：2019-12-20 13:52:35 */
    this.twepoch = 1576821155667n

    /** 机器id所占的位数 */
    this.workerIdBits = 5n

    /** 数据标识id所占的位数 */
    this.dataCenterIdBits = 5n

    /**
     * 支持的最大机器id，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数)
     * 用位运算计算n个bit能表示的最大数值，计算是 -1 左移 5，得结果a，然后 -1 异或 a
     *
     * 步骤
     * 先 -1 左移 5，得结果a ：
     11111111 11111111 11111111 11111111 //-1的二进制表示（补码，补码的意义是拿补码和原码相加，最终加出一个“溢出的0”）
     11111 11111111 11111111 11111111 11100000 //高位溢出的不要，低位补0
     11111111 11111111 11111111 11100000 //结果a
     * 再 -1 异或 a ：
     11111111 11111111 11111111 11111111 //-1的二进制表示（补码）
     ^   11111111 11111111 11111111 11100000 //两个操作数的位中，相同则为0，不同则为1
     ---------------------------------------------------------------------------
     00000000 00000000 00000000 00011111 //最终结果31
     * */
    this.maxWrokerId = -1n ^ (-1n &lt;&lt; this.workerIdBits) // 值为：31

    /** 支持的最大数据标识id，结果是31 */
    this.maxDataCenterId = -1n ^ (-1n &lt;&lt; this.dataCenterIdBits) // 值为：31

    /** 序列在id中占的位数 */
    this.sequenceBits = 12n

    /** 机器ID向左移12位 */
    this.workerIdShift = this.sequenceBits // 值为：12

    /** 数据标识id向左移17位(12序列id+5机器ID) */
    this.dataCenterIdShift = this.sequenceBits + this.workerIdBits // 值为：17

    /** 时间截向左移22位( 12序列id + 5机器ID + 5数据ID) */
    this.timestampLeftShift = this.sequenceBits + this.workerIdBits + this.dataCenterIdBits // 值为：22

    /** 生成序列的掩码，这里为4095
     * 用位运算计算n个bit能表示的最大数值，计算是 -1 左移 12，得结果a，然后 -1 异或 a
     *
     * 步骤
     * 先 -1 左移 12，得结果a ：
     11111111 11111111 11111111 11111111 //-1的二进制表示（补码，补码的意义是拿补码和原码相加，最终加出一个“溢出的0”）
     1111 11111111 11111111 11111111 11110000 00000000 //高位溢出的不要，低位补0
     11111111 11111111 11110000 00000000 //结果a
     * 再 -1 异或 a ：
     11111111 11111111 11111111 11111111 //-1的二进制表示（补码）
     ^   11111111 11111111 11110000 00000000 //两个操作数的位中，相同则为0，不同则为1
     ---------------------------------------------------------------------------
     00000000 00000000 00001111 11111111 //最终结果2^12  = 4096
     */
    this.sequenceMask = -1n ^ (-1n &lt;&lt; this.sequenceBits) // 值为：4095

    /** 工作机器ID(0~31) */
    // this.workerId = 0n
    /** 数据中心ID(0~31) */
    // this.dataCenterId = 0n

    /** 上次生成ID的时间截 */
    this.lastTimestamp = -1n

    this.workerId = BigInt(_workerId || 0n) // 工作机器ID(0~31)
    this.dataCenterId = BigInt(_dataCenterId || 0n) // 数据标识ID(0~31)
    this.sequence = 0n // 毫秒内序列(0~4095)

    // workerId 校验
    if (this.workerId &gt; this.maxWrokerId || this.workerId &lt; 0) {
      throw new Error(`workerId must max than 0 and small than maxWrokerId ${this.maxWrokerId}`)
    }
    // dataCenterId 校验
    if (this.dataCenterId &gt; this.maxDataCenterId || this.dataCenterId &lt; 0) {
      throw new Error(`dataCenterId must max than 0 and small than maxDataCenterId ${this.maxDataCenterId}`)
    }
  }
  // ==============================Methods==========================================
  /**
   * 获得下一个ID (该方法是线程安全的)
   * @return SnowflakeId
   */
  Snowflake.prototype.nextId = function () {
    let timestamp = this.timeGen()

    // 如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常
    if (timestamp &lt; this.lastTimestamp) {
      throw new Error('Clock moved backwards. Refusing to generate id for ' +
        (this.lastTimestamp - timestamp))
    }

    // 如果是同一时间生成的，则进行毫秒内序列
    if (this.lastTimestamp === timestamp) {
      /**
       * 按位于操作 对于每一个比特位，只有两个操作数相应的比特位都是1时，结果才为1，否则为0。
       * 假设最开始 this.sequence 为 0n 加1后，则为1
       * 结果如下
       00000000 00000000 00000000 00000001 //1的二进制
       00000000 00000000 00001111 11111111 //最终结果2^12  = 4096
       ---------------------------------------------------------------------------
       00000000 00000000 00000000 00000001 //结果1的二进制
       */
      this.sequence = (this.sequence + 1n) &amp; this.sequenceMask
      // 毫秒内序列溢出
      if (this.sequence === 0n) {
        // 阻塞到下一个毫秒,获得新的时间戳
        timestamp = this.tilNextMillis(this.lastTimestamp)
      }
    } else {
      // 时间戳改变，毫秒内序列重置
      this.sequence = 0n
    }

    // 上次生成ID的时间截
    this.lastTimestamp = timestamp

    // 移位并通过或运算拼到一起组成64位的ID
    const result = ((timestamp - this.twepoch) &lt;&lt; this.timestampLeftShift) |
      (this.dataCenterId &lt;&lt; this.dataCenterIdShift) |
      (this.workerId &lt;&lt; this.workerIdShift) |
      this.sequence
    return result
  }

  /**
   * 阻塞到下一个毫秒，直到获得新的时间戳
   * @param lastTimestamp 上次生成ID的时间截
   * @return 当前时间戳
   */
  Snowflake.prototype.tilNextMillis = function (lastTimestamp) {
    let timestamp = this.timeGen()
    while (timestamp &lt;= lastTimestamp) {
      timestamp = this.timeGen()
    }
    return timestamp
  }

  /**
   * 返回以毫秒为单位的当前时间
   * @return 当前时间(毫秒)
   */
  Snowflake.prototype.timeGen = function () {
    return BigInt(Date.now())
  }

  return Snowflake
}())
// console.log(new Snowflake(1n, 1n).nextId());
module.exports = Snowflake

</code></pre></div><!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新: </span> <span class="time">7/21/2020, 9:40:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/setup/node-nuxt-setup.html" class="prev">
          Vue nuxtjs安装及其环境配置
        </a></span> <span class="next"><a href="/blog/setup/ux-tool-best-setup.html">
          流行通用UX/UI工具对比整理2020
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.8398a555.js" defer></script><script src="/assets/js/3.5bbf39f9.js" defer></script><script src="/assets/js/91.6614cdff.js" defer></script>
  </body>
</html>
