webpackJsonp([56],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-34d647f8","scoped":false,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/EngineeringQuantityStatistic.vue':function(e,t){},"./src/pages/EngineeringQuantityStatistic.vue":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("./node_modules/babel-runtime/core-js/object/assign.js"),a=o.n(n),s=o("./node_modules/vux/src/components/actionsheet/index.vue"),l=o("./node_modules/vux/src/components/flexbox/flexbox.vue"),i=o("./node_modules/vux/src/components/flexbox/flexbox-item.vue"),r=o("./node_modules/vux/src/components/load-more/index.vue"),c=o("./src/api/index.js"),d=o("./src/utils/DateUtils.js"),u=o("./node_modules/@handsontable/vue/vue-handsontable-ce.js"),p=o.n(u),m=o("./node_modules/handsontable/dist/handsontable.js"),f=o.n(m),v=(o("./node_modules/handsontable/languages/zh-CN.js"),o("./src/utils/StoreUtils.js")),h=o("./src/webconfig.js"),x=o("./src/utils/PlatformUtils.js"),b=(p.a,r.a,s.a,l.a,i.a,{name:"EngineeringQuantityStatistic",metaInfo:function(){return{title:this.pageTitle,titleTemplate:null}},components:{HotTable:p.a,LoadMore:r.a,Actionsheet:s.a,Flexbox:l.a,FlexboxItem:i.a},data:function(){return{pageTitle:"投标工程完成量汇总表",emptyTable:!1,menuOptions:!1,hottable:null,settings:{}}},methods:{goNewBudgetPage:function(){this.$router.push({name:"pquantityadd",params:{projectid:this.$route.params.projectid,type:0}})},clickMenuOptions:function(e){if("excel"===e)this.downloadExcelMonthlyReport();else if("open"===e)if(Object(x.b)()){var t=this,o=location.href;this.$copyText(o).then(function(){t.$vux.alert.show({buttonText:"好的",title:"投标工程量工序汇总报表提示",content:"地址复制成功! 你可在电脑端打开地址: "+o+" 查看该工程量汇总表!"})},function(e){alert("Can not copy"),console.log(e)})}else this.$vux.toast.show({time:3e3,text:"暂不支持桌面版操作！"})},buildHotTable:function(e,t,o){this.$vux.loading.show({text:"正在渲染Excel进度表数据..."});var n=this.$refs.ht.table,s=JSON.parse(e),l=JSON.parse(t),i=JSON.parse(o);this.cellStyle=i,n.loadData(s);var r=this,c=a()({},{language:"zh-CN",contextMenu:!0,minSpareRows:10,minSpareCols:15,formulas:!0,rowHeaders:!0,colHeaders:!0,filters:!1,autoWrapRow:!0,colWidths:[110,200,80,100,100,100,100,100,100,100,100,100],fixedRowsTop:2,customBorders:[],autoColumnSize:!0,manualColumnResize:!0,stretchH:"all"},{data:s,mergeCells:l,contextMenu:{items:{export:{name:"导出报表",callback:function(){r.downloadExcelMonthlyReport()}},sep2:"---------",undo:{},redo:{},sep3:"---------",copy:{},cut:{},sep4:"---------",make_read_only:{},sep5:"---------",alignment:{},sep6:"---------",row_above:{},row_below:{},col_left:{},col_right:{},remove_row:{},remove_col:{},sep1:"---------",about:{name:"关于我们",callback:function(){r.$vux.alert.show({content:"版权归眼值科技有限公司所有, 任何形式篡改将保留追究法律责任."})}}}},cells:function(e,t){var o={},a=n.toVisualRow(e),s=n.toVisualColumn(t);return 0===a&&(o={type:"text",renderer:function(e,t){f.a.renderers.HtmlRenderer.apply(this,arguments),t.style.cssText="vertical-align: center;font-size: 18px;font-family: 宋体, 'Roboto', Helvetica, Arial, sans-serif;white-space: nowrap;text-align: center;vertical-align: middle;font-weight: bold;"}}),(1===a||2===a)&&(o={type:"text",renderer:function(e,t){f.a.renderers.HtmlRenderer.apply(this,arguments),t.style.cssText="vertical-align: left;font-size: 16px;font-family: 宋体, 'Roboto', Helvetica, Arial, sans-serif;white-space: nowrap;text-align: left;vertical-align: left;font-weight: bold;"}}),3<=a&&6<=s&&(o={renderer:function(e,t,o,n,a,s){f.a.renderers.HtmlRenderer.apply(this,arguments),"进行中"===s?t.style.cssText="vertical-align: center;font-size: 16px;font-family: 宋体, 'Roboto', Helvetica, Arial, sans-serif;white-space: nowrap;text-align: center;vertical-align: middle;font-weight: bold;background:yellow;":"完成"===s&&(t.style.cssText="vertical-align: center;font-size: 16px;font-family: 宋体, 'Roboto', Helvetica, Arial, sans-serif;white-space: nowrap;text-align: center;vertical-align: middle;font-weight: bold;background:green;")}}),o}});n.updateSettings(c),this.hottable=n},fetchProjectMaterials:function(e){var t=this;this.$vux.loading.show({text:"正在加载投标工程工序数据..."}),c.b.get("/equantity/t/"+e).then(function(e){var o=e.data;if(1e3===o.code)if("[]"!==o.data.celldata){var n=o.data.name;t.pageTitle=n;var a=o.data.celldata,s=o.data.merges,l=o.data.styles;t.buildHotTable(a,s,l)}else t.emptyTable=!0;t.$vux.loading.hide()}).catch(function(e){t.$vux.loading.hide(),t.emptyTable=!0,console.log("进度表生成失败 "+e),t.$vux.alert.show({title:"项目进度表",content:"进度表生成失败 "+e})})},downloadExcelMonthlyReport:function(){var e=this;if(Object(x.b)())this.$vux.alert.show({content:"请在电脑端打开地址:"+location.href+',右键报表选择"导出报表"下载报表!'});else{var t=this.$route.params.projectid,o=(v.a.get(h.a.StoreProject)?v.a.get(h.a.StoreProject).value:"")+"完成工程量汇总表-"+Object(d.b)("YYYY-MM-DD")+".xls";c.b.get("/equantity/export/"+t,{responseType:"blob"}).then(function(t){if("application/vnd.ms-excel"===t.headers["content-type"]){var n=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=n,a.setAttribute("download",o),document.body.appendChild(a),a.click(),e.$vux.toast.show({text:"报表下载成功!"})}else e.$vux.toast.show({time:5e3,type:"warn",text:"当前报表数据为空不支持下载!"})})}}},mounted:function(){this.$store.dispatch("UpdateShowTabbar",!1);var e=this.$route.params.projectid;this.fetchProjectMaterials(e)}}),g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"container"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!1},title:e.pageTitle}},[o("span",{attrs:{slot:"right"},on:{click:function(t){e.menuOptions=!e.menuOptions}},slot:"right"},[o("svg",{staticClass:"vux-x-icon vux-x-icon-navicon",staticStyle:{fill:"#fff",position:"relative",top:"-8px",left:"-3px"},attrs:{type:"navicon",size:"35",xmlns:"http://www.w3.org/2000/svg",width:"35",height:"35",viewBox:"0 0 512 512"}},[o("path",{attrs:{d:"M96 241h320v32H96zm0-96h320v32H96zm0 192h320v32H96z"}})])])]),e._v(" "),e.emptyTable?o("div",[o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("load-more",{staticStyle:{"padding-top":"30px"},attrs:{slot:"title","show-loading":!1,tip:"当前项目工程量数据为空!","background-color":"#fbf9fe"},slot:"title"}),e._v(" "),o("flexbox",[o("flexbox-item",{attrs:{span:2}}),e._v(" "),o("flexbox-item",[o("x-button",{attrs:{type:"primary","action-type":"button"},nativeOn:{click:function(t){return e.goNewBudgetPage(t)}}},[e._v("新建投标工程\n        ")])],1),e._v(" "),o("flexbox-item",{attrs:{span:2}})],1)],1):o("div",{staticStyle:{width:"100%",height:"100%"}},[o("hot-table",{ref:"ht",attrs:{root:"ht",settings:e.settings}})],1),e._v(" "),o("actionsheet",{attrs:{menus:{open:"复制地址",excel:"导出报表并下载(电脑端)"},"close-on-clicking-mask":!0,"show-cancel":""},on:{"on-click-menu":e.clickMenuOptions},model:{value:e.menuOptions,callback:function(t){e.menuOptions=t},expression:"menuOptions"}})],1)},staticRenderFns:[]};var y=o("./node_modules/vue-loader/lib/component-normalizer.js")(b,g,!1,function(e){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-34d647f8","scoped":false,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/EngineeringQuantityStatistic.vue')},null,null);t.default=y.exports}});