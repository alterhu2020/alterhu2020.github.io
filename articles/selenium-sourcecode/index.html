<!DOCTYPE html>
<html lang="zh_cn">
<head>

        <title>Selenium3笔记-WebDriver源码初探</title>
        <meta charset="utf-8"/>
        <meta name="description" content="

Selenium3 有哪些变化？¶ 其实相对于与Selenium2，Selenium3没有做太多的改动。下面给出官方的文档说明，供参考。 参考文档：https://seleniumhq.wordpress …">
        <meta name="keywords"
              content="Linux,pelican,github,软件测试,测试框架,测试开发,白盒测试,Selenium,Selenium开发,Vuejs,树莓派,自动化测试,编程语言,大数据,人工智能,开源软件,创业,程序员找工作,移动互联网,生活时尚,情感交流,软件测试,技术博客">


            <link href="https://pingbook.top/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
                  title="PingBook Blog Full Atom Feed"/>


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="../../theme/gumby.css"/>
        <link rel="stylesheet" type="text/css" href="../../theme/style.css"/>
        <link rel="stylesheet" type="text/css" href="../../theme/pygment.css"/>


        <script src="../../theme/js/libs/modernizr-2.6.2.min.js"></script>

            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({
                    google_ad_client: "ca-pub-1893384651266286",
                    enable_page_level_ads: true
                });
            </script>

            <!-- Global site tag (gtag.js) - Google Analytics -->
            <script async src="https://www.googletagmanager.com/gtag/js?id=UA-122219517-1"></script>
            <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());

                gtag('config', 'UA-122219517-1');
            </script>


        <!---->

</head>

<body id="index" class="home">


<div class="container">
    <div class="row">

        <header id="banner" class="body">

            <h1><a href="../..">PingBook Blog <strong></strong></a></h1>
        </header><!-- /#banner -->

        <div id="navigation" class="navbar row">
            <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
            <ul class="columns" style="width: 100%">

                    <li ><a href="/">Home</a></li>
                    <li ><a href="/categories">Category</a></li>
                    <li ><a href="/archives">Archive</a></li>
                    <li ><a href="/tags">Tags</a></li>
                    <li ><a href="/about">About</a></li>
                    <li ><a href="/change-log">Changes</a></li>
            <li >
                <div style="display: block;
    padding: 0 16px;
    white-space: nowrap;
    color: white;
    text-shadow: 0 1px 2px #191a1b, 0 1px 0 #191a1b;
    height: 60px;
    line-height: 58px;
    font-size: 16px;
    font-size: 1rem;">
                <form class="navbar-search" action="../../search.html"
                      onsubmit="return validateForm(this.elements['q'].value);">
                    <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input">
                </form>
                </div>
            </li>

            </ul>


        </div>

            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins style="display:block"
                 data-ad-format="fluid"
                 data-ad-layout-key="-6q+ed+2h-1m-4v"
                 data-ad-client="ca-pub-1893384651266286"
                 data-ad-slot="9234880829"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
    <section id="content" class="body">

        <div class="row">

            <div class="eleven columns">
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-1893384651266286"
                         data-ad-slot="3627740042"
                    ></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                <header>
                    <h2 class="entry-title">
                        <a href="../../articles/selenium-sourcecode/" rel="bookmark"
                           title="Permalink to Selenium3笔记-WebDriver源码初探">Selenium3笔记-WebDriver源码初探</a></h2>
                    
                </header>
                <footer class="post-info">
                    <!--<abbr class="published" title="2018-09-07T00:10:33.108638+08:00">-->
                    <!--2018-09-07 00:10:33-->
                    <!--</abbr>-->
                    <!---->
                        <!--<address class="vcard author">By -->
                        <!---->
                            <!--<a class="url fn" href="../../author/walter-hu"> Walter Hu</a>-->
                            <!---->
                        <!--</address>-->
                        <!---->
                    <address class="vcard author" style="font-style:italic;margin-bottom:-10px;">
                        Posted on 2018-09-07 00:10:33
                            &nbsp;&nbsp;By
                            <a class="url fn" href="../../author/walter-hu">Walter Hu</a>

                        <span id="busuanzi_container_page_pv">, <i class="icon-eye icon-large"></i><span
                                id="busuanzi_value_page_pv"></span></span>
                    </address>
                    <hr/>
                </footer><!-- /.post-info -->
                <div class="entry-content">
                    <h3 id="selenium3">Selenium3 有哪些变化？<a class="headerlink" href="#selenium3" title="Permanent link">&para;</a></h3>
<p>其实相对于与Selenium2，Selenium3没有做太多的改动。下面给出官方的文档说明，供参考。</p>
<p>参考文档：https://seleniumhq.wordpress.com/2013/08/28/the-road-to-selenium-3/</p>
<blockquote>
<p>“We aim for Selenium 3 to be “a tool for user-focused automation of mobile and web apps”,Developers from projects such as Appium, ios-driver and selendroidwill be working on the suite of tests to enable this.”
“Selenium 3 will see the removal of the original Selenium Core implementations, and consequently we’ll be deprecating the <span class="caps">RC</span> APIs too，the original implementation will be available as a download, but it will no longer be actively developed once we release&nbsp;3.0.”</p>
</blockquote>
<p>所以对于Selenium3来说最大的变动可能就是更加专注于手机和web的测试，尤其是手机的支持，因为你晓得的，现在更多的是移动的时代。</p>
<p>对于Selenium2中对于RemotControl的实现我看了下Selenium3的源码发现确实不在支持，而更多的转向了W3C standard，不是独成一套Selenium自己的WebDriver <span class="caps">API</span>.关于这个需要插如一下有关W3C&nbsp;WebDriver的知识。</p>
<h3 id="w3c-webdriver">有关W3C WebDriver<a class="headerlink" href="#w3c-webdriver" title="Permanent link">&para;</a></h3>
<p>参考文档： https://www.w3.org/<span class="caps">TR</span>/webdriver/，https://www.w3.org/testing/Activity，https://github.com/w3c/webdriver</p>
<p>W3C组织制定了一套浏览器自动化的规范叫做WebDriver，这套规范规定了所有的浏览器生产商都必须遵守这个规范。其实定义了好多的遵循的接口和WebDriver的概念。对于Chrome，Firefox，Opera,Safari.etc他们都需要遵守这个规范并且实现规范里面的接口，这些实现一般都是伴随浏览器的开发进行的。</p>
<p>所以你应该明白了，Selenium不管是WebDriver还是RemoteWebDriver都是W3C WebDriver的一种实现而已。真正的核心浏览器的交互在对应的浏览器的WebDriver上，其实你有了对应的浏览器的WebDriver，参考W3C的标准接口文档HTTP-based wire&nbsp;protocol你就可以单独实现浏览器的操作。就是Client-Server的沟通。所有支持的命令列表如下：</p>
<p>举个ChromeDriver的例子。。。</p>
<p>首先我们找到ChromeDriver ，这个自然到chromium项目上去下载就好了。
https://sites.google.com/a/chromium.org/chromedriver/这里也有很多详细的接口的说明，这里的接口说明跟上面的W3C的接口说明差不多。你需要针对不同的浏览器下载对应的版本。下面我以下载的一个win版本的为例（下载地址：http://chromedriver.storage.googleapis.com/2.23/chromedriver_win32.zip&nbsp;）</p>
<h3 id="webdriver">WebDriver的使用<a class="headerlink" href="#webdriver" title="Permanent link">&para;</a></h3>
<p>1.1&nbsp;查看下chromedriver.exe提供给我们的一些可用的命令。</p>
<p><img alt="测试图片" src="http://images2015.cnblogs.com/blog/345627/201608/345627-20160806093851965-36470757.png"></p>
<p>里面的使用很详细，这里我们只需要使用一个参数来启动ChromeDriver的server， –port ,命令如下：chromedriver.exe –port&nbsp;9514，或者直接不输入端口直接回车，界面命令如下：</p>
<p><img alt="测试图片" src="http://images2015.cnblogs.com/blog/345627/201608/345627-20160806093859950-536009204.png"></p>
<p>启动后chromedriver会在本地的9514端口号上进行监听通信，根据不同的命令发送到浏览器上，浏览器进行交互。比如启动一个chrome浏览器对应的命令是session，单独的ChromeDriver的HTTP通信URI是：http://localhost:9514/session,对于通过RemoteWebDriver的URL是：http://localhost:9514/wd/hub/session</p>
<h4 id="webdriver-new-session">WebDriver -New Session<a class="headerlink" href="#webdriver-new-session" title="Permanent link">&para;</a></h4>
<p>看一下这个说明： https://www.w3.org/<span class="caps">TR</span>/webdriver/#dfn-new-session，操作流程如下：</p>
<div class="highlight"><pre><span class="code-line"><span></span>    The remote end steps are:</span>
<span class="code-line"></span>
<span class="code-line">    If the remote end is an intermediary node, take implementation-defined steps that either result in returning an error with error code session not created, or in returning a success with data that is isomorphic to that returned by remote ends according to the rest of this algorithm.</span>
<span class="code-line"></span>
<span class="code-line">    If the maximum active sessions is equal to the length of the list of active sessions, return error with error code session not created.</span>
<span class="code-line"></span>
<span class="code-line">    If there is a current user prompt, return error with error code session not created.</span>
<span class="code-line"></span>
<span class="code-line">    Let capabilities be the result of getting a property named &quot;capabilities&quot; from the parameters argument.</span>
<span class="code-line"></span>
<span class="code-line">    Let capabilities result be the result of processing capabilities with capabilities as an argument.</span>
<span class="code-line"></span>
<span class="code-line">    If capabilities result is an error, return error with error code session not created.</span>
<span class="code-line"></span>
<span class="code-line">    Let capabilities be capabilities result’s data.</span>
<span class="code-line"></span>
<span class="code-line">    Let session id be the result of generating a UUID.</span>
<span class="code-line"></span>
<span class="code-line">    Let session be a new session with the session ID of session id.</span>
<span class="code-line"></span>
<span class="code-line">    Set the current session to session.</span>
<span class="code-line"></span>
<span class="code-line">    Append session to active sessions.</span>
</pre></div>


<p>上面的流程已经在最新的Selenium&nbsp;WebDriver中实现了。所有启动一个浏览器做的session操作可以参考如下核心Selenium代码逻辑。</p>
<ol>
<li>
<p>第一步设置chromeDriver的路径后面代码用到：<code>System.setProperty("webdriver.chrome.driver", "chromedriver.exe");</code></p>
</li>
<li>
<p>第二步构建一个命令行对象用于执行chromedriver.exe的命令：</p>
</li>
</ol>
<div class="highlight"><pre><span class="code-line"><span></span>org.openqa.selenium.remote.service.DriverService.Builder.build()</span>
<span class="code-line"></span>
<span class="code-line">public DS build() {</span>
<span class="code-line">     if (port == 0) {</span>
<span class="code-line">       port = PortProber.findFreePort(); //可用的端口号，例如232323,那么后面用到的命令就是:chromedriver.exe –port 232323</span>
<span class="code-line">     }</span>
<span class="code-line"></span>
<span class="code-line">     if (exe == null) {</span>
<span class="code-line">       exe = findDefaultExecutable();</span>
<span class="code-line">     }</span>
<span class="code-line"></span>
<span class="code-line">     ImmutableList&lt;String&gt; args = createArgs();</span>
<span class="code-line"></span>
<span class="code-line">     return createDriverService(exe, port, args, environment);</span>
<span class="code-line">   }</span>
<span class="code-line">   ```</span>
<span class="code-line"></span>
<span class="code-line">1. 核心selenium命令执行类：`org.openqa.selenium.remote.RemoteWebDriver.RemoteWebDriver(CommandExecutor, Capabilities, Capabilities)`</span>
</pre></div>


<p>public RemoteWebDriver(CommandExecutor executor, Capabilities desiredCapabilities,
      Capabilities requiredCapabilities) {
    this.executor =&nbsp;executor;</p>
<div class="highlight"><pre><span class="code-line"><span></span>init(desiredCapabilities, requiredCapabilities);</span>
<span class="code-line"></span>
<span class="code-line">if (executor instanceof NeedsLocalLogs) {</span>
<span class="code-line">  ((NeedsLocalLogs)executor).setLocalLogs(localLogs);</span>
<span class="code-line">}</span>
<span class="code-line"></span>
<span class="code-line">try {</span>
<span class="code-line">  startClient(desiredCapabilities, requiredCapabilities);</span>
<span class="code-line">} catch (RuntimeException e) {</span>
<span class="code-line">  try {</span>
<span class="code-line">    stopClient(desiredCapabilities, requiredCapabilities);</span>
<span class="code-line">  } catch (Exception ignored) {</span>
<span class="code-line">    // Ignore the clean-up exception. We&#39;ll propagate the original failure.</span>
<span class="code-line">  }</span>
<span class="code-line"></span>
<span class="code-line">  throw e;</span>
<span class="code-line">}</span>
<span class="code-line"></span>
<span class="code-line">try {</span>
<span class="code-line">  startSession(desiredCapabilities, requiredCapabilities);</span>
<span class="code-line">} catch (RuntimeException e) {</span>
<span class="code-line">  try {</span>
<span class="code-line">    quit();</span>
<span class="code-line">  } catch (Exception ignored) {</span>
<span class="code-line">    // Ignore the clean-up exception. We&#39;ll propagate the original failure.</span>
<span class="code-line">  }</span>
<span class="code-line"></span>
<span class="code-line">  throw e;</span>
<span class="code-line">}</span>
</pre></div>


<p>}</p>
<p><span class="dquo">&#8220;</span>`</p>
<p>以上的代码完成了如下的操作：</p>
<ol>
<li>
<p>初始化desiredCapabilities对象，这是发送到客户端的JSON&nbsp;数据，</p>
</li>
<li>
<p>启动一个session，这里包含一个判断，如果这是一个NEW_SESSION，那么会在上面构建的chromedriver上启动chromedriver然后在发送session命令。后台操作HTTP请求用到的是Apache&nbsp;HttpClient的API.</p>
</li>
</ol>
<p>上面说明下WebDriver的通信是HTTP的协议，因此这里所有的通信都是通过JSON&nbsp;Wired进行沟通的RESTFul格式。也就是说所有的沟通都是一次RESTFul的request和response的过程。</p>
<p>参考如下Selenium的说明： <a href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#command-summary">https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol#command-summary</a> </p>
<ol>
<li><strong><span class="caps">JSON</span>&nbsp;Request:</strong></li>
</ol>
<p><img alt="http://images2015.cnblogs.com/blog/345627/201608/345627-20160807113920403-1198533879.png" src="http://images2015.cnblogs.com/blog/345627/201608/345627-20160807113920403-1198533879.png"></p>
<ol start="2">
<li><strong><span class="caps">JSON</span>&nbsp;Response:</strong></li>
</ol>
<p><img alt="http://images2015.cnblogs.com/blog/345627/201608/345627-20160807113921700-1847416761.png" src="http://images2015.cnblogs.com/blog/345627/201608/345627-20160807113921700-1847416761.png"></p>
<h5 id="_1">未完待续<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
                </div><!-- /.entry-content -->
                <br>
                <div><span>Categories:</span>SoftwareTesting</div>
                <br>
                <ul style="list-style-type: none;">
                        <li style="display: inline;margin-left: 10px; margin-right: auto;">
                            <a href="../../articles/selenium-currenturl/">
                                ◄&nbsp;&nbsp;Selenium得到当前页面的URL
                            </a>
                        </li>
                </ul>
                <hr/>
                <div class="comments">
                    <h3>Recommended for you</h3>
                        <ul>
                                <li><a href="../../articles/selenium-currenturl/">Selenium得到当前页面的URL</a></li>
                                <li><a href="../../articles/4-software-testing-white/">[面试] 4.&nbsp;白盒测试需要关注的知识点</a></li>
                        </ul>
                </div>
                <hr/>
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-1893384651266286"
                         data-ad-slot="1372702676"
                    ></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                    <div class="comments">
                        <h3>Comments</h3>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                            var disqus_identifier = "articles/selenium-sourcecode/";
                            (function () {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript';
                                dsq.async = true;
                                dsq.src = 'https://pingbook.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                            })();
                        </script>
                        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments
                            powered by Disqus</a>.
                        </noscript>
                    </div>

            </div><!-- /.eleven.columns -->

<div class="three columns">
    <nav class="widget sidebarbg">
        <h4>Navigation</h4>
        <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/categories">Category</a></li>
                <li><a href="/archives">Archive</a></li>
                <li><a href="/tags">Tags</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/change-log">Changes</a></li>
        </ul>
    </nav>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-format="fluid"
             data-ad-layout-key="-6t+ed+2i-1n-4w"
             data-ad-client="ca-pub-1893384651266286"
             data-ad-slot="5737546993"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        <div class="sidebarbg">
            <nav class="widget">
                <h4>Categories</h4>
                <ul class="blank">
                        <li><a href="../../category/tools/">Tools</a></li>
                        <li><a href="../../category/sql/">SQL</a></li>
                        <li><a href="../../category/softwaretesting/">SoftwareTesting</a></li>
                        <li><a href="../../category/shu-mei-pai/">树莓派</a></li>
                        <li><a href="../../category/qi-ta/">其他</a></li>
                        <li><a href="../../category/python/">Python</a></li>
                        <li><a href="../../category/mian-shi/">面试</a></li>
                        <li><a href="../../category/linux/">Linux</a></li>
                        <li><a href="../../category/javascript/">JavaScript</a></li>
                        <li><a href="../../category/java/">Java</a></li>
                        <li><a href="../../category/bo-ke-da-jian/">博客搭建</a></li>
                </ul>
            </nav>
        </div>


        <nav class="widget sidebarbg">
            <h4>Tags</h4>
            <ul class="blank">
                    <li class="tag-4"><a href="../../tag/algorithm/">Algorithm</a></li>
                    <li class="tag-4"><a href="../../tag/intellij-idea/">IntelliJ Idea</a></li>
                    <li class="tag-4"><a href="../../tag/javascript/">JavaScript</a></li>
                    <li class="tag-4"><a href="../../tag/mybatis/">Mybatis</a></li>
                    <li class="tag-1"><a href="../../tag/oracle/">Oracle</a></li>
                    <li class="tag-4"><a href="../../tag/review/">Review</a></li>
                    <li class="tag-4"><a href="../../tag/sdk/">SDK</a></li>
                    <li class="tag-2"><a href="../../tag/selenium/">Selenium</a></li>
                    <li class="tag-2"><a href="../../tag/vuejs/">Vuejs</a></li>
                    <li class="tag-2"><a href="../../tag/cordova/">cordova</a></li>
            </ul>
        </nav>

        <div class="social sidebarbg">

            <nav class="widget">
                <h4>Social</h4>
                <ul class="blank">
                        <li><a target="_blank" href="mailto:alterhu2020@gmail.com?subject=From PingBook question">gmail</a></li>
                        <li><a target="_blank" href="https://twitter.com/alterhu2020">twitter</a></li>
                        <li><a target="_blank" href="https://github.com/alterhu2020/alterhu2020.github.io">github</a></li>
                </ul>
            </nav>
        </div>
        <nav class="widget sidebarbg">
            <h4>Friends</h4>
            <ul>
                    <li><a target="_blank" href="http://www.cnblogs.com/alterhu/">我的博客园</a></li>
                    <li><a target="_blank" href="http://xiaohanyu.me/about/">[运维]Xiao Hanyu</a></li>
                    <li><a target="_blank" href="http://huangxuan.me/">[前端]黄玄的博客</a></li>
                    <li><a target="_blank" href="http://www.ruanyifeng.com/blog/">[前端]阮一峰</a></li>
                    <li><a target="_blank" href="https://kevin.deldycke.com/">[Python]Data Engineer</a></li>
            </ul>
        </nav>

</div>        </div><!-- /.row -->


    </section>

    </div><!-- /.row -->
</div><!-- /.container -->


<div class="container.nopad bg">

    <footer id="credits" class="row" style="margin-bottom: 0px;text-align: center;">
        <div class="seven columns left-center">

            <address id="about" class="vcard body">
                ©
                <script>document.write(new Date().getFullYear())</script>
                PingBook.top. Powered by <a href="http://getpelican.com/">Pelican</a>.
                <!--<br />-->
                <div>
                    <span id="busuanzi_container_site_pv">Site Views: <span id="busuanzi_value_site_pv"></span></span>,
                    <span id="busuanzi_container_site_uv">Total Vistors: <span
                            id="busuanzi_value_site_uv"></span></span>
                </div>
            </address>
        </div>


        <div class="seven columns">
            <div class="row">
                <ul class="socbtns">





                </ul>
            </div>
        </div>
    </footer>

</div>


<script type="text/javascript">
    var disqus_shortname = 'pingbook';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<script src="../../theme/js/libs/jquery-1.9.1.min.js"></script>
<script src="../../theme/js/libs/gumby.min.js"></script>
<script>
    function validateForm(query) {
        return (query.length > 0);
    }
</script>
<script async src="../../theme/js/libs/busuanzi.pure.mini.js"></script>
<script src="../../theme/js/plugins.js"></script>
</body>
</html>