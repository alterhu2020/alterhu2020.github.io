webpackJsonp([45],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-72189ace","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/Pano.vue':function(e,t){},"./src/pages/Pano.vue":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("./node_modules/babel-runtime/core-js/json/stringify.js"),n=a.n(i),o=a("./src/api/index.js"),s=a("./node_modules/vux/src/components/card/index.vue"),l=a("./node_modules/vux/src/components/form-preview/index.vue"),r=a("./node_modules/vux/src/components/popup/index.vue"),d=a("./node_modules/vux/src/components/previewer/index.vue"),c=a("./node_modules/vux/src/components/x-dialog/index.vue"),u=a("./node_modules/vux/src/components/x-header/index.vue"),h=a("./node_modules/vux/src/components/x-img/index.vue"),v=a("./src/assets/img/404.jpg"),p=a.n(v),m=a("./src/components/sticky.js"),g=a("./src/utils/WeixinV2Utils.js"),w=(c.a,l.a,h.a,s.a,d.a,r.a,u.a,m.a,{name:"panp",components:{XDialog:c.a,FormPreview:l.a,XImg:h.a,Card:s.a,Previewer:d.a,Popup:r.a,XHeader:u.a},metaInfo:function(){return{title:this.pageTitle,titleTemplate:null}},directives:{sticky:m.a},data:function(){return{showLocation:!0,showNote:!0,showNoteDetailDlg:!1,notedetail:{BusinessBill:[],DesignChangeBill:[],TechniqueChangeBill:[],ProjectVisaBill:[]},previewItems:[],NotFoundImage:p.a,pano:null,notfound:!1,pageTitle:"实景详情",renderRetry:0,panoData:{},showLocationDetail:!1}},methods:{backNotePage:function(){this.showNoteDetailDlg=!1,this.showLocation=!0,this.showNote=!0},loadPanoFile:function(){var e=document.createElement("script");e.src="https://vrpano.yitieyilu.com/static/panos/yanzhipano.js",document.body.appendChild(e),e.onload=function(){console.log("是否正确加载了全景对象: "+window.krpanoJS)}},createPano:function(){var e=this,t=this.$route.params.uuid;if(t){var a=this;this.$vux.loading.show({text:"实景加载中..."}),o.b.get("/pano/get/"+t).then(function(i){e.$vux.loading.hide();var n=i.data.code;if(1e3===n){a.panoData=i.data.data;var s=a.panoData.panoid,l=a.panoData.previewurl.split("/").slice(0,3).join("/"),r=a.panoData.url,d=a.panoData.desc,c="https://static.yitieyilu.com"+a.panoData.previewurl;""!==a.panoData.logourl&&(c="https://static.yitieyilu.com"+a.panoData.logourl),d||(d="身临其境,你的需求就是我们的追求!");var u=a.panoData.nickname?"| 作者 "+a.panoData.nickname:"",h=a.panoData.taskname+" "+u;" "!=h&&(a.pageTitle=h),e.$vux.loading.show({text:"数据加载中..."}),setTimeout(function(){Object(g.weixinShare)(h,d,"https://vrpano.yitieyilu.com/pano"+r,c),a.$vux.loading.hide()},150);var v="https://static.yitieyilu.com"+l+"/"+t+"/index.xml";console.log("加载的xml是: "+v),a.krpanoCreation(v,h,d),o.b.post("/pano/views",{panoid:s,url:r}).then(function(){})}else 9005===n?(a.$vux.toast.show({type:"warn",text:"没有找到对应的实景请确认输入合法!"}),a.notfound=!0):a.$vux.toast.show({type:"warn",text:"实景渲染遇到未知数据异常,错误代码:"+n+"请稍后重试!"})}).catch(function(t){e.$vux.loading.hide(),console.log("渲染实景遇到未知的严重异常: "+n()(t))})}else this.$vux.alert.show({title:"实景提示",content:"无法找到你输入的资源,请确认输入是否合法!"})},krpanoCreation:function(e,t,a){var i=this;try{embedpano({xml:e,swf:"../static/panos/yanzhipano.swf",target:"panoContainer",consolelog:!1,html5:"prefer+webgl",mobilescale:1,wmode:"transparent",passQueryParameters:!1,vars:{"skin_settings.locationname":t,"skin_settings.locationdesc":a},onready:function(e){e.call("trace(全景设置加载完成...)"),this.pano=e,this.pano.style.overflow="inherit"},onerror:function(e){console.log("embedpano严重问题: "+e),i.notfound=!0}})}catch(o){i.renderRetry+=1,setTimeout(function(){3>=i.renderRetry?(console.log("krpano js文件没有加载成功,2秒后重新加载: "+o+", 转换成JSON字符串是: "+n()(o)),i.krpanoCreation(e,t,a)):console.log("反复尝试加载失败,无法渲染pano页面!")},500)}},gotoLocation:function(){var e=this.panoData.lat,t=this.panoData.lng;e&&t&&0!==e&&0!==t?Object(g.weixinOpenLocation)(this.panoData.lat,this.panoData.lng,this.pageTitle,this.panoData.desc):this.$vux.alert.show({title:"查看实景坐标位置信息提示",content:"该实景对应的坐标信息为空!"})},goNoteDetailPage:function(e){var t=this;e&&o.b.get("/note/p/"+e).then(function(e){var a=e.data.code;1e3===a?(t.showNoteDetailDlg=!0,t.notedetail=e.data.data,0===t.previewItems.length&&(t.notedetail.Weather&&t.previewItems.push({label:"气象",value:t.notedetail.Weather}),t.notedetail.QualityIssue&&t.previewItems.push({label:"质量问题",value:t.notedetail.QualityIssue}),t.notedetail.SecurityIssue&&t.previewItems.push({label:"安全问题",value:t.notedetail.SecurityIssue}),t.notedetail.date&&t.previewItems.push({label:"发布时间",value:t.notedetail.date}))):1002===a&&t.$vux.alert.show({title:"查看实景施工日志提示",content:"该实景对应的施工日志为空!"})}).catch(function(e){console.log("获取对应的施工日志详细信息出错: "+e),t.$vux.toast.show({type:"warn",text:"获取对应的施工日志详细信息出错"})})}},created:function(){this.loadPanoFile()},mounted:function(){this.$store.dispatch("UpdateShowTabbar",!1),this.createPano()}}),x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("x-header",{attrs:{title:e.pageTitle,"left-options":{showBack:!0,preventGoBack:!1}}}),e._v(" "),e.notfound?a("div",{style:{background:"url("+e.NotFoundImage+")"}}):a("div",{staticStyle:{width:"100%",height:"90%",position:"absolute"},attrs:{id:"panoContainer"}},[e._m(0),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showNote,expression:"showNote"}],staticClass:"note",on:{click:function(t){e.goNoteDetailPage(e.$route.params.uuid)}}},[a("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#shigongrizhi"}})])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showLocation,expression:"showLocation"}],staticClass:"navi",on:{click:e.gotoLocation}},[a("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"#location"}})])])]),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("popup",{attrs:{height:"100%"},model:{value:e.showNoteDetailDlg,callback:function(t){e.showNoteDetailDlg=t},expression:"showNoteDetailDlg"}},[a("x-header",{directives:[{name:"sticky",rawName:"v-sticky",value:{zIndex:100,stickyTop:0,className:"sticky-buttons"},expression:"{ zIndex: 100, stickyTop: 0, className: 'sticky-buttons' }"}],attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":e.backNotePage}},[e._v("\n        "+e._s(e.notedetail.ConstructRegion)+"施工日志详情\n      ")]),e._v(" "),a("group",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.ConstructRegion,expression:"notedetail.ConstructRegion"}]},[a("x-img",{attrs:{src:e.notedetail.LogoUrl}}),e._v(" "),a("form-preview",{attrs:{"header-label":"施工部位","header-value":e.notedetail.ConstructRegion?e.notedetail.ConstructRegion:"未填","body-items":e.previewItems}})],1),e._v(" "),a("card",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.Notes,expression:"notedetail.Notes"}],staticClass:"notedetail",attrs:{header:{title:"施工日志详细内容"}}},[a("p",{staticStyle:{"word-wrap":"break-word"},attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.notedetail.Notes?e.notedetail.Notes:"未填"))])]),e._v(" "),a("card",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.PriviateRegion,expression:"notedetail.PriviateRegion"}],staticClass:"notedetail",attrs:{header:{title:"隐蔽工程验收部位"}}},[a("p",{staticStyle:{"word-wrap":"break-word"},attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.notedetail.PriviateRegion?e.notedetail.PriviateRegion:"未填"))])]),e._v(" "),a("card",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.MaterialSample,expression:"notedetail.MaterialSample"}],staticClass:"notedetail",attrs:{header:{title:"材料进场,送检情况"}}},[a("p",{staticStyle:{"word-wrap":"break-word"},attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.notedetail.MaterialSample?e.notedetail.MaterialSample:"未填"))])]),e._v(" "),a("cell",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.BusinessBill.length>0,expression:"notedetail.BusinessBill.length>0"}],attrs:{title:"业务联系单","inline-desc":e.notedetail.BusinessBill.length>0?"点击查看业务联系单(上传成功)":"业务联系单未上传"}},[a("span",[0===e.notedetail.BusinessBill.length?a("svg",{staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},slot:"icon"},[a("use",{attrs:{"xlink:href":"#upload"}})]):e._l(e.notedetail.BusinessBill,function(t,i){return a("span",{key:i},[a("img",{attrs:{src:t.src,alt:"未上传",width:"25",height:"25"},on:{click:function(t){e.$refs.bussinessbillpreviewer.show(i)}}})])}),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("previewer",{ref:"bussinessbillpreviewer",attrs:{list:e.notedetail.BusinessBill}})],1)],2)]),e._v(" "),a("cell",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.DesignChangeBill.length>0,expression:"notedetail.DesignChangeBill.length>0"}],attrs:{title:"设计变更单","inline-desc":e.notedetail.DesignChangeBill.length>0?"点击查看设计变更单(上传成功)":"设计变更单未上传"}},[a("span",[0===e.notedetail.DesignChangeBill.length?a("svg",{staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},slot:"icon"},[a("use",{attrs:{"xlink:href":"#upload"}})]):e._l(e.notedetail.DesignChangeBill,function(t,i){return a("span",{key:i},[a("img",{attrs:{src:t.src,alt:"未上传",width:"25",height:"25"},on:{click:function(t){e.$refs.designchangebillpreviewer.show(i)}}}),e._v("\n                \n               ")])}),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("previewer",{ref:"designchangebillpreviewer",attrs:{list:e.notedetail.DesignChangeBill}})],1)],2)]),e._v(" "),a("cell",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.TechniqueChangeBill.length>0,expression:"notedetail.TechniqueChangeBill.length>0"}],attrs:{title:"技术变更单","inline-desc":e.notedetail.TechniqueChangeBill.length>0?"点击查看技术变更单(上传成功)":"技术变更单未上传"}},[a("span",[0===e.notedetail.TechniqueChangeBill.length?a("svg",{staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},slot:"icon"},[a("use",{attrs:{"xlink:href":"#upload"}})]):e._l(e.notedetail.TechniqueChangeBill,function(t,i){return a("span",{key:i},[a("img",{attrs:{src:t.src,alt:"未上传",width:"25",height:"25"},on:{click:function(t){e.$refs.techniquechangebillpreviewer.show(i)}}})])}),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("previewer",{ref:"techniquechangebillpreviewer",attrs:{list:e.notedetail.TechniqueChangeBill}})],1)],2)]),e._v(" "),a("cell",{directives:[{name:"show",rawName:"v-show",value:e.notedetail.ProjectVisaBill.length>0,expression:"notedetail.ProjectVisaBill.length>0"}],attrs:{title:"工程签证单","inline-desc":e.notedetail.ProjectVisaBill.length>0?"点击查看工程签证单(上传成功)":"工程签证单未上传"}},[a("span",[0===e.notedetail.ProjectVisaBill.length?a("svg",{staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},slot:"icon"},[a("use",{attrs:{"xlink:href":"#upload"}})]):e._l(e.notedetail.ProjectVisaBill,function(t,i){return a("span",{key:i},[a("img",{attrs:{src:t.src,alt:"未上传",width:"25",height:"25"},on:{click:function(t){e.$refs.projectvisabillpreviewer.show(i)}}}),e._v("\n                \n               ")])}),e._v(" "),a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[a("previewer",{ref:"projectvisabillpreviewer",attrs:{list:e.notedetail.ProjectVisaBill}})],1)],2)])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("noscript",[t("table",{staticStyle:{width:"100%",height:"100%"}},[t("tr",{staticStyle:{"vertical-align":"middle"}},[t("td",[t("div",{staticStyle:{"text-align":"center"}},[this._v("错误:\n              "),t("br"),this._v(" "),t("br"),this._v("Javascript 不可用!\n              "),t("br"),this._v(" "),t("br")])])])])])}]};var f=a("./node_modules/vue-loader/lib/component-normalizer.js")(w,x,!1,function(e){a('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-72189ace","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/Pano.vue')},"data-v-72189ace",null);t.default=f.exports}});