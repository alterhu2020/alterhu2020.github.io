webpackJsonp([54],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-42a13c72","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoContractWorkflowAdd.vue':function(e,o){},"./src/pages/PanoContractWorkflowAdd.vue":function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=t("./node_modules/vux/src/components/load-more/index.vue"),l=t("./node_modules/vux/src/components/flexbox/flexbox.vue"),r=t("./node_modules/vux/src/components/flexbox/flexbox-item.vue"),a=t("./node_modules/vux/src/components/spinner/index.vue"),n=t("./node_modules/vux/src/components/x-switch/index.vue"),i=t("./node_modules/vux/src/components/flow/flow.vue"),d=t("./node_modules/vux/src/components/flow/flow-state.vue"),c=t("./node_modules/vux/src/components/flow/flow-line.vue"),u=t("./node_modules/vux/src/components/group-title/index.vue"),w=t("./src/components/SearchCheckList.vue"),m=t("./src/api/index.js"),f=t("./src/utils/StoreUtils.js"),h=t("./src/webconfig.js"),p=t("./node_modules/vue-feather-icons/dist/vue-feather-icons.es.js"),v=(s.a,l.a,r.a,w.a,a.a,n.a,i.a,d.a,c.a,p.d,u.a,{name:"PanoContractWorkflow",components:{LoadMore:s.a,Flexbox:l.a,FlexboxItem:r.a,SearchCheckList:w.a,Spinner:a.a,XSwitch:n.a,Flow:i.a,FlowState:d.a,FlowLine:c.a,PlusIcon:p.d,GroupTitle:u.a},data:function(){return{shouldHover:!0,customerdata:null,showAddWorflowSubmit:!0,workflowname:"",defaultworkflow:"0",approvers:[],approversModel:[],showAddWorkflowItemDlg:!1,workflowItems:[],workflowItem:{title:"",item:{}}}},methods:{showAddworkflowItemHandle:function(){this.showAddWorkflowItemDlg=!0,this.workflowItem.title="",this.workflowItem.item={},this.fetchCompanyUsers()},addWorkflowItemBack:function(){this.showAddWorkflowItemDlg=!1,""!==this.workflowItem.title&&{}!==this.workflowItem.item?this.workflowItems.push({title:this.workflowItem.title,key:this.workflowItem.item.key,name:this.workflowItem.item.name,openid:this.workflowItem.item.openid}):this.$vux.toast.show({type:"warn",time:2e3,text:"签字流子项的部门名称和人员不能为空！"})},approverCheckChange:function(e,o){if(0<o.length){var t=o[0].toString(),s=e[0].split(",")[0],l=e[0].split(",")[1];this.workflowItem.item={name:t,key:s,openid:l}}},fetchCompanyUsers:function(){var e=this,o=this.customerdata.companyid;this.$vux.loading.show({text:"正在加载数据..."}),this.approvers=[],m.b.get("/contract/users/"+o).then(function(o){var t=o.data.code;(e.$vux.loading.hide(),1e3===t)&&o.data.data.forEach(function(o){e.approvers.push({key:[o.userid,o.openid].toString(),value:o.nickname})})}).catch(function(o){e.$vux.loading.hide(),console.log("获取账号列表出错: "+o)})},handleAddWorkflowRequest:function(){var e=this;if(this.workflowname)if(0!==this.workflowItems.length){this.showAddWorflowSubmit=!1,this.$vux.loading.show({text:"正在提交数据..."});var o={companyid:this.customerdata.companyid,userid:this.customerdata.userid,name:this.workflowname,workflows:this.workflowItems,isdefault:this.defaultworkflow};m.b.post("/workflow/add",o).then(function(o){var t=o.data.code;e.showAddWorflowSubmit=!0,e.$vux.loading.hide(),1e3===t&&e.$router.push({name:"pcontractworkflow"})}).catch(function(o){e.$vux.loading.hide(),e.showAddWorflowSubmit=!0,alert("新建签字流报错: "+o)})}else this.$vux.toast.show({type:"warn",time:4e3,text:"签字流的签字流程不能为空！"});else this.$vux.toast.show({type:"warn",time:4e3,text:"签字流的名称不能为空！"})}},mounted:function(){this.$store.dispatch("UpdateShowHeader",!1),this.$store.dispatch("UpdateShowTabbar",!1);var e=f.a.get(h.a.StoreUserInfoKey);e&&(this.customerdata=e.customerdata)}}),k={render:function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("x-header",{attrs:{title:"签字流","left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(o){e.$router.push({name:"pcontractworkflow"})}}},[e.showAddWorflowSubmit?t("span",{staticStyle:{"font-size":"16px"},attrs:{slot:"right"},on:{click:e.handleAddWorkflowRequest},slot:"right"},[e._v("\n           提交\n           ")]):t("spinner",{attrs:{slot:"right",type:"android",size:"28px"},slot:"right"})],1),e._v(" "),t("div",[t("div",[t("group",{attrs:{title:"签字流基本设置"}},[t("x-input",{attrs:{title:"名称",placeholder:"输入该签字流的名称"},model:{value:e.workflowname,callback:function(o){e.workflowname=o},expression:"workflowname"}}),e._v(" "),t("x-switch",{attrs:{title:"设为我的默认签字流","value-map":["0","1"]},model:{value:e.defaultworkflow,callback:function(o){e.defaultworkflow=o},expression:"defaultworkflow"}})],1),e._v(" "),t("flexbox",[t("flexbox-item",{attrs:{span:10}},[t("group-title",{staticStyle:{"font-size":"14px !important"}},[e._v(" 设置签字流签字流程")])],1),e._v(" "),t("flexbox-item",[t("div",{class:[{hover:e.shouldHover}],staticStyle:{width:"25px",height:"25px","background-color":"#04be02","border-radius":"25px",cursor:"pointer"},on:{mouseenter:function(o){e.shouldHover=!0},mouseleave:function(o){e.shouldHover=!1},click:e.showAddworkflowItemHandle}},[e._t("default",[t("plus-icon",{staticStyle:{color:"white"}})])],2)])],1),e._v(" "),e.workflowItems.length>0?t("flow",{staticStyle:{height:"200px","margin-left":"-210px"},attrs:{orientation:"vertical"}},[e._l(e.workflowItems,function(o,s){return[t("flow-state",{key:s+"state",attrs:{state:s+1,"is-done":""}},[t("span",{attrs:{slot:"title"},on:{click:function(t){e.clickWorkflowItemHandle(o)}},slot:"title"},[e._v(" "+e._s(o.title+"("+o.name+")"))])]),e._v(" "),s+1<e.workflowItems.length?t("flow-line",{key:s+"line",attrs:{"is-done":""}}):e._e()]})],2):t("div",[t("br"),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),t("br"),e._v(" "),t("load-more",{attrs:{"show-loading":!1,tip:"当前没有签字流子项数据！"}}),e._v(" "),t("flexbox",[t("flexbox-item",{attrs:{span:3}}),e._v(" "),t("flexbox-item",[t("x-button",{attrs:{type:"primary","action-type":"button",mini:""},nativeOn:{click:function(o){return e.showAddworkflowItemHandle(o)}}},[e._v("新建签字流子项\n                  ")])],1)],1)],1)],1),e._v(" "),t("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[t("popup",{attrs:{height:"100%"},model:{value:e.showAddWorkflowItemDlg,callback:function(o){e.showAddWorkflowItemDlg=o},expression:"showAddWorkflowItemDlg"}},[t("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":e.addWorkflowItemBack}},[e._v("\n          新建签字流子项\n        ")]),e._v(" "),t("div",[t("group",[t("x-input",{attrs:{title:"部门名称",placeholder:"请输入签名栏对应的部门名称"},model:{value:e.workflowItem.title,callback:function(o){e.$set(e.workflowItem,"title",o)},expression:"workflowItem.title"}}),e._v(" "),t("search-check-list",{attrs:{showSearch:!1,data:e.approvers,keyword:"签字人员",max:1},on:{"on-change":e.approverCheckChange},model:{value:e.approversModel,callback:function(o){e.approversModel=o},expression:"approversModel"}})],1)],1)],1)],1)])],1)},staticRenderFns:[]};var x=t("./node_modules/vue-loader/lib/component-normalizer.js")(v,k,!1,function(e){t('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-42a13c72","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoContractWorkflowAdd.vue')},"data-v-42a13c72",null);o.default=x.exports}});