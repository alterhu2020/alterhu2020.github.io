webpackJsonp([17],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-279ecb04","scoped":false,"hasInlineConfig":false}!./node_modules/vux-loader/src/after-less-loader.js!./node_modules/less-loader/index.js?{"minimize":true,"sourceMap":true}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./node_modules/vux/src/components/cell-box/index.vue':function(e,t){},'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-3d2bfcb1","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoNote.vue':function(e,t){},'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-4f3bae3e","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/components/NoteAdd.vue':function(e,t){},"./node_modules/vux/src/components/cell-box/index.vue":function(e,t,o){"use strict";var n=o("./node_modules/vux/src/libs/router.js"),s=(Boolean,String,Object,Boolean,Boolean,String,{name:"cell-box",props:{isLink:Boolean,link:[String,Object],borderIntent:{type:Boolean,default:!0},noFlex:Boolean,alignItems:String},computed:{style:function(){if(this.alignItems)return{"align-items":this.alignItems}},className:function(){return{"vux-tap-active":this.isLink||!!this.link,"weui-cell_access":this.isLink||!!this.link,"vux-cell-no-border-intent":!this.borderIntent}}},methods:{onClick:function(){this.link&&Object(n.b)(this.link,this.$router)}}}),i={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"vux-cell-box weui-cell",class:this.className,style:this.style,on:{click:this.onClick}},[this._t("default")],2)},staticRenderFns:[]};var a=o("./node_modules/vue-loader/lib/component-normalizer.js")(s,i,!1,function(e){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-279ecb04","scoped":false,"hasInlineConfig":false}!./node_modules/vux-loader/src/after-less-loader.js!./node_modules/less-loader/index.js?{"minimize":true,"sourceMap":true}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./node_modules/vux/src/components/cell-box/index.vue')},null,null);t.a=a.exports},"./src/pages/PanoNote.vue":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("./src/utils/StoreUtils.js"),s=o("./src/webconfig.js"),i=o("./node_modules/vux/src/components/card/index.vue"),a=o("./node_modules/vux/src/components/form-preview/index.vue"),l=o("./node_modules/vux/src/components/group-title/index.vue"),r=o("./node_modules/vux/src/components/load-more/index.vue"),u=o("./node_modules/vux/src/components/popup/index.vue"),c=o("./node_modules/vux/src/components/previewer/index.vue"),d=o("./node_modules/vux/src/components/x-img/index.vue"),h=o("./node_modules/vux/src/components/cell-box/index.vue"),g=o("./node_modules/vux/src/components/x-textarea/index.vue"),m=o("./node_modules/vux/src/components/flexbox/flexbox.vue"),v=o("./node_modules/vux/src/components/flexbox/flexbox-item.vue"),p=o("./node_modules/vux/src/components/grid/grid.vue"),f=o("./node_modules/vux/src/components/grid/grid-item.vue"),b=o("./node_modules/vux/src/components/spinner/index.vue"),x=o("./node_modules/vux/src/components/scroller/index.vue"),N=o("./src/api/index.js"),w=o("./src/components/sticky.js"),I=o("./node_modules/vue-feather-icons/dist/vue-feather-icons.es.js"),_=o("./src/components/NoteDetail.vue"),y=o("./node_modules/babel-runtime/helpers/slicedToArray.js"),S=o.n(y),k=o("./node_modules/babel-runtime/core-js/object/entries.js"),P=o.n(k),j=o("./node_modules/babel-runtime/core-js/json/stringify.js"),B=o.n(j),D=o("./node_modules/vux/src/components/box/index.vue"),C=o("./src/utils/ElectronUtils.js"),$=o("./src/utils/PlatformUtils.js"),q=(u.a,D.a,g.a,c.a,b.a,Boolean,Object,{name:"NoteAdd",components:{Popup:u.a,Box:D.a,XTextarea:g.a,Previewer:c.a,Spinner:b.a},data:function(){return{currentNoteInfo:this.noteInfo,currentNoteId:this.noteid,addNoteDlgTitle:"新增施工日志",showSubmitButton:!0,submitButtonText:"",showNewNoteDetailDlg:!1,showQualityIssueDlg:!1,showSecurityIssueDlg:!1,showNotePrivateRegionDlg:!1,showNoteMaterialSamapleDlg:!1,billImageSize:5,bussinessbillImages:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).bussinessbill:[],designchangebillImages:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).designchangebill:[],techniquechangebillImages:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).techniquechangebill:[],projectvisabillImages:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).projectvisabill:[]}},props:{show:{type:Boolean,default:!1},noteid:null,noteInfo:{type:Object,default:function(){return{region:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).region:"",weather:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).weather:"",detail:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).detail:"",qualityissue:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).qualityissue:"",securityissue:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).securityissue:"",bussinessbill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).bussinessbill:[],designchangebill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).designchangebill:[],techniquechangebill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).techniquechangebill:[],projectvisabill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).projectvisabill:[],privateregion:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).privateregion:"",materialsample:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).materialsample:""}}}},watch:{noteid:function(e){this.currentNoteId=e,this.addNoteDlgTitle=this.currentNoteId?"修改更新施工日志":"新增施工日志"},noteInfo:function(e){this.currentNoteInfo=e,this.bussinessbillImages=this.currentNoteInfo.bussinessbill,this.designchangebillImages=this.currentNoteInfo.designchangebill,this.techniquechangebillImages=this.currentNoteInfo.techniquechangebill,this.projectvisabillImages=this.currentNoteInfo.projectvisabill,console.log("更新的日志信息： "+B()(this.currentNoteInfo)+", 对应的业务单是: "+B()(this.bussinessbillImages))}},methods:{addPanoNoteDlgBack:function(){this.$emit("on-click-back")},savePanoNoteChanges:function(){n.a.set(s.a.StorePanoNote,this.currentNoteInfo)},uploadBillImage:function(e){var t=this,o=s.a.ApiServerURI+"/v1/upload/file";console.log("上传的地址是: "+o),this.$device.isWechat?this.$wechat.chooseImage({count:1,sizeType:["original"],sourceType:["album"],success:function(i){var a=i.localIds[0];t.$wechat.uploadImage({localId:a.toString(),isShowProgressTips:1,success:function(i){var a=i.serverId,l=new FormData;P()({type:6}).forEach(function(e){var t=S()(e,2),o=t[0],n=t[1];l.append(o,n)}),l.append("mediaid",a),N.b.post(o,l,{headers:{"Content-Type":"multipart/form-data"}}).then(function(o){if(1e3===o.data.code){t.loading=!1;var i=o.data.data.url;1===e?(t.$vux.toast.show({text:"业务联系单上传成功!"}),t.bussinessbillImages.push({src:i,msrc:i,w:1200,h:1100}),t.currentNoteInfo.bussinessbill=t.bussinessbillImages):2===e?(t.$vux.toast.show({text:"设计变更单上传成功!"}),t.designchangebillImages.push({src:i,msrc:i,w:1200,h:1100}),t.currentNoteInfo.designchangebill=t.designchangebillImages):3===e?(t.$vux.toast.show({text:"技术变更单上传成功!"}),t.techniquechangebillImages.push({src:i,msrc:i,w:1200,h:1100}),t.currentNoteInfo.techniquechangebill=t.techniquechangebillImages):4===e&&(t.$vux.toast.show({text:"工程签证单上传成功!"}),t.projectvisabillImages.push({src:i,msrc:i,w:1200,h:1100}),t.currentNoteInfo.projectvisabill=t.projectvisabillImages),n.a.set(s.a.StorePanoNote,t.noteInfo)}}).catch(function(e){t.loading=!1,t.onError(e,a)})},cancel:function(){t.loading=!1},fail:function(e){t.loading=!1,t.$vux.toast.show({type:"warn",text:"微信接口异常出错无法上传,错误代码:"+B()(e)})}})}}):this.$vux.toast.show({type:"warn",time:6e3,text:"上传只能在手机微信端操作，你可以先保存当前录入信息，然后再在手机上修改操作！"})},handleSubmitNote:function(){var e=this;if(""===this.currentNoteInfo.detail)this.$vux.alert.show({title:"施工日志提示",content:"施工日志内容不能为空!"});else{this.$vux.loading.show({text:"正在发表施工日志中...",position:"absolute"});var t=n.a.get(s.a.StoreUserInfoKey).customerdata.userid,o={noteinfo:this.currentNoteInfo,openid:t,noteid:this.currentNoteId};this.showSubmitButton=!1,N.b.post("/pano/newnote",o).then(function(t){setTimeout(function(){e.$vux.loading.hide(),e.showSubmitButton=!0,1e3===t.data.code&&(e.$vux.toast.show({text:"施工日志发表成功!"}),n.a.remove(s.a.StorePanoNote),Object($.b)()?e.$router.go(0):Object(C.b)())},3e3)}).catch(function(t){e.showSubmitButton=!0,e.$vux.loading.hide(),alert("上传施工日志异常,错误代码: "+t)})}}},mounted:function(){this.submitButtonText="保存",console.log("获得id: "+this.currentNoteId)}}),O={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[o("x-header",{attrs:{title:e.addNoteDlgTitle,"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":e.addPanoNoteDlgBack}},[e.showSubmitButton?o("span",{staticStyle:{"font-size":"16px"},attrs:{slot:"right"},on:{click:e.handleSubmitNote},slot:"right"},[e._v("\n          "+e._s(e.submitButtonText)+"\n        ")]):o("spinner",{attrs:{slot:"right",type:"android",size:"28px"},slot:"right"})],1),e._v(" "),o("group",{attrs:{title:"请输入详细施工日志信息"}},[o("x-input",{attrs:{max:500,title:"施工部位",placeholder:"请输入施工部位信息(可选)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.region,callback:function(t){e.$set(e.currentNoteInfo,"region","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.region"}}),e._v(" "),o("x-input",{attrs:{title:"气象",max:500,placeholder:"请输入气象相关信息(可选)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.weather,callback:function(t){e.$set(e.currentNoteInfo,"weather","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.weather"}}),e._v(" "),o("cell",{attrs:{value:e.currentNoteInfo.detail.length>=7?e.currentNoteInfo.detail.substr(0,7):e.currentNoteInfo.detail,"is-link":"","border-intent":!1},nativeOn:{click:function(t){e.showNewNoteDetailDlg=!0}}},[o("div",{attrs:{slot:"icon"},slot:"icon"},[o("span",{staticStyle:{color:"red"}},[e._v("*")]),e._v(" 施工日志内容(必填)\n          ")])]),e._v(" "),o("cell",{attrs:{title:"质量问题","inline-desc":"点击输入对应的质量问题(可选)",value:e.currentNoteInfo.qualityissue.length>=7?e.currentNoteInfo.qualityissue.substr(0,7):e.currentNoteInfo.qualityissue,"is-link":"","border-intent":!1},nativeOn:{click:function(t){e.showQualityIssueDlg=!0}}}),e._v(" "),o("cell",{attrs:{title:"安全问题","inline-desc":"点击输入对应的安全问题(可选)",value:e.currentNoteInfo.securityissue.length>=7?e.currentNoteInfo.securityissue.substr(0,7):e.currentNoteInfo.securityissue,"is-link":"","border-intent":!1},nativeOn:{click:function(t){e.showSecurityIssueDlg=!0}}})],1),e._v(" "),o("group",{attrs:{title:"业务联系单，设计变更单，技术变更单，工程签证单"}},[o("cell",{attrs:{title:"业务联系单","inline-desc":e.bussinessbillImages.length>0?"上传成功!":"点击图标上传业务联系单(可选,最多6张)"}},[o("span",[e._l(e.bussinessbillImages,function(t,n){return o("span",{key:n},[o("img",{attrs:{src:"https://static.yitieyilu.com"+t.src,width:"25",height:"25"},on:{click:function(t){e.$refs.bussinessbillpreviewer.show(n)}}}),e._v("\n             \n            ")])}),e._v(" "),o("svg",{directives:[{name:"show",rawName:"v-show",value:e.bussinessbillImages.length<=e.billImageSize,expression:"bussinessbillImages.length <= billImageSize"}],staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},on:{click:function(t){e.uploadBillImage(1)}},slot:"icon"},[o("use",{attrs:{"xlink:href":"#upload"}})]),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("previewer",{ref:"bussinessbillpreviewer",attrs:{list:e.bussinessbillImages}})],1)],2)]),e._v(" "),o("cell",{attrs:{title:"设计变更单","inline-desc":e.designchangebillImages.length>0?"上传成功!":"点击图标上传设计变更单(可选,最多6张)"}},[o("span",[e._l(e.designchangebillImages,function(t,n){return o("span",{key:n},[o("img",{attrs:{src:"https://static.yitieyilu.com"+t.src,width:"25",height:"25"},on:{click:function(t){e.$refs.designchangebillpreviewer.show(n)}}}),e._v("\n                \n             ")])}),e._v(" "),o("svg",{directives:[{name:"show",rawName:"v-show",value:e.designchangebillImages.length<=e.billImageSize,expression:"designchangebillImages.length <= billImageSize"}],staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},on:{click:function(t){e.uploadBillImage(2)}},slot:"icon"},[o("use",{attrs:{"xlink:href":"#upload"}})]),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("previewer",{ref:"designchangebillpreviewer",attrs:{list:e.designchangebillImages}})],1)],2)]),e._v(" "),o("cell",{attrs:{title:"技术变更单","inline-desc":e.techniquechangebillImages.length>0?"上传成功!":"点击图标上传技术变更单(可选,最多6张)"}},[o("span",[e._l(e.techniquechangebillImages,function(t,n){return o("span",{key:n},[o("img",{attrs:{src:"https://static.yitieyilu.com"+t.src,width:"25",height:"25"},on:{click:function(t){e.$refs.techniquechangebillpreviewer.show(n)}}}),e._v("\n              \n             ")])}),e._v(" "),o("svg",{directives:[{name:"show",rawName:"v-show",value:e.techniquechangebillImages.length<=e.billImageSize,expression:"techniquechangebillImages.length <=billImageSize"}],staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},on:{click:function(t){e.uploadBillImage(3)}},slot:"icon"},[o("use",{attrs:{"xlink:href":"#upload"}})]),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("previewer",{ref:"techniquechangebillpreviewer",attrs:{list:e.techniquechangebillImages}})],1)],2)]),e._v(" "),o("cell",{attrs:{title:"工程签证单/现场图片","inline-desc":e.projectvisabillImages.length>0?"上传成功!":"点击图标上传工程签证单或现场照片(可选,最多6张)"}},[o("span",[e._l(e.projectvisabillImages,function(t,n){return o("span",{key:n},[o("img",{attrs:{src:"https://static.yitieyilu.com"+t.src,width:"25",height:"25"},on:{click:function(t){e.$refs.projectvisabillpreviewer.show(n)}}}),e._v("\n              \n             ")])}),e._v(" "),o("svg",{directives:[{name:"show",rawName:"v-show",value:e.projectvisabillImages.length<=e.billImageSize,expression:"projectvisabillImages.length <=billImageSize"}],staticClass:"icon",staticStyle:{height:"25px",width:"25px"},attrs:{slot:"icon","aria-hidden":"true"},on:{click:function(t){e.uploadBillImage(4)}},slot:"icon"},[o("use",{attrs:{"xlink:href":"#upload"}})]),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("previewer",{ref:"projectvisabillpreviewer",attrs:{list:e.projectvisabillImages}})],1)],2)])],1),e._v(" "),o("group",{attrs:{title:"验收部位和送检情况"}},[o("cell",{attrs:{title:"隐蔽工程验收部位","inline-desc":"点击输入工程验收部位信息(可选)",value:e.currentNoteInfo.privateregion.length>=7?e.currentNoteInfo.privateregion.substr(0,7):e.currentNoteInfo.privateregion,"is-link":"","border-intent":!1},nativeOn:{click:function(t){e.showNotePrivateRegionDlg=!0}}}),e._v(" "),o("cell",{attrs:{title:"材料进场,送检情况","inline-desc":"点击输入进场送检信息(可选)",value:e.currentNoteInfo.materialsample.length>=7?e.currentNoteInfo.materialsample.substr(0,7):e.currentNoteInfo.materialsample,"is-link":"","border-intent":!1},nativeOn:{click:function(t){e.showNoteMaterialSamapleDlg=!0}}})],1)],1)],1),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%",position:"bottom","show-mask":""},model:{value:e.showNewNoteDetailDlg,callback:function(t){e.showNewNoteDetailDlg=t},expression:"showNewNoteDetailDlg"}},[o("box",{attrs:{gap:"10px 10px"}},[o("x-button",{attrs:{type:"warn"},nativeOn:{click:function(t){e.showNewNoteDetailDlg=!1}}},[e._v("关闭")])],1),e._v(" "),o("div",[o("group",[o("x-textarea",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"show-counter":!0,height:450,min:3,max:1500,placeholder:"输入施工日志的详细内容(必填)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.detail,callback:function(t){e.$set(e.currentNoteInfo,"detail","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.detail"}})],1)],1)],1)],1),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%",position:"bottom","show-mask":""},model:{value:e.showQualityIssueDlg,callback:function(t){e.showQualityIssueDlg=t},expression:"showQualityIssueDlg"}},[o("box",{attrs:{gap:"10px 10px"}},[o("x-button",{attrs:{type:"warn"},nativeOn:{click:function(t){e.showQualityIssueDlg=!1}}},[e._v("关闭")])],1),e._v(" "),o("div",[o("group",[o("x-textarea",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"show-counter":!0,height:450,min:3,max:1500,placeholder:"输入当天施工的质量问题(可选)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.qualityissue,callback:function(t){e.$set(e.currentNoteInfo,"qualityissue","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.qualityissue"}})],1)],1)],1)],1),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%",position:"bottom","show-mask":""},model:{value:e.showSecurityIssueDlg,callback:function(t){e.showSecurityIssueDlg=t},expression:"showSecurityIssueDlg"}},[o("box",{attrs:{gap:"10px 10px"}},[o("x-button",{attrs:{type:"warn"},nativeOn:{click:function(t){e.showSecurityIssueDlg=!1}}},[e._v("关闭")])],1),e._v(" "),o("div",[o("group",[o("x-textarea",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"show-counter":!0,height:450,min:3,max:1500,placeholder:"输入当天施工日志的安全问题(可选)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.securityissue,callback:function(t){e.$set(e.currentNoteInfo,"securityissue","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.securityissue"}})],1)],1)],1)],1),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%",position:"bottom","show-mask":""},model:{value:e.showNotePrivateRegionDlg,callback:function(t){e.showNotePrivateRegionDlg=t},expression:"showNotePrivateRegionDlg"}},[o("box",{attrs:{gap:"10px 10px"}},[o("x-button",{attrs:{type:"warn"},nativeOn:{click:function(t){e.showNotePrivateRegionDlg=!1}}},[e._v("关闭")])],1),e._v(" "),o("div",[o("group",[o("x-textarea",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"show-counter":!0,height:450,min:3,max:1500,placeholder:"输入当天隐蔽工程验收部位的详细内容(可选)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.privateregion,callback:function(t){e.$set(e.currentNoteInfo,"privateregion","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.privateregion"}})],1)],1)],1)],1),e._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%",position:"bottom","show-mask":""},model:{value:e.showNoteMaterialSamapleDlg,callback:function(t){e.showNoteMaterialSamapleDlg=t},expression:"showNoteMaterialSamapleDlg"}},[o("box",{attrs:{gap:"10px 10px"}},[o("x-button",{attrs:{type:"warn"},nativeOn:{click:function(t){e.showNoteMaterialSamapleDlg=!1}}},[e._v("关闭")])],1),e._v(" "),o("div",[o("group",[o("x-textarea",{directives:[{name:"focus",rawName:"v-focus"}],attrs:{"show-counter":!0,height:450,min:3,max:1500,placeholder:"输入当天材料进场,送检情况的详细内容(可选)"},on:{"on-change":e.savePanoNoteChanges},model:{value:e.currentNoteInfo.materialsample,callback:function(t){e.$set(e.currentNoteInfo,"materialsample","string"==typeof t?t.trim():t)},expression:"currentNoteInfo.materialsample"}})],1)],1)],1)],1)])},staticRenderFns:[]};var M=o("./node_modules/vue-loader/lib/component-normalizer.js")(q,O,!1,function(e){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-4f3bae3e","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/components/NoteAdd.vue')},"data-v-4f3bae3e",null).exports,T=(u.a,a.a,d.a,i.a,c.a,r.a,l.a,h.a,g.a,I.d,m.a,v.a,p.a,f.a,b.a,_.a,x.a,w.a,{metaInfo:{title:"我的施工日志",titleTemplate:null},name:"UserCard",components:{Popup:u.a,FormPreview:a.a,XImg:d.a,Card:i.a,Previewer:c.a,LoadMore:r.a,GroupTitle:l.a,CellBox:h.a,XTextarea:g.a,PlusIcon:I.d,Flexbox:m.a,FlexboxItem:v.a,Grid:p.a,GridItem:f.a,Spinner:b.a,NoteDetail:_.a,NoteAdd:M,Scroller:x.a},directives:{sticky:w.a},data:function(){return{openid:null,notes:[],showNoteDetailDlg:!1,notedetail:{ConstructRegion:"",nickname:"",previewItems:[],Notes:"",PriviateRegion:"",MaterialSample:"",BusinessBill:[],DesignChangeBill:[],TechniqueChangeBill:[],ProjectVisaBill:[]},showAddNoteDlg:!1,noteInfo:{region:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).region:"",weather:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).weather:"",detail:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).detail:"",qualityissue:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).qualityissue:"",securityissue:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).securityissue:"",bussinessbill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).bussinessbill:[],designchangebill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).designchangebill:[],techniquechangebill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).techniquechangebill:[],projectvisabill:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).projectvisabill:[],privateregion:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).privateregion:"",materialsample:n.a.get(s.a.StorePanoNote)?n.a.get(s.a.StorePanoNote).materialsample:""},updateNoteId:null,showAddBtn:!0,shouldHover:!0}},methods:{loadMoreNote:function(){this.fetchMyNotes(20,this.notes.length,!0)},refreshNote:function(){this.fetchMyNotes(20,0,!0)},fetchMyNotes:function(e,t,o){var i=this,a=n.a.get(s.a.StoreUserInfoKey).customerdata.userid;if(a){this.$vux.loading.show({text:"数据加载中..."});var l=this;N.b.get("/note/"+a+"/"+e+"/"+t).then(function(e){l.$vux.loading.hide();var n=e.data.code;if(1e3===n){var s=e.data.data;l.notes=0===t?s:l.notes.concat(s),o&&(i.$refs.notescroller.donePullup(),i.$refs.notescroller.donePulldown())}else 1002===n&&o&&i.$vux.toast.show({text:"已经到底了，没有更多数据了！"})}).catch(function(e){l.$vux.loading.hide(),l.$vux.toast.show({type:"warn",text:"获取用户的日志信息失败! "+e})})}},goNoteDetailPage:function(e){this.showAddBtn=!1,this.showNoteDetailDlg=!0,"string"==typeof e.BusinessBill&&""!==e.BusinessBill&&(e.BusinessBill=JSON.parse(e.BusinessBill)),"string"==typeof e.DesignChangeBill&&""!==e.DesignChangeBill&&(e.DesignChangeBill=JSON.parse(e.DesignChangeBill)),"string"==typeof e.TechniqueChangeBill&&""!==e.TechniqueChangeBill&&(e.TechniqueChangeBill=JSON.parse(e.TechniqueChangeBill)),"string"==typeof e.ProjectVisaBill&&""!==e.ProjectVisaBill&&(e.ProjectVisaBill=JSON.parse(e.ProjectVisaBill)),this.notedetail=e,this.notedetail.previewItems=[],0===this.notedetail.previewItems.length&&(this.notedetail.ConstructRegion&&this.notedetail.previewItems.push({label:"施工部位",value:this.notedetail.ConstructRegion}),this.notedetail.Weather&&this.notedetail.previewItems.push({label:"气象",value:this.notedetail.Weather}),this.notedetail.QualityIssue&&this.notedetail.previewItems.push({label:"质量问题",value:this.notedetail.QualityIssue}),this.notedetail.SecurityIssue&&this.notedetail.previewItems.push({label:"安全问题",value:this.notedetail.SecurityIssue}),this.notedetail.date&&this.notedetail.previewItems.push({label:"发布时间",value:this.notedetail.date}))},addButtonClickHandle:function(){this.showAddBtn=!1,this.showAddNoteDlg=!0,this.updateNoteId=null},updateNoteHandle:function(e){this.showAddBtn=!1,this.showAddNoteDlg=!0,n.a.remove(s.a.StorePanoNote),this.noteInfo.region=e.ConstructRegion,this.noteInfo.weather=e.Weather,this.noteInfo.detail=e.Notes,this.noteInfo.qualityissue=e.QualityIssue,this.noteInfo.securityissue=e.SecurityIssue,this.noteInfo.bussinessbill=e.BusinessBill,this.noteInfo.designchangebill=e.DesignChangeBill,this.noteInfo.techniquechangebill=e.TechniqueChangeBill,this.noteInfo.projectvisabill=e.ProjectVisaBill,this.noteInfo.privateregion=e.PriviateRegion,this.noteInfo.materialsample=e.MaterialSample,this.updateNoteId=e.key},deleteNoteHandle:function(e,t){var o=this;this.$vux.confirm.show({theme:"ios",title:"确认删除日志提示",content:"确认删除当前选中的日志?",onConfirm:function(){var n=e.key;N.b.delete("/note/del/"+n).then(function(e){1e3===e.data.code&&(o.$vux.toast.show({text:"删除施工日志成功!"}),o.notes.splice(t,1))}).catch(function(e){console.log("删除日志异常: "+e),alert("删除施工日志异常, 错误代码: "+e)})}})}},mounted:function(){this.$store.dispatch("UpdateShowHeader",!0),this.$store.dispatch("UpdateShowTabbar",!1),this.fetchMyNotes(20,0,!1)}}),z={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("x-header",{staticStyle:{width:"100%",position:"absolute",left:"0",top:"0","z-index":"100"},attrs:{slot:"header","left-options":{showBack:!0,backText:"返回"},title:"施工日志"},slot:"header"}),e._v(" "),e.notes.length>0?o("group",{attrs:{title:"我的施工日志列表(共有"+e.notes.length+"个施工日志)"}},[o("scroller",{ref:"notescroller",attrs:{height:"-50","lock-x":"","scrollbar-y":"","use-pulldown":"","use-pullup":"","pullup-config":{content:"上拉加载更多",downContent:"松开进行加载",upContent:"上拉加载更多",loadingContent:"更新施工日志加载中...",clsPrefix:"xs-plugin-pullup-"},"pulldown-config":{content:"下拉刷新",downContent:"下拉刷新",upContent:"释放刷新",loadingContent:"加载施工日志中...",clsPrefix:"xs-plugin-pulldown-"}},on:{"on-pullup-loading":e.loadMoreNote,"on-pulldown-loading":e.refreshNote}},[o("swipeout",e._l(e.notes,function(t,n){return o("swipeout-item",{key:t.key,attrs:{threshold:.5,"underlay-color":"#ccc"}},[o("div",{attrs:{slot:"right-menu"},slot:"right-menu"},[o("swipeout-button",{attrs:{type:"primary"},nativeOn:{click:function(o){e.updateNoteHandle(t,n)}}},[e._v("修改\n          ")]),e._v(" "),o("swipeout-button",{attrs:{type:"warn"},nativeOn:{click:function(o){e.deleteNoteHandle(t,n)}}},[e._v("删除\n          ")])],1),e._v(" "),o("div",{staticClass:"project-content vux-1px-tb",attrs:{slot:"content"},slot:"content"},[o("cell",{attrs:{title:t.Notes.length>0?n+1+"."+t.Notes.substr(0,20):n+1+".施工日志详细内容未填","inline-desc":"发布于"+t.date,"is-link":""},nativeOn:{click:function(o){e.goNoteDetailPage(t)}}})],1)])}))],1)],1):o("div",[o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("br"),e._v(" "),o("load-more",{attrs:{"show-loading":!1,tip:"没有我的施工日志数据!","background-color":"#fbf9fe"}})],1),e._v(" "),o("note-detail",{attrs:{show:e.showNoteDetailDlg,data:e.notedetail},on:{"on-click-back":function(t){e.showNoteDetailDlg=!1,e.showAddBtn=!0}}}),e._v(" "),o("note-add",{attrs:{show:e.showAddNoteDlg,"note-info":e.noteInfo,noteid:e.updateNoteId},on:{"on-click-back":function(t){e.showAddNoteDlg=!1,e.showAddBtn=!0}}}),e._v(" "),e.showAddBtn?o("div",{staticClass:"fixbtn",class:[{hover:e.shouldHover}],on:{mouseenter:function(t){e.shouldHover=!0},mouseleave:function(t){e.shouldHover=!1},click:e.addButtonClickHandle}},[e._t("default",[o("plus-icon",{staticStyle:{color:"white"}})])],2):e._e()],1)},staticRenderFns:[]};var A=o("./node_modules/vue-loader/lib/component-normalizer.js")(T,z,!1,function(e){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-3d2bfcb1","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/PanoNote.vue')},"data-v-3d2bfcb1",null);t.default=A.exports}});