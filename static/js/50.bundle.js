webpackJsonp([50],{'./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-4dc0a727","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/EngineeringQuantityAdd.vue':function(t,e){},"./src/pages/EngineeringQuantityAdd.vue":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("./node_modules/vux/src/components/button-tab/button-tab.vue"),a=o("./node_modules/vux/src/components/button-tab/button-tab-item.vue"),i=o("./node_modules/vux/src/components/checklist/index.vue"),s=o("./node_modules/vux/src/components/flexbox/flexbox.vue"),c=o("./node_modules/vux/src/components/flexbox/flexbox-item.vue"),l=o("./node_modules/vux/src/components/load-more/index.vue"),r=o("./node_modules/vux/src/components/popup/index.vue"),d=o("./node_modules/vux/src/components/previewer/index.vue"),u=o("./node_modules/vux/src/components/search/index.vue"),p=o("./node_modules/vux/src/components/x-number/index.vue"),h=o("./node_modules/vux/src/components/x-switch/index.vue"),m=o("./node_modules/vux/src/components/x-textarea/index.vue"),v=o("./src/webconfig.js"),x=o("./src/utils/StoreUtils.js"),f=o("./src/api/index.js"),b=o("./src/utils/StringUtils.js"),y=o("./src/utils/PlatformUtils.js"),g=o("./src/utils/ElectronUtils.js"),C=(n.a,a.a,r.a,p.a,h.a,m.a,i.a,l.a,s.a,c.a,d.a,u.a,{name:"EngineeringQuantityAdd",components:{ButtonTab:n.a,ButtonTabItem:a.a,Popup:r.a,XNumber:p.a,XSwitch:h.a,XTextarea:m.a,Checklist:i.a,LoadMore:l.a,Flexbox:s.a,FlexboxItem:c.a,Previewer:d.a,Search:u.a},data:function(){return{searchResults:[],searchModel:"",QuantityAddTitle:"",projectid:null,materialType:0,showUnitPopup:!1,units:[],unitsModel:[],selectedUnitName:"请选择",contract:{content:"",price:0,quantity:0,unitid:0},completed:{contractid:null,price:0,quantity:0},audit:{completedid:null,price:0,quantity:0},showContractsPopup:!1,selectedContractName:"请选择",contracts:[],storedContracts:[],filterContracts:[],contractsModel:[],showCompletedPopup:!1,selectedComplatedName:"请选择",completeds:[],storedComplateds:[],filterComplateds:[],ComplatedsModel:[],disabledContractSaveBtn:!1,disabledComplatedSaveBtn:!1,disabledAuditSaveBtn:!1}},computed:{projectname:function(){return x.a.get(v.a.StoreProject)?x.a.get(v.a.StoreProject).value:"未知项目"}},methods:{selectUnitChange:function(t,e){this.showUnitPopup=!1,0<t.length?(this.selectedUnitName=e[0],this.contract.unitid=t[0]):this.selectedUnitName="请选择"},searchFocus:function(){this.searchResults=[]},cancelSearch:function(){},clickSearchResult:function(t){1===this.materialType?(this.filterContracts=this.contracts.filter(function(e){return e.value===t.title}),this.contractsModel=[this.filterContracts[0].key],this.selectedContractName=this.filterContracts[0].value):2===this.materialType&&(this.filterComplateds=this.completeds.filter(function(e){return e.value===t.title}),this.ComplatedsModel=[this.filterComplateds[0].key],this.selectedComplatedName=this.filterComplateds[0].value)},inputSearchChange:function(t){var e=this;e.searchResults=[],1===this.materialType?this.contracts.forEach(function(o){Object(b.c)(o.value,t)&&e.searchResults.push({title:o.value,other:o.key})}):2===this.materialType&&this.completeds.forEach(function(o){Object(b.c)(o.value,t)&&e.searchResults.push({title:o.value,other:o.key})})},goNewContractPage:function(){this.$router.push({name:"pquantityadd",params:{projectid:this.projectid,type:0}})},goNewCompletedPage:function(){this.$router.push({name:"pquantityadd",params:{projectid:this.projectid,type:1}})},showContractOptionsDlg:function(){this.showContractsPopup=!0,this.contracts=this.storedContracts},showCompletedtionsDlg:function(){this.showCompletedPopup=!0,this.completeds=this.storedComplateds},selectContractChange:function(t,e){this.showContractsPopup=!1,0<t.length?(this.selectedContractName=e[0],this.completed.contractid=t[0].split(",")[0],this.completed.price=t[0].split(",")[1]):this.selectedContractName="请选择"},selectedComplatedChange:function(t,e){this.showCompletedPopup=!1,0<t.length?(this.selectedComplatedName=e[0],this.audit.completedid=t[0].split(",")[0],this.audit.price=t[0].split(",")[1]):this.selectedComplatedName="请选择"},fetchUnits:function(){var t=this;this.units=[],f.b.get("/equantity/units").then(function(e){1e3===e.data.code&&(e.data.data.forEach(function(e){t.units.push({key:e.PanoProjectEngineeringQuantityUnitKey.toString(),value:e.UnitName+"("+e.Description+")"})}),0<t.units.length&&(t.unitsModel=[t.units[0].key]))}).catch(function(t){alert("获取计量单位报错！"+t)})},fetchContractMaterials:function(){var t=this;f.b.get("/equantity/contract/"+this.projectid).then(function(e){if(1e3===e.data.code){var o=e.data.data;o.items.forEach(function(t){var e=t.Content+"(单位: "+t.UnitName+")",o=[t.Key,t.Price];t.key=o.toString(),t.value=e}),t.storedContracts=o.items,t.contracts=o.items,0<t.contracts.length&&(t.contractsModel=[t.contracts[0].key])}})},fetchCompletedMaterials:function(){var t=this;f.b.get("/equantity/completed/"+this.projectid).then(function(e){if(1e3===e.data.code){var o=e.data.data;o.items.forEach(function(t){var e=t.Content+", 完成量单价: "+t.Price+"/"+t.UnitName,o=[t.Key,t.Price];t.key=o.toString(),t.value=e}),t.storedComplateds=o.items,t.completeds=o.items,0<t.completeds.length&&(t.ComplatedsModel=[t.completeds[0].key])}})},saveContract:function(){var t=this,e={projectid:this.projectid,content:this.contract.content,price:this.contract.price,quantity:this.contract.quantity,unitid:this.contract.unitid},o="合同工程量录入提示";null!==this.projectid?!this.contract.content||0>=this.contract.content.length?this.$vux.alert.show({title:o,content:"项目名称不能为空!"}):""===this.contract.quantity||isNaN(this.contract.quantity)?this.$vux.alert.show({title:o,content:"合同工程量不能为空,必须大于等于零!"}):0!==!this.contract.unitid?this.projectid&&0<this.contract.content.length&&""!==this.contract.quantity&&0<this.contract.unitid?(this.disabledContractSaveBtn=!0,this.$vux.loading.show({text:"正在保存"}),f.b.post("/equantity/add/contract",e).then(function(e){t.$vux.loading.hide(),1e3===e.data.code&&(t.$vux.toast.show({text:"保存合同工程量信息成功,三秒后跳转到工程量动态列表!"}),setTimeout(function(){Object(y.b)()?t.$router.go(-1):Object(g.a)()},3e3))}).catch(function(e){console.log(""+e),t.$vux.loading.hide(),t.disabledContractSaveBtn=!1})):(this.disabledContractSaveBtn=!1,this.$vux.alert.show({content:"请检查你的输入是否合法,项目名称,工程量数量必须大于等于零,工程量计量单位不能为空!"})):this.$vux.alert.show({title:o,content:"合同工程量计量单位不能为空!"}):this.$vux.alert.show({title:o,content:"无法定位工程名称不能录入!"})},saveCompleted:function(){var t=this,e={contractid:this.completed.contractid,price:this.completed.price,quantity:this.completed.quantity},o="完成工程量录入提示";null!==this.completed.contractid?""===this.completed.price||isNaN(this.completed.price)?this.$vux.alert.show({title:o,content:"完成工程量单价不能为空!"}):""===this.completed.quantity||isNaN(this.completed.quantity)?this.$vux.alert.show({title:o,content:"完成工程量数量不能为空,必须大于等于零!"}):null!==this.completed.contractid&&""!==this.completed.quantity&&""!==this.completed.price?(this.disabledComplatedSaveBtn=!0,this.$vux.loading.show({text:"正在保存"}),f.b.post("/equantity/add/completed",e).then(function(e){t.$vux.loading.hide();var o=e.data.code;1e3===o?(t.$vux.loading.hide(),t.$vux.toast.show({text:"保存完成工程量信息成功,三秒后跳转到工程量动态列表!"}),setTimeout(function(){Object(y.b)()?t.$router.go(-1):Object(g.a)()},3e3)):1008===o&&(t.disabledComplatedSaveBtn=!1,t.$vux.toast.show({type:"warn",time:5e3,text:"当前选择的项目名称对应的完成工程量已经存在,请重新选择项目名称!"}))}).catch(function(e){console.log(""+e),t.$vux.loading.hide(),t.disabledComplatedSaveBtn=!1})):(this.disabledComplatedSaveBtn=!1,this.$vux.alert.show({content:"请检查你的输入是否合法,合同项目名称,完成工程量数量必须大于等于零，工程量单价不能为空!"})):this.$vux.alert.show({title:o,content:"必须选择一个合同项目名称!"})},saveAudit:function(){var t=this,e={completedid:this.audit.completedid,price:this.audit.price,quantity:this.audit.quantity},o="审核工程量录入提示";null!==this.audit.completedid?""===this.audit.price||isNaN(this.audit.price)?this.$vux.alert.show({title:o,content:"审核工程量单价不能为空!"}):""===this.audit.quantity||isNaN(this.audit.quantity)?this.$vux.alert.show({title:o,content:"审核工程量数量不能为空,必须大于等于零!"}):null!==this.audit.completedid&&""!==this.audit.quantity&&""!==this.audit.price?(this.disabledAuditSaveBtn=!0,this.$vux.loading.show({text:"正在保存"}),f.b.post("/equantity/add/audit",e).then(function(e){t.$vux.loading.hide();var o=e.data.code;1e3===o?(t.$vux.toast.show({text:"保存审核工程量信息成功,三秒后跳转到工程量动态列表!"}),setTimeout(function(){Object(y.b)()?t.$router.go(-1):Object(g.a)()},3e3)):1008===o&&(t.disabledAuditSaveBtn=!1,t.$vux.toast.show({type:"warn",time:5e3,text:"当前选择的项目名称对应的审核工程量已经存在,请重新选择项目名称!"}))}).catch(function(e){console.log(""+e),t.$vux.loading.hide(),t.disabledAuditSaveBtn=!1})):(this.disabledAuditSaveBtn=!1,this.$vux.alert.show({content:"请检查你的输入是否合法,完成工程量对应的项目名称,审核工程量数量必须大于等于零,工程量单价不能为空!"})):this.$vux.alert.show({title:o,content:"必须选择一个完成工程量对应的项目名称!"})}},mounted:function(){this.$store.dispatch("UpdateShowTabbar",!1);var t=this.$route.params.type;this.projectid=this.$route.params.projectid,0===parseInt(t)?(this.materialType=0,this.QuantityAddTitle="合同工程量添加",this.fetchUnits()):1===parseInt(t)?(this.materialType=1,this.QuantityAddTitle="完成工程量添加",this.fetchContractMaterials()):2===parseInt(t)&&(this.materialType=2,this.QuantityAddTitle="审核工程量添加",this.fetchCompletedMaterials())}}),_={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!1}}},[t._v("\n    "+t._s(t.QuantityAddTitle)+"\n  ")]),t._v(" "),o("div",[0==t.materialType?o("group",{attrs:{title:"合同工程量添加"}},[o("cell",[o("span",{attrs:{slot:"title"},slot:"title"},[t._v("工程名称")]),t._v(" "),o("span",[t._v(t._s(t.projectname))])]),t._v(" "),o("x-input",{attrs:{type:"text",title:"投标项目名称",placeholder:"请输入投标项目名称"},model:{value:t.contract.content,callback:function(e){t.$set(t.contract,"content",e)},expression:"contract.content"}}),t._v(" "),o("cell",{attrs:{title:"选择一个计量单位",value:t.selectedUnitName,"is-link":""},nativeOn:{click:function(e){t.showUnitPopup=!0}}}),t._v(" "),o("x-input",{attrs:{title:"合同工程量"},model:{value:t.contract.quantity,callback:function(e){t.$set(t.contract,"quantity",e)},expression:"contract.quantity"}}),t._v(" "),o("x-input",{attrs:{title:"合同量单价",placeholder:"请输入投标单价"},model:{value:t.contract.price,callback:function(e){t.$set(t.contract,"price",e)},expression:"contract.price"}}),t._v(" "),o("br"),t._v(" "),o("x-button",{attrs:{type:"primary","action-type":"button",disabled:t.disabledContractSaveBtn},nativeOn:{click:function(e){return t.saveContract(e)}}},[t._v("保存")])],1):1===t.materialType?o("group",{attrs:{title:"完成工程量添加"}},[o("cell",{attrs:{title:"工程名称"}},[t._v(t._s(t.projectname))]),t._v(" "),o("cell",{attrs:{title:"请选择一个合同量项目名称",value:t.selectedContractName,"is-link":""},nativeOn:{click:function(e){return t.showContractOptionsDlg(e)}}}),t._v(" "),o("x-input",{attrs:{title:"完成工程量"},model:{value:t.completed.quantity,callback:function(e){t.$set(t.completed,"quantity",e)},expression:"completed.quantity"}}),t._v(" "),o("x-input",{attrs:{title:"完成量单价","inline-desc":"默认为合同量单价",placeholder:"请输入完成量单价(可选)"},model:{value:t.completed.price,callback:function(e){t.$set(t.completed,"price",e)},expression:"completed.price"}}),t._v(" "),o("x-button",{attrs:{type:"primary","action-type":"button",disabled:t.disabledComplatedSaveBtn},nativeOn:{click:function(e){return t.saveCompleted(e)}}},[t._v("保存")])],1):2===t.materialType?o("group",{attrs:{title:"审核工程量添加"}},[o("cell",{attrs:{title:"工程名称"}},[t._v(t._s(t.projectname))]),t._v(" "),o("cell",{attrs:{title:"请选择一个完成量项目名称",value:t.selectedComplatedName,"is-link":""},nativeOn:{click:function(e){return t.showCompletedtionsDlg(e)}}}),t._v(" "),o("x-input",{attrs:{title:"审核工程量"},model:{value:t.audit.quantity,callback:function(e){t.$set(t.audit,"quantity",e)},expression:"audit.quantity"}}),t._v(" "),o("x-input",{attrs:{title:"审核量单价","inline-desc":"默认为完成量单价",placeholder:"请输入审核单价(可选)"},model:{value:t.audit.price,callback:function(e){t.$set(t.audit,"price",e)},expression:"audit.price"}}),t._v(" "),o("x-button",{attrs:{type:"primary","action-type":"button",disabled:t.disabledAuditSaveBtn},nativeOn:{click:function(e){return t.saveAudit(e)}}},[t._v("保存")])],1):t._e()],1),t._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:t.showUnitPopup,callback:function(e){t.showUnitPopup=e},expression:"showUnitPopup"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(e){t.showUnitPopup=!1}}},[t._v("\n        计量单位列表\n      ")]),t._v(" "),t.units.length>0?o("div",[o("checklist",{attrs:{title:"请勾选一个计量单位名称",max:1,options:t.units},on:{"on-change":t.selectUnitChange},model:{value:t.unitsModel,callback:function(e){t.unitsModel=e},expression:"unitsModel"}})],1):t._e()],1)],1),t._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:t.showContractsPopup,callback:function(e){t.showContractsPopup=e},expression:"showContractsPopup"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(e){t.showContractsPopup=!1}}},[t._v("\n        合同量项目名称列表\n      ")]),t._v(" "),t.contracts.length>0?o("div",[o("search",{ref:"search",attrs:{placeholder:"输入要查询的项目名称",position:"absolute","auto-scroll-to-top":"",top:"46px",results:t.searchResults},on:{"on-focus":t.searchFocus,"on-change":t.inputSearchChange,"on-result-click":t.clickSearchResult,"on-cancel":t.cancelSearch},model:{value:t.searchModel,callback:function(e){t.searchModel=e},expression:"searchModel"}}),t._v(" "),o("checklist",{attrs:{title:"请勾选一个合同量项目名称",max:1,options:t.contracts},on:{"on-change":t.selectContractChange},model:{value:t.contractsModel,callback:function(e){t.contractsModel=e},expression:"contractsModel"}}),t._v(" "),o("br"),t._v(" "),o("span",[t._v("没有找到你要的项目名称? 试试 "),o("x-button",{staticStyle:{width:"108px"},attrs:{mini:"",type:"primary"},nativeOn:{click:function(e){return t.goNewContractPage(e)}}},[t._v("新建合同量")])],1)],1):t._e(),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:0===t.contracts.length,expression:"contracts.length === 0"}]},[o("load-more",{staticStyle:{"padding-top":"30px"},attrs:{"show-loading":!1,tip:"当前单位工程没有任何合同项目名称!","background-color":"#fbf9fe"}}),t._v(" "),o("flexbox",[o("flexbox-item",{attrs:{span:2}}),t._v(" "),o("flexbox-item",[o("x-button",{attrs:{type:"primary","action-type":"button"},nativeOn:{click:function(e){return t.goNewContractPage(e)}}},[t._v("新建合同量\n            ")])],1),t._v(" "),o("flexbox-item",{attrs:{span:2}})],1)],1)],1)],1),t._v(" "),o("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}]},[o("popup",{attrs:{height:"100%"},model:{value:t.showCompletedPopup,callback:function(e){t.showCompletedPopup=e},expression:"showCompletedPopup"}},[o("x-header",{attrs:{"left-options":{showBack:!0,preventGoBack:!0}},on:{"on-click-back":function(e){t.showCompletedPopup=!1}}},[t._v("\n        完成量项目名称列表\n      ")]),t._v(" "),t.completeds.length>0?o("div",[o("search",{ref:"search",attrs:{placeholder:"输入要查询的完成量的项目名称",position:"absolute","auto-scroll-to-top":"",top:"46px",results:t.searchResults},on:{"on-focus":t.searchFocus,"on-change":t.inputSearchChange,"on-result-click":t.clickSearchResult,"on-cancel":t.cancelSearch},model:{value:t.searchModel,callback:function(e){t.searchModel=e},expression:"searchModel"}}),t._v(" "),o("checklist",{attrs:{title:"请勾选一个完成量的项目名称",max:1,options:t.completeds},on:{"on-change":t.selectedComplatedChange},model:{value:t.ComplatedsModel,callback:function(e){t.ComplatedsModel=e},expression:"ComplatedsModel"}}),t._v(" "),o("br"),t._v(" "),o("span",[t._v("没有找到你要的项目名称? 试试 "),o("x-button",{staticStyle:{width:"108px"},attrs:{mini:"",type:"primary"},nativeOn:{click:function(e){return t.goNewCompletedPage(e)}}},[t._v("新建完成量")])],1)],1):t._e(),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:0===t.completeds.length,expression:"completeds.length === 0"}]},[o("load-more",{staticStyle:{"padding-top":"30px"},attrs:{"show-loading":!1,tip:"当前单位工程没有任何完成量!","background-color":"#fbf9fe"}}),t._v(" "),o("flexbox",[o("flexbox-item",{attrs:{span:2}}),t._v(" "),o("flexbox-item",[o("x-button",{attrs:{type:"primary","action-type":"button"},nativeOn:{click:function(e){return t.goNewCompletedPage(e)}}},[t._v("新建完成量\n            ")])],1),t._v(" "),o("flexbox-item",{attrs:{span:2}})],1)],1)],1)],1)],1)},staticRenderFns:[]};var w=o("./node_modules/vue-loader/lib/component-normalizer.js")(C,_,!1,function(t){o('./node_modules/extract-text-webpack-plugin/dist/loader.js?{"omit":1,"remove":true}!./node_modules/vue-style-loader/index.js!./node_modules/css-loader/index.js?{"sourceMap":false}!./node_modules/vue-loader/lib/style-compiler/index.js?{"vue":true,"id":"data-v-4dc0a727","scoped":true,"hasInlineConfig":false}!./node_modules/vux-loader/src/style-loader.js!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/pages/EngineeringQuantityAdd.vue')},"data-v-4dc0a727",null);e.default=w.exports}});